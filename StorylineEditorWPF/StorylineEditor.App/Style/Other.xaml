<!--
StorylineEditor
Copyright (C) 2023 Pentangle Studio

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program. If not, see <http://www.gnu.org/licenses/>.
-->

<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:config="clr-namespace:StorylineEditor.App.Config"
                    xmlns:appNodes="clr-namespace:StorylineEditor.App.Nodes"
                    xmlns:vmconfig="clr-namespace:StorylineEditor.ViewModel.Config;assembly=StorylineEditor.ViewModel"
                    xmlns:vm="clr-namespace:StorylineEditor.ViewModel;assembly=StorylineEditor.ViewModel"
                    xmlns:vmg="clr-namespace:StorylineEditor.ViewModel.Graphs;assembly=StorylineEditor.ViewModel"
                    xmlns:vmn="clr-namespace:StorylineEditor.ViewModel.Nodes;assembly=StorylineEditor.ViewModel"
                    xmlns:vmp="clr-namespace:StorylineEditor.ViewModel.Predicates;assembly=StorylineEditor.ViewModel"
                    xmlns:vmge="clr-namespace:StorylineEditor.ViewModel.GameEvents;assembly=StorylineEditor.ViewModel"
                    xmlns:m="clr-namespace:StorylineEditor.Model;assembly=StorylineEditor.Model"
                    xmlns:mn="clr-namespace:StorylineEditor.Model.Nodes;assembly=StorylineEditor.Model"
                    xmlns:mp="clr-namespace:StorylineEditor.Model.Predicates;assembly=StorylineEditor.Model"
                    xmlns:mge="clr-namespace:StorylineEditor.Model.GameEvents;assembly=StorylineEditor.Model"
                    xmlns:mg="clr-namespace:StorylineEditor.Model.Graphs;assembly=StorylineEditor.Model"
                    xmlns:bhvrs="clr-namespace:StorylineEditor.App.Behaviors"
                    xmlns:controls="clr-namespace:StorylineEditor.App.Controls"
                    xmlns:sys="clr-namespace:System;assembly=mscorlib"
                    xmlns:mb="clr-namespace:StorylineEditor.Model.Behaviors;assembly=StorylineEditor.Model"
                    xmlns:vmb="clr-namespace:StorylineEditor.ViewModel.Behaviors;assembly=StorylineEditor.ViewModel">

    <!-- COLLECTION CONTEXT (FOLDERS AND PATH) -->

    <appNodes:CanvasDataTemplateSelector x:Key="canvasDataTemplateSelector"></appNodes:CanvasDataTemplateSelector>
    
    <ControlTemplate TargetType="Button" x:Key="CT_Button_Path">
        <Border x:Name="br_Main" Margin="{StaticResource Thickness_Margin_1x}" Background="{StaticResource Color_HitVisible}" 
                    BorderBrush="{StaticResource Color_HitVisible}" BorderThickness="{StaticResource Thickness_Margin_Underline_1x}" Cursor="Hand">
            <ContentPresenter></ContentPresenter>
        </Border>
        <ControlTemplate.Triggers>
            <Trigger Property="IsMouseOver" Value="true">
                <Setter TargetName="br_Main" Property="BorderBrush" Value="{StaticResource Color_Path}"></Setter>
            </Trigger>
        </ControlTemplate.Triggers>
    </ControlTemplate>



    <!-- COLLECTION ITEMS -->

    <Style TargetType="Border" x:Key="S_Border_Selector">
        <Setter Property="Cursor" Value="Hand"></Setter>
        <Setter Property="Margin" Value="{StaticResource Thickness_Margin_1x}"></Setter>
        <Setter Property="CornerRadius" Value="{StaticResource CornerRadius_Common}"></Setter>
        <Setter Property="BorderThickness" Value="{StaticResource Thickness_Margin_2x}"></Setter>
        <Setter Property="Background" Value="{StaticResource Color_HitVisible}"></Setter>
        <Style.Triggers>
            <DataTrigger Binding="{Binding IsSelected, UpdateSourceTrigger=PropertyChanged}" Value="True">
                <Setter Property="Background" Value="{StaticResource Color_Selection_Background}"></Setter>
                <Setter Property="BorderBrush" Value="{StaticResource Color_Selection_Border}"></Setter>
            </DataTrigger>
            <DataTrigger Binding="{Binding IsDragOver, UpdateSourceTrigger=PropertyChanged}" Value="true">
                <Setter Property="Background" Value="{StaticResource Color_IsDragOver}"></Setter>
            </DataTrigger>
        </Style.Triggers>
    </Style>

    <Style TargetType="TextBlock" BasedOn="{StaticResource S_TextBlock}" x:Key="S_TextBlock_Selector_Cut">
        <Setter Property="VerticalAlignment" Value="Center"></Setter>
        <Setter Property="HorizontalAlignment" Value="Right"></Setter>
        <Setter Property="Text" Value="{StaticResource String_Icon_Cut}"></Setter>
        <Setter Property="Width" Value="{Binding ActualHeight, RelativeSource={RelativeSource Mode=Self}, UpdateSourceTrigger=PropertyChanged}"></Setter>
        <Style.Triggers>
            <DataTrigger Binding="{Binding IsCut, UpdateSourceTrigger=PropertyChanged}" Value="false">
                <Setter Property="Visibility" Value="Hidden"></Setter>
            </DataTrigger>
        </Style.Triggers>
    </Style>

    <Style TargetType="TextBlock" BasedOn="{StaticResource S_TextBlock}" x:Key="S_TextBlock_Selector_Icon">
        <Setter Property="MinWidth" Value="{StaticResource Double_Size_32x}"></Setter>
        <Setter Property="TextAlignment" Value="Center"></Setter>
        <Setter Property="VerticalAlignment" Value="Center"></Setter>
        <Setter Property="FontSize" Value="{StaticResource FontSize_VeryLarge}"></Setter>
        <Setter Property="Margin" Value="{StaticResource Thickness_Margin_2x}"></Setter>
    </Style>

    <Style TargetType="TextBlock" BasedOn="{StaticResource S_TextBlock}" x:Key="S_TextBlock_Selector_Icon_Mini">
        <Setter Property="MinWidth" Value="{StaticResource Double_Size_16x}"></Setter>
        <Setter Property="TextAlignment" Value="Center"></Setter>
        <Setter Property="VerticalAlignment" Value="Center"></Setter>
        <Setter Property="FontSize" Value="{StaticResource FontSize_Large}"></Setter>
        <Setter Property="Margin" Value="{StaticResource Thickness_Margin_2x}"></Setter>
    </Style>
    
    <Style TargetType="TextBlock" BasedOn="{StaticResource S_TextBlock}" x:Key="S_TextBlock_Selector_Name">
        <Setter Property="VerticalAlignment" Value="Center"></Setter>
    </Style>

    <Style TargetType="TextBlock" BasedOn="{StaticResource S_TextBlock}" x:Key="S_TextBlock_Selector_Name_Mini">
        <Setter Property="FontSize" Value="{StaticResource FontSize_Small}"></Setter>
        <Setter Property="VerticalAlignment" Value="Center"></Setter>
    </Style>

    <!-- MAIN MENU -->

    <ControlTemplate TargetType="Button" x:Key="CT_Button_TabMenu">
        <Border x:Name="br_Main" Margin="{StaticResource Thickness_Margin_1x}" Padding="{StaticResource Thickness_Padding_LeftRight}"
                                Background="{StaticResource Color_HitVisible}" BorderBrush="{StaticResource Color_HitVisible}" BorderThickness="{StaticResource Thickness_Margin_Underline_4x}" Cursor="Hand">
            <ContentPresenter></ContentPresenter>
        </Border>
        <ControlTemplate.Triggers>
            <Trigger Property="IsEnabled" Value="false">
                <Setter TargetName="br_Main" Property="BorderBrush" Value="{StaticResource Color_Selection_Border}"></Setter>
                <Setter Property="FontWeight" Value="Bold"></Setter>
            </Trigger>
            <Trigger Property="IsMouseOver" Value="true">
                <Setter TargetName="br_Main" Property="BorderBrush" Value="{StaticResource Color_Selection_Unselected}"></Setter>
            </Trigger>
        </ControlTemplate.Triggers>
    </ControlTemplate>

    <Style TargetType="TextBox" BasedOn="{StaticResource S_TextBox}" x:Key="S_TextBox_Filter">
        <Setter Property="Margin" Value="{StaticResource Thickness_Margin_1x}"></Setter>
    </Style>



    <!-- Node -->

    <Style TargetType="TextBlock" BasedOn="{StaticResource S_TextBlock}" x:Key="S_TextBlock_Node">
        <Setter Property="Margin" Value="{StaticResource Thickness_Margin_1x}"></Setter>
    </Style>

    <Style TargetType="TextBlock" BasedOn="{StaticResource S_TextBlock_Node}" x:Key="S_TextBlock_Node_Icon">
        <Setter Property="IsHitTestVisible" Value="False"></Setter>
    </Style>

    <Style TargetType="TextBlock" BasedOn="{StaticResource S_TextBlock_Node_Icon}" x:Key="S_TextBlock_Node_Icon_Large">
        <Setter Property="FontSize" Value="{StaticResource FontSize_VeryLarge}"></Setter>
    </Style>

    <Style TargetType="TextBlock" BasedOn="{StaticResource S_TextBlock_Node}" x:Key="S_TextBlock_Node_Header">
        <Setter Property="FontWeight" Value="Bold"></Setter>
    </Style>

    <Style TargetType="TextBlock" BasedOn="{StaticResource S_TextBlock_Node}" x:Key="S_TextBlock_Node_Description"></Style>

    <Style TargetType="TextBlock" BasedOn="{StaticResource S_TextBlock_Node}" x:Key="S_TextBlock_Node_ShortDescription">
        <Setter Property="FontWeight" Value="Bold"></Setter>
    </Style>
    
    <Style TargetType="TextBlock" BasedOn="{StaticResource S_TextBlock_Node}" x:Key="S_TextBlock_Node_Result">
        <Setter Property="FontStyle" Value="Italic"></Setter>
    </Style>

    <Style TargetType="Border" x:Key="S_Border_Node">
        <Setter Property="Padding" Value="{StaticResource Thickness_Margin_4x}"></Setter>
        <Setter Property="CornerRadius" Value="{StaticResource CornerRadius_Common}"></Setter>
        <Setter Property="BorderBrush" Value="{StaticResource Color_Selection_Unselected}"></Setter>
        <Setter Property="BorderThickness" Value="4"></Setter>
        <Setter Property="MinHeight" Value="{StaticResource Double_Node_MinHeight}"></Setter>
        <Setter Property="MinWidth" Value="{StaticResource Double_Node_MinWidth}"></Setter>
        <Setter Property="MaxWidth" Value="{StaticResource Double_Node_MaxWidth}"></Setter>
        <Setter Property="ToolTip" Value="{Binding Id, Mode=OneTime}"></Setter>
        <Setter Property="Background" Value="{StaticResource Color_Graph_Node_Background}"></Setter>
        <Setter Property="bhvrs:RenderSizeBehavior.ActualWidth" Value="{Binding Width, UpdateSourceTrigger=PropertyChanged, Mode=OneWayToSource}"></Setter>
        <Setter Property="bhvrs:RenderSizeBehavior.ActualHeight" Value="{Binding Height, UpdateSourceTrigger=PropertyChanged, Mode=OneWayToSource}"></Setter>
        <Setter Property="bhvrs:RenderSizeBehavior.IsEnabled" Value="true"></Setter>
        <Style.Triggers>
            <DataTrigger Binding="{Binding IsSelected, UpdateSourceTrigger=PropertyChanged}" Value="true">
                <Setter Property="BorderBrush" Value="{StaticResource Color_Selection_Border}"></Setter>
            </DataTrigger>
            <DataTrigger Binding="{Binding Character.id}" Value="{x:Static m:CharacterM.PLAYER_ID}">
                <Setter Property="Background" Value="{StaticResource Color_Graph_Node_Background_Player}"></Setter>
            </DataTrigger>
        </Style.Triggers>
    </Style>

    <Style TargetType="Button" x:Key="S_Button_Gender" BasedOn="{StaticResource S_Button_Square_24x}">
        <Setter Property="Command" Value="{Binding ToggleGenderCommand}"></Setter>
        <Style.Triggers>
            <DataTrigger Binding="{Binding Gender, UpdateSourceTrigger=PropertyChanged}" Value="{x:Static m:GENDER.UNSET}">
                <Setter Property="Content" Value="{StaticResource String_Icon_Gender_Unset}"></Setter>
            </DataTrigger>
            <DataTrigger Binding="{Binding Gender, UpdateSourceTrigger=PropertyChanged}" Value="{x:Static m:GENDER.MALE}">
                <Setter Property="Content" Value="{StaticResource String_Icon_Gender_Male}"></Setter>
            </DataTrigger>
            <DataTrigger Binding="{Binding Gender, UpdateSourceTrigger=PropertyChanged}" Value="{x:Static m:GENDER.FEMALE}">
                <Setter Property="Content" Value="{StaticResource String_Icon_Gender_Female}"></Setter>
            </DataTrigger>
        </Style.Triggers>
    </Style>

    <Style TargetType="Button" x:Key="S_Button_Node_Gender" BasedOn="{StaticResource S_Button_Square_32x}">
        <Setter Property="Command" Value="{Binding ToggleGenderCommand}"></Setter>
        <Setter Property="VerticalAlignment" Value="Top"></Setter>
        <Setter Property="HorizontalAlignment" Value="Left"></Setter>
        <Setter Property="RenderTransform">
            <Setter.Value>
                <TranslateTransform X="{StaticResource Double_Size_16x-}" Y="{StaticResource Double_Size_24x-}"></TranslateTransform>
            </Setter.Value>
        </Setter>
        <Style.Triggers>
            <DataTrigger Binding="{Binding Gender, UpdateSourceTrigger=PropertyChanged}" Value="{x:Static m:GENDER.UNSET}">
                <Setter Property="Content" Value="{StaticResource String_Icon_Gender_Unset}"></Setter>
            </DataTrigger>
            <DataTrigger Binding="{Binding Gender, UpdateSourceTrigger=PropertyChanged}" Value="{x:Static m:GENDER.MALE}">
                <Setter Property="Content" Value="{StaticResource String_Icon_Gender_Male}"></Setter>
            </DataTrigger>
            <DataTrigger Binding="{Binding Gender, UpdateSourceTrigger=PropertyChanged}" Value="{x:Static m:GENDER.FEMALE}">
                <Setter Property="Content" Value="{StaticResource String_Icon_Gender_Female}"></Setter>
            </DataTrigger>
        </Style.Triggers>
    </Style>

    <Style TargetType="Button" x:Key="S_Button_Remove">
        <Setter Property="FontSize" Value="{StaticResource FontSize_VerySmall}"></Setter>
        <Setter Property="Width" Value="{StaticResource Double_Size_16x}"></Setter>
        <Setter Property="Height" Value="{StaticResource Double_Size_16x}"></Setter>
        <Setter Property="Content" Value="{StaticResource String_Icon_Remove}"></Setter>
        <Setter Property="Command" Value="{Binding Path=DataContext.RemoveElementCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=ItemsControl}}"></Setter>
        <Setter Property="CommandParameter" Value="{Binding}"></Setter>
        <Setter Property="Foreground" Value="{StaticResource Color_Link_Foreground}"></Setter>
        <Setter Property="Background" Value="{StaticResource Color_Remove}"></Setter>
    </Style>

    <Style TargetType="StackPanel" x:Key="S_StackPanel_Node_TopRightPanel">
        <Setter Property="Orientation" Value="Horizontal"></Setter>
        <Setter Property="VerticalAlignment" Value="Top"></Setter>
        <Setter Property="HorizontalAlignment" Value="Right"></Setter>
        <Setter Property="RenderTransform">
            <Setter.Value>
                <TranslateTransform X="{StaticResource Double_Size_8x}" Y="{StaticResource Double_Size_16x-}"></TranslateTransform>
            </Setter.Value>
        </Setter>
    </Style>

    <ItemsPanelTemplate x:Key="IPT_WrapPanel">
        <WrapPanel Orientation="Horizontal"></WrapPanel>
    </ItemsPanelTemplate>

    <ItemsPanelTemplate x:Key="IPT_Canvas">
        <Canvas ClipToBounds="True"></Canvas>
    </ItemsPanelTemplate>

    <Style TargetType="ItemsControl" x:Key="S_ItemsControl_Graph">
        <Setter Property="Background" Value="{StaticResource Color_Graph_Background}"></Setter>
        <Setter Property="ItemsPanel" Value="{StaticResource IPT_Canvas}"></Setter>
        <Setter Property="ItemsSource" Value="{Binding ItemVms}"></Setter>
        <Setter Property="bhvrs:MouseExtBehavior.MouseEnterCommand" Value="{Binding RegisterContextCommand}"></Setter>
        <Setter Property="bhvrs:MouseExtBehavior.MouseLeaveCommand" Value="{Binding UnregisterContextCommand}"></Setter>
        <Setter Property="bhvrs:MouseExtBehavior.MouseRightButtonDownCommand" Value="{Binding FacadeMouseCommand}"></Setter>
        <Setter Property="bhvrs:MouseExtBehavior.MouseRightButtonUpCommand" Value="{Binding FacadeMouseCommand}"></Setter>
        <Setter Property="bhvrs:MouseExtBehavior.MouseLeftButtonDownCommand" Value="{Binding FacadeMouseCommand}"></Setter>
        <Setter Property="bhvrs:MouseExtBehavior.MouseLeftButtonUpCommand" Value="{Binding FacadeMouseCommand}"></Setter>
        <Setter Property="bhvrs:MouseExtBehavior.MouseMoveCommand" Value="{Binding MoveCommand}"></Setter>
        <Setter Property="bhvrs:MouseExtBehavior.MouseWheelCommand" Value="{Binding ScaleCommand}"></Setter>
        <Setter Property="bhvrs:LoadUnloadExtBehavior.LoadedCommand" Value="{Binding InitCommand}"></Setter>
        <Setter Property="bhvrs:LoadUnloadExtBehavior.UnloadedCommand" Value="{Binding UnInitCommand}"></Setter>
        <Setter Property="ItemContainerStyle">
            <Setter.Value>
                <Style TargetType="ContentPresenter">
                    <Setter Property="Canvas.ZIndex" Value="{Binding ZIndex, UpdateSourceTrigger=PropertyChanged}"/>
                    <Setter Property="Canvas.Left" Value="{Binding Left, UpdateSourceTrigger=PropertyChanged}"/>
                    <Setter Property="Canvas.Top" Value="{Binding Top, UpdateSourceTrigger=PropertyChanged}"/>
                    <Setter Property="RenderTransformOrigin" Value="0.5, 0.5"></Setter>
                    <Setter Property="RenderTransform">
                        <Setter.Value>
                            <ScaleTransform ScaleX="{Binding Path=DataContext.Scale, RelativeSource={RelativeSource AncestorType=ItemsControl}, UpdateSourceTrigger=PropertyChanged}"
                                    ScaleY="{Binding Path=DataContext.Scale, RelativeSource={RelativeSource AncestorType=ItemsControl}, UpdateSourceTrigger=PropertyChanged}"></ScaleTransform>
                        </Setter.Value>
                    </Setter>
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding IsFilterPassed, UpdateSourceTrigger=PropertyChanged}" Value="false">
                            <Setter Property="Control.Visibility" Value="Collapsed"></Setter>
                        </DataTrigger>
                        <DataTrigger Binding="{Binding IsUnscalable, UpdateSourceTrigger=PropertyChanged}" Value="true">
                            <Setter Property="RenderTransform" Value="{x:Null}"></Setter>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </Setter.Value>
        </Setter>
        <Setter Property="ItemTemplateSelector" Value="{StaticResource canvasDataTemplateSelector}"></Setter>
    </Style>

    <!-- Data Templates -->

    <DataTemplate x:Key="DT_Graph_Stats">
        <StackPanel Background="{StaticResource Color_Stats_Background}" Orientation="Vertical">
            <TextBlock Margin="{StaticResource Thickness_Margin_4x}" Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource S_TextBlock}" 
                       HorizontalAlignment="Center" FontWeight="Bold"></TextBlock>
            <TextBlock Margin="{StaticResource Thickness_Margin_4x}" Text="{Binding Stats, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource S_TextBlock}"
                   FontFamily="Courier New"></TextBlock>
        </StackPanel>
    </DataTemplate>
    
    <DataTemplate x:Key="DT_HasPredicates_Mini">
        <Grid Width="{StaticResource Double_Size_16x}" Height="{StaticResource Double_Size_16x}" ToolTip="{DynamicResource String_HasPredicates_Tooltip}">
            <Ellipse Fill="{StaticResource Color_HasPredicates_Fill}" StrokeThickness="{StaticResource Double_Margin_1x}" Stroke="{StaticResource Color_Separator}"></Ellipse>
            <TextBlock FontWeight="Bold" Foreground="{StaticResource Color_HasPredicates_Foreground}" FontSize="{StaticResource FontSize_Medium}" VerticalAlignment="Center" HorizontalAlignment="Center" Text="{StaticResource String_Icon_HasPredicates}"></TextBlock>
        </Grid>
    </DataTemplate>
    
    <DataTemplate x:Key="DT_HasPredicates">
        <Grid Width="{StaticResource Double_Size_24x}" Height="{StaticResource Double_Size_24x}" ToolTip="{DynamicResource String_HasPredicates_Tooltip}">
            <Ellipse Fill="{StaticResource Color_HasPredicates_Fill}" StrokeThickness="{StaticResource Double_Margin_1x}" Stroke="{StaticResource Color_Separator}"></Ellipse>
            <TextBlock FontWeight="Bold" Foreground="{StaticResource Color_HasPredicates_Foreground}" FontSize="{StaticResource FontSize_VeryLarge}" VerticalAlignment="Center" HorizontalAlignment="Center" Text="{StaticResource String_Icon_HasPredicates}"></TextBlock>
        </Grid>
        <DataTemplate.Triggers>
            <DataTrigger Binding="{Binding HasPredicates, UpdateSourceTrigger=PropertyChanged}" Value="false">
                <Setter Property="Visibility" Value="Hidden"></Setter>
            </DataTrigger>
        </DataTemplate.Triggers>
    </DataTemplate>

    <DataTemplate x:Key="DT_HasGameEvents_Mini">
        <Grid Width="{StaticResource Double_Size_16x}" Height="{StaticResource Double_Size_16x}" ToolTip="{DynamicResource String_HasGameEvents_Tooltip}">
            <Ellipse Fill="{StaticResource Color_HasGameEvents_Fill}" StrokeThickness="{StaticResource Double_Margin_1x}" Stroke="{StaticResource Color_Separator}"></Ellipse>
            <TextBlock FontWeight="Bold" Foreground="{StaticResource Color_HasPredicates_Foreground}" FontSize="{StaticResource FontSize_Medium}" VerticalAlignment="Center" HorizontalAlignment="Center" Text="{StaticResource String_Icon_HasGameEvents}"></TextBlock>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="DT_HasGameEvents">
        <Grid Width="{StaticResource Double_Size_24x}" Height="{StaticResource Double_Size_24x}" ToolTip="{DynamicResource String_HasGameEvents_Tooltip}">
            <Ellipse Fill="{StaticResource Color_HasGameEvents_Fill}" StrokeThickness="{StaticResource Double_Margin_1x}" Stroke="{StaticResource Color_Separator}"></Ellipse>
            <TextBlock FontWeight="Bold" Foreground="{StaticResource Color_HasPredicates_Foreground}" FontSize="{StaticResource FontSize_VeryLarge}" VerticalAlignment="Center" HorizontalAlignment="Center" Text="{StaticResource String_Icon_HasGameEvents}"></TextBlock>
        </Grid>
        <DataTemplate.Triggers>
            <DataTrigger Binding="{Binding HasGameEvents, UpdateSourceTrigger=PropertyChanged}" Value="false">
                <Setter Property="Visibility" Value="Hidden"></Setter>
            </DataTrigger>
        </DataTemplate.Triggers>
    </DataTemplate>

    <DataTemplate x:Key="DT_HasBehaviors_Mini">
        <Grid Width="{StaticResource Double_Size_16x}" Height="{StaticResource Double_Size_16x}" ToolTip="{DynamicResource String_HasBehaviors_Tooltip}">
            <Ellipse Fill="{StaticResource Color_HasBehaviors_Fill}" StrokeThickness="{StaticResource Double_Margin_1x}" Stroke="{StaticResource Color_Separator}"></Ellipse>
            <TextBlock FontWeight="Bold" Foreground="{StaticResource Color_HasPredicates_Foreground}" FontSize="{StaticResource FontSize_Medium}" VerticalAlignment="Center" HorizontalAlignment="Center" Text="{StaticResource String_Icon_HasBehaviors}"></TextBlock>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="DT_HasBehaviors">
        <Grid Width="{StaticResource Double_Size_24x}" Height="{StaticResource Double_Size_24x}" ToolTip="{DynamicResource String_HasBehaviors_Tooltip}">
            <Ellipse Fill="{StaticResource Color_HasBehaviors_Fill}" StrokeThickness="{StaticResource Double_Margin_1x}" Stroke="{StaticResource Color_Separator}"></Ellipse>
            <TextBlock FontWeight="Bold" Foreground="{StaticResource Color_HasPredicates_Foreground}" FontSize="{StaticResource FontSize_VeryLarge}" VerticalAlignment="Center" HorizontalAlignment="Center" Text="{StaticResource String_Icon_HasBehaviors}"></TextBlock>
        </Grid>
        <DataTemplate.Triggers>
            <DataTrigger Binding="{Binding HasBehaviors, UpdateSourceTrigger=PropertyChanged}" Value="false">
                <Setter Property="Visibility" Value="Hidden"></Setter>
            </DataTrigger>
        </DataTemplate.Triggers>
    </DataTemplate>
    
    <DataTemplate DataType="{x:Type m:FolderM}">
        <Button VerticalAlignment="Center" Template="{StaticResource CT_Button_Path}" Command="{Binding Path=DataContext.SetContextCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=ItemsControl}}" CommandParameter="{Binding}">
            <TextBlock Foreground="{StaticResource Color_Path}" FontSize="{StaticResource FontSize_Small}"><Run Text="{Binding name}"></Run><Run Text="/"></Run></TextBlock>
        </Button>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vm:StorylineVM}" x:Key="DT_StorylineVM_Tabs">
        <StackPanel Orientation="Horizontal">
            <Button Template="{StaticResource CT_Button_TabMenu}" Command="{Binding LocationsTabCommand}" Content="{DynamicResource String_Tag_MainMenu_Locations}"></Button>
            <Button Template="{StaticResource CT_Button_TabMenu}" Command="{Binding CharactersTabCommand}" Content="{DynamicResource String_Tag_MainMenu_Characters}"></Button>
            <Button Template="{StaticResource CT_Button_TabMenu}" Command="{Binding ItemsTabCommand}" Content="{DynamicResource String_Tag_MainMenu_Items}"></Button>
            <Button Template="{StaticResource CT_Button_TabMenu}" Command="{Binding ActorsTabCommand}" Content="{DynamicResource String_Tag_MainMenu_Actors}"></Button>
            <Button Template="{StaticResource CT_Button_TabMenu}" Command="{Binding JournalTabCommand}" Content="{DynamicResource String_Tag_MainMenu_Journal}"></Button>
            <Button Template="{StaticResource CT_Button_TabMenu}" Command="{Binding DialogsTabCommand}" Content="{DynamicResource String_Tag_MainMenu_Dialogs}"></Button>
            <Button Template="{StaticResource CT_Button_TabMenu}" Command="{Binding ReplicasTabCommand}" Content="{DynamicResource String_Tag_MainMenu_Replicas}"></Button>
        </StackPanel>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vm:StorylineVM}" x:Key="DT_StorylineVM_Selection">
        <ContentControl Content="{Binding Path=(vm:ActiveContext.ActiveTab), UpdateSourceTrigger=PropertyChanged}"></ContentControl>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vm:ListVM}">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"></ColumnDefinition>
                <ColumnDefinition Width="auto"></ColumnDefinition>
                <ColumnDefinition Width="5*"></ColumnDefinition>
            </Grid.ColumnDefinitions>

            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="auto"></RowDefinition>
                    <RowDefinition Height="auto"></RowDefinition>
                    <RowDefinition Height="*"></RowDefinition>
                </Grid.RowDefinitions>

                <StackPanel Margin="{StaticResource Thickness_Margin_1x}" Orientation="Horizontal">
                    <Button Background="{StaticResource Color_Add}" Foreground="{StaticResource Color_Link_Foreground}" Content="{StaticResource String_Icon_Add}" ToolTip="{DynamicResource String_TabMenu_Add_Tooltip}" Style="{StaticResource S_Button_Square_24x}" Command="{Binding AddCommand}" CommandParameter="{StaticResource False}"></Button>
                    <Button Background="{StaticResource Color_AddFolder}" Foreground="{StaticResource Color_Link_Foreground}" Content="{StaticResource String_Icon_Add}" ToolTip="{DynamicResource String_TabMenu_AddFolder_Tooltip}" Style="{StaticResource S_Button_Square_24x}" Command="{Binding AddCommand}" CommandParameter="{StaticResource True}"></Button>
                    <Button Background="{StaticResource Color_Remove}" Foreground="{StaticResource Color_Link_Foreground}" Content="{StaticResource String_Icon_Remove}" ToolTip="{DynamicResource String_TabMenu_Remove_Tooltip}" Style="{StaticResource S_Button_Square_24x}" Command="{Binding RemoveCommand}"></Button>

                    <Button Content="{StaticResource String_Icon_Cut}" ToolTip="{DynamicResource String_TabMenu_Cut_Tooltip}" Style="{StaticResource S_Button_Square_24x}" Command="{Binding CutCommand}"></Button>
                    <Button Content="{StaticResource String_Icon_Paste}" ToolTip="{DynamicResource String_TabMenu_Paste_Tooltip}" Style="{StaticResource S_Button_Square_24x}" Command="{Binding PasteCommand}"></Button>
                </StackPanel>

                <ItemsControl BorderBrush="{StaticResource Color_Path}" BorderThickness="{StaticResource Thickness_Margin_1x}" Margin="{StaticResource Thickness_Margin_1x}" Grid.Row="1" ItemsPanel="{StaticResource IPT_WrapPanel}" ItemsSource="{Binding Context}"></ItemsControl>

                <ScrollViewer Margin="{StaticResource Thickness_Margin_1x}" Grid.Row="2" HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="auto">
                    <ItemsControl ItemsSource="{Binding ItemVms}">
                        <ItemsControl.ItemContainerStyle>
                            <Style>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsFilterPassed, UpdateSourceTrigger=PropertyChanged}" Value="false">
                                        <Setter Property="Control.Visibility" Value="Collapsed"></Setter>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </ItemsControl.ItemContainerStyle>
                    </ItemsControl>
                </ScrollViewer>
            </Grid>

            <GridSplitter Grid.Column="1"></GridSplitter>

            <ScrollViewer Grid.Column="2" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                <ContentControl Content="{Binding SelectionEditor, UpdateSourceTrigger=PropertyChanged}"></ContentControl>
            </ScrollViewer>
        </Grid>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vm:FolderVM}">
        <Border x:Name="br_Main" Style="{StaticResource S_Border_Selector}" AllowDrop="true"
                    bhvrs:DragDropBehavior.DropCommand="{Binding Path=DataContext.DropCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=ItemsControl}}"
                    bhvrs:DragDropBehavior.DragEnterCommand="{Binding Path=DataContext.DragEnterCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=ItemsControl}}"
                    bhvrs:DragDropBehavior.DragLeaveCommand="{Binding Path=DataContext.DragLeaveCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=ItemsControl}}"
                    bhvrs:DragDropBehavior.DragEnabled="true"
                    bhvrs:LoadUnloadExtBehavior.LoadedCommand="{Binding RegisterCommand, UpdateSourceTrigger=PropertyChanged}"
                    bhvrs:LoadUnloadExtBehavior.UnloadedCommand="{Binding UnregisterCommand, UpdateSourceTrigger=PropertyChanged}">
            <Border.InputBindings>
                <MouseBinding Gesture="LeftDoubleClick" Command="{Binding Path=DataContext.SetContextCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=ItemsControl}}"
                                  CommandParameter="{Binding Model}"/>
                <MouseBinding Gesture="LeftClick" Command="{Binding Path=DataContext.SelectCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=ItemsControl}}" CommandParameter="{Binding}"></MouseBinding>
            </Border.InputBindings>
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="auto"></ColumnDefinition>
                    <ColumnDefinition Width="*"></ColumnDefinition>
                    <ColumnDefinition Width="auto"></ColumnDefinition>
                </Grid.ColumnDefinitions>
                <TextBlock Text="{StaticResource String_Icon_Open}" Style="{StaticResource S_TextBlock_Selector_Icon}"></TextBlock>
                <TextBlock Grid.Column="1" Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource S_TextBlock_Selector_Name}"></TextBlock>
                <TextBlock Grid.Column="2" Style="{StaticResource S_TextBlock_Selector_Cut}"></TextBlock>
            </Grid>
        </Border>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vm:FolderEditorVM}">
        <StackPanel Orientation="Vertical">
            <TextBox Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource S_TextBox_Prop}" Tag="{DynamicResource String_Tag_Name}"></TextBox>
            <TextBox Text="{Binding Description, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource S_TextBox_Prop_Multiline}" Tag="{DynamicResource String_Tag_Description}"></TextBox>
        </StackPanel>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vm:LocationVM}">
        <Border x:Name="br_Main" Style="{StaticResource S_Border_Selector}"
                    bhvrs:DragDropBehavior.DragEnabled="true"
                    bhvrs:LoadUnloadExtBehavior.LoadedCommand="{Binding RegisterCommand, UpdateSourceTrigger=PropertyChanged}"
                    bhvrs:LoadUnloadExtBehavior.UnloadedCommand="{Binding UnregisterCommand, UpdateSourceTrigger=PropertyChanged}">
            <Border.InputBindings>
                <MouseBinding Gesture="LeftClick" Command="{Binding Path=DataContext.SelectCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=ItemsControl}}" CommandParameter="{Binding}"></MouseBinding>
            </Border.InputBindings>
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="auto"></ColumnDefinition>
                    <ColumnDefinition Width="*"></ColumnDefinition>
                    <ColumnDefinition Width="auto"></ColumnDefinition>
                </Grid.ColumnDefinitions>
                <TextBlock Text="{StaticResource String_Icon_Location}" Style="{StaticResource S_TextBlock_Selector_Icon}"></TextBlock>
                <TextBlock Grid.Column="1" Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource S_TextBlock_Selector_Name}"></TextBlock>
                <TextBlock Grid.Column="2" Style="{StaticResource S_TextBlock_Selector_Cut}"></TextBlock>
            </Grid>
        </Border>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vm:LocationEditorVM}">
        <StackPanel Orientation="Vertical">
            <TextBox Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource S_TextBox_Prop}" Tag="{DynamicResource String_Tag_Name}"></TextBox>
            <TextBox Text="{Binding Description, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource S_TextBox_Prop_Multiline}" Tag="{DynamicResource String_Tag_Description}"></TextBox>
        </StackPanel>
    </DataTemplate>

    <DataTemplate DataType="{x:Type m:LocationM}">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="auto"></ColumnDefinition>
                <ColumnDefinition Width="*"></ColumnDefinition>
            </Grid.ColumnDefinitions>
            <TextBlock Text="{StaticResource String_Icon_Location}" Style="{StaticResource S_TextBlock_Selector_Icon}"></TextBlock>
            <TextBlock Grid.Column="1" Text="{Binding name, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource S_TextBlock_Selector_Name}"></TextBlock>
        </Grid>
    </DataTemplate>
    
    <DataTemplate DataType="{x:Type vm:CharacterVM}">
        <Border x:Name="br_Main" Style="{StaticResource S_Border_Selector}"
                    bhvrs:DragDropBehavior.DragEnabled="true"
                    bhvrs:LoadUnloadExtBehavior.LoadedCommand="{Binding RegisterCommand, UpdateSourceTrigger=PropertyChanged}"
                    bhvrs:LoadUnloadExtBehavior.UnloadedCommand="{Binding UnregisterCommand, UpdateSourceTrigger=PropertyChanged}">
            <Border.InputBindings>
                <MouseBinding Gesture="LeftClick" Command="{Binding Path=DataContext.SelectCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=ItemsControl}}" CommandParameter="{Binding}"></MouseBinding>
            </Border.InputBindings>
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="auto"></ColumnDefinition>
                    <ColumnDefinition Width="*"></ColumnDefinition>
                    <ColumnDefinition Width="auto"></ColumnDefinition>
                </Grid.ColumnDefinitions>
                <TextBlock Text="{StaticResource String_Icon_Character}" Style="{StaticResource S_TextBlock_Selector_Icon}"></TextBlock>
                <TextBlock Grid.Column="1" Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource S_TextBlock_Selector_Name}"></TextBlock>
                <TextBlock Grid.Column="2" Style="{StaticResource S_TextBlock_Selector_Cut}"></TextBlock>
            </Grid>
        </Border>
    </DataTemplate>

    <DataTemplate DataType="{x:Type m:CharacterM}">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="auto"></ColumnDefinition>
                <ColumnDefinition Width="*"></ColumnDefinition>
            </Grid.ColumnDefinitions>
            <TextBlock Text="{StaticResource String_Icon_Character}" Style="{StaticResource S_TextBlock_Selector_Icon}"></TextBlock>
            <TextBlock Grid.Column="1" Text="{Binding name, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource S_TextBlock_Selector_Name}"></TextBlock>
        </Grid>
    </DataTemplate>

    <DataTemplate DataType="{x:Type m:ItemM}">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="auto"></ColumnDefinition>
                <ColumnDefinition Width="*"></ColumnDefinition>
            </Grid.ColumnDefinitions>
            <TextBlock Text="{StaticResource String_Icon_Item}" Style="{StaticResource S_TextBlock_Selector_Icon}"></TextBlock>
            <TextBlock Grid.Column="1" Text="{Binding name, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource S_TextBlock_Selector_Name}"></TextBlock>
        </Grid>
    </DataTemplate>

    <DataTemplate DataType="{x:Type m:ActorM}">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="auto"></ColumnDefinition>
                <ColumnDefinition Width="*"></ColumnDefinition>
            </Grid.ColumnDefinitions>
            <TextBlock Text="{StaticResource String_Icon_Actor}" Style="{StaticResource S_TextBlock_Selector_Icon}"></TextBlock>
            <TextBlock Grid.Column="1" Text="{Binding name, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource S_TextBlock_Selector_Name}"></TextBlock>
        </Grid>
    </DataTemplate>

    <DataTemplate DataType="{x:Type mg:DialogM}">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="auto"></ColumnDefinition>
                <ColumnDefinition Width="*"></ColumnDefinition>
            </Grid.ColumnDefinitions>
            <TextBlock Text="{StaticResource String_Icon_Dialog}" Style="{StaticResource S_TextBlock_Selector_Icon}"></TextBlock>
            <TextBlock Grid.Column="1" Text="{Binding name, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource S_TextBlock_Selector_Name}"></TextBlock>
        </Grid>
    </DataTemplate>

    <DataTemplate DataType="{x:Type mg:ReplicaM}">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="auto"></ColumnDefinition>
                <ColumnDefinition Width="*"></ColumnDefinition>
            </Grid.ColumnDefinitions>
            <TextBlock Text="{StaticResource String_Icon_Replica}" Style="{StaticResource S_TextBlock_Selector_Icon}"></TextBlock>
            <TextBlock Grid.Column="1" Text="{Binding name, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource S_TextBlock_Selector_Name}"></TextBlock>
        </Grid>
    </DataTemplate>

    <DataTemplate DataType="{x:Type mg:QuestM}">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="auto"></ColumnDefinition>
                <ColumnDefinition Width="*"></ColumnDefinition>
            </Grid.ColumnDefinitions>
            <TextBlock Text="{StaticResource String_Icon_Quest}" Style="{StaticResource S_TextBlock_Selector_Icon}"></TextBlock>
            <TextBlock Grid.Column="1" Text="{Binding name, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource S_TextBlock_Selector_Name}"></TextBlock>
        </Grid>
    </DataTemplate>

    <DataTemplate DataType="{x:Type mn:Node_TransitM}">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="auto"></ColumnDefinition>
                <ColumnDefinition Width="*"></ColumnDefinition>
            </Grid.ColumnDefinitions>
            <TextBlock Text="{StaticResource String_Icon_Node_Transit}" Style="{StaticResource S_TextBlock_Selector_Icon_Mini}"></TextBlock>
            <TextBlock Grid.Column="1" Text="{Binding id, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource S_TextBlock_Selector_Name_Mini}"></TextBlock>
        </Grid>
    </DataTemplate>

    <DataTemplate DataType="{x:Type mn:Node_GateM}">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="auto"></ColumnDefinition>
                <ColumnDefinition Width="*"></ColumnDefinition>
            </Grid.ColumnDefinitions>
            <TextBlock Text="{StaticResource String_Icon_Node_Gate}" Style="{StaticResource S_TextBlock_Selector_Icon_Mini}"></TextBlock>
            <TextBlock Grid.Column="1" Style="{StaticResource S_TextBlock_Selector_Name_Mini}">
                <Run Text="{Binding name, UpdateSourceTrigger=PropertyChanged}"></Run>
                <Run Text="["></Run>
                <Run Text="{StaticResource String_Icon_Node_Exit}"></Run>
                <Run Text="{Binding description, UpdateSourceTrigger=PropertyChanged}"></Run>
                <Run Text="]"></Run>
            </TextBlock>
        </Grid>
    </DataTemplate>

    <DataTemplate DataType="{x:Type mn:Node_ExitM}">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="auto"></ColumnDefinition>
                <ColumnDefinition Width="*"></ColumnDefinition>
            </Grid.ColumnDefinitions>
            <TextBlock Text="{StaticResource String_Icon_Node_Exit}" Style="{StaticResource S_TextBlock_Selector_Icon_Mini}"></TextBlock>
            <TextBlock Grid.Column="1" Text="{Binding name, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource S_TextBlock_Selector_Name_Mini}"></TextBlock>
        </Grid>
    </DataTemplate>
    
    <DataTemplate DataType="{x:Type mn:Node_RandomM}">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="auto"></ColumnDefinition>
                <ColumnDefinition Width="*"></ColumnDefinition>
            </Grid.ColumnDefinitions>
            <TextBlock Text="{StaticResource String_Icon_Node_Random}" Style="{StaticResource S_TextBlock_Selector_Icon_Mini}"></TextBlock>
            <TextBlock Grid.Column="1" Text="{Binding id, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource S_TextBlock_Selector_Name_Mini}"></TextBlock>
        </Grid>
    </DataTemplate>
    
    <DataTemplate DataType="{x:Type mn:Node_StepM}">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="auto"></ColumnDefinition>
                <ColumnDefinition Width="*"></ColumnDefinition>
            </Grid.ColumnDefinitions>
            <TextBlock Text="{StaticResource String_Icon_Node_Step}" Style="{StaticResource S_TextBlock_Selector_Icon_Mini}"></TextBlock>
            <TextBlock Grid.Column="1" Text="{Binding name, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource S_TextBlock_Selector_Name_Mini}"></TextBlock>
        </Grid>
    </DataTemplate>

    <DataTemplate DataType="{x:Type mn:Node_AlternativeM}">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="auto"></ColumnDefinition>
                <ColumnDefinition Width="*"></ColumnDefinition>
            </Grid.ColumnDefinitions>
            <TextBlock Text="{StaticResource String_Icon_Node_Alternative}" Style="{StaticResource S_TextBlock_Selector_Icon_Mini}"></TextBlock>
            <TextBlock Grid.Column="1" Text="{Binding name, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource S_TextBlock_Selector_Name_Mini}"></TextBlock>
        </Grid>
    </DataTemplate>

    <DataTemplate DataType="{x:Type mn:Node_ReplicaM}">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="auto"></ColumnDefinition>
                <ColumnDefinition Width="*"></ColumnDefinition>
            </Grid.ColumnDefinitions>
            <TextBlock Text="{StaticResource String_Icon_Node_Replica}" Style="{StaticResource S_TextBlock_Selector_Icon_Mini}"></TextBlock>
            <TextBlock Grid.Column="1" Text="{Binding name, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource S_TextBlock_Selector_Name_Mini}"></TextBlock>
        </Grid>
    </DataTemplate>

    <DataTemplate DataType="{x:Type mn:Node_DialogM}">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="auto"></ColumnDefinition>
                <ColumnDefinition Width="*"></ColumnDefinition>
            </Grid.ColumnDefinitions>
            <TextBlock Text="{StaticResource String_Icon_Node_Dialog}" Style="{StaticResource S_TextBlock_Selector_Icon_Mini}"></TextBlock>
            <TextBlock Grid.Column="1" Text="{Binding name, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource S_TextBlock_Selector_Name_Mini}"></TextBlock>
        </Grid>
    </DataTemplate>
    
    <DataTemplate DataType="{x:Type mn:Node_DelayM}">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="auto"></ColumnDefinition>
                <ColumnDefinition Width="*"></ColumnDefinition>
            </Grid.ColumnDefinitions>
            <TextBlock Text="{StaticResource String_Icon_Node_Delay}" Style="{StaticResource S_TextBlock_Selector_Icon_Mini}"></TextBlock>
            <TextBlock Grid.Column="1" Text="{Binding id, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource S_TextBlock_Selector_Name_Mini}"></TextBlock>
        </Grid>
    </DataTemplate>
    
    <DataTemplate DataType="{x:Type vm:CharacterEditorVM}">
        <StackPanel Orientation="Vertical">
            <TextBox Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource S_TextBox_Prop}" Tag="{DynamicResource String_Tag_Name}"></TextBox>
            <CheckBox x:Name="cb_HasDescriptionFemale" IsChecked="{Binding HasDescriptionFemale, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource S_CheckBox_Prop}" Tag="{DynamicResource String_Tag_HasDescriptionFemale}"></CheckBox>
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"></ColumnDefinition>
                    <ColumnDefinition x:Name="cd_DescriptionFemale" Width="0"></ColumnDefinition>
                </Grid.ColumnDefinitions>
                <GroupBox x:Name="gb_Description" Style="{StaticResource S_GroupBox_Prop}" Header="{DynamicResource String_Tag_Description}" HeaderTemplate="{StaticResource DT_GroupBox_HeaderTemplate_Prop_Rich}">
                    <controls:RichTextBoxWithSource VerticalScrollBarVisibility="Auto" MaxHeight="{StaticResource Double_RichTextBox_MaxHeight}" MinHeight="{StaticResource Double_Node_MinHeight}" x:Name="rtDescription" RtVersion="{Binding RtDescriptionVersion, UpdateSourceTrigger=PropertyChanged}" DataContext="{Binding}"></controls:RichTextBoxWithSource>
                </GroupBox>
                <GroupBox Grid.Column="1" Style="{StaticResource S_GroupBox_Prop}" Header="{DynamicResource String_Tag_DescriptionFemale}" HeaderTemplate="{StaticResource DT_GroupBox_HeaderTemplate_Prop_Rich}">
                    <controls:RichTextBoxWithSource VerticalScrollBarVisibility="Auto" MaxHeight="{StaticResource Double_RichTextBox_MaxHeight}" MinHeight="{StaticResource Double_Node_MinHeight}" x:Name="rtDescriptionFemale" RtVersion="{Binding RtDescriptionFemaleVersion, UpdateSourceTrigger=PropertyChanged}" DataContext="{Binding}"></controls:RichTextBoxWithSource>
                </GroupBox>
            </Grid>

            <GroupBox
                x:Name="gb_Relation"
                Style="{StaticResource S_GroupBox_Prop}"
                Header="{DynamicResource String_Tag_Relation}"
                HeaderTemplate="{StaticResource DT_GroupBox_HeaderTemplate_Prop}">
                <Grid HorizontalAlignment="Left">
                    <Grid.RowDefinitions>
                        <RowDefinition></RowDefinition>
                        <RowDefinition></RowDefinition>
                    </Grid.RowDefinitions>
                    <TextBlock
                        HorizontalAlignment="Center"
                        Text="{Binding InitialRelation, UpdateSourceTrigger=PropertyChanged, StringFormat=N2}"
                        Style="{StaticResource S_TextBlock_Graph_Bold}"
                        ></TextBlock>
                    <Slider
                        Grid.Row="1"
                        Width="{StaticResource Double_Slider_MaxWidth}"
                        Value="{Binding InitialRelation, UpdateSourceTrigger=PropertyChanged}"
                        Minimum="{StaticResource Double_Relation_Min}"
                        Maximum="{StaticResource Double_Relation_Max}"
                        TickFrequency="{StaticResource Double_Relation_Tick}"
                        ></Slider>
                </Grid>
            </GroupBox>

            <GroupBox
                x:Name="gb_RelationFemale"
                Style="{StaticResource S_GroupBox_Prop}"
                Header="{DynamicResource String_Tag_RelationFemale}"
                HeaderTemplate="{StaticResource DT_GroupBox_HeaderTemplate_Prop}">
                <Grid HorizontalAlignment="Left">
                    <Grid.RowDefinitions>
                        <RowDefinition></RowDefinition>
                        <RowDefinition></RowDefinition>
                    </Grid.RowDefinitions>
                    <TextBlock
                        HorizontalAlignment="Center"
                        Text="{Binding InitialRelationFemale, UpdateSourceTrigger=PropertyChanged, StringFormat=N2}"
                        Style="{StaticResource S_TextBlock_Graph_Bold}"
                        ></TextBlock>
                    <Slider
                        Grid.Row="1"
                        Width="{StaticResource Double_Slider_MaxWidth}"
                        Value="{Binding InitialRelationFemale, UpdateSourceTrigger=PropertyChanged}"
                        Minimum="{StaticResource Double_Relation_Min}"
                        Maximum="{StaticResource Double_Relation_Max}"
                        TickFrequency="{StaticResource Double_Relation_Tick}"
                        ></Slider>
                </Grid>
            </GroupBox>
        </StackPanel>
        <DataTemplate.Triggers>
            <Trigger SourceName="cb_HasDescriptionFemale" Property="IsChecked" Value="true">
                <Setter TargetName="gb_Description" Property="Header" Value="{DynamicResource String_Tag_DescriptionMale}"></Setter>
                <Setter TargetName="cd_DescriptionFemale" Property="Width" Value="*"></Setter>
            </Trigger>
            <DataTrigger Binding="{Binding Id, Mode=OneTime}" Value="{x:Static m:CharacterM.PLAYER_ID}">
                <Setter TargetName="gb_Relation" Property="Visibility" Value="Collapsed"></Setter>
                <Setter TargetName="gb_RelationFemale" Property="Visibility" Value="Collapsed"></Setter>
            </DataTrigger>
        </DataTemplate.Triggers>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vm:ActorVM}">
        <Border x:Name="br_Main" Style="{StaticResource S_Border_Selector}"
                    bhvrs:DragDropBehavior.DragEnabled="true"
                    bhvrs:LoadUnloadExtBehavior.LoadedCommand="{Binding RegisterCommand, UpdateSourceTrigger=PropertyChanged}"
                    bhvrs:LoadUnloadExtBehavior.UnloadedCommand="{Binding UnregisterCommand, UpdateSourceTrigger=PropertyChanged}">
            <Border.InputBindings>
                <MouseBinding Gesture="LeftClick" Command="{Binding Path=DataContext.SelectCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=ItemsControl}}" CommandParameter="{Binding}"></MouseBinding>
            </Border.InputBindings>
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="auto"></ColumnDefinition>
                    <ColumnDefinition Width="*"></ColumnDefinition>
                    <ColumnDefinition Width="auto"></ColumnDefinition>
                </Grid.ColumnDefinitions>
                <TextBlock Text="{StaticResource String_Icon_Actor}" Style="{StaticResource S_TextBlock_Selector_Icon}"></TextBlock>
                <TextBlock Grid.Column="1" Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource S_TextBlock_Selector_Name}"></TextBlock>
                <TextBlock Grid.Column="2" Style="{StaticResource S_TextBlock_Selector_Cut}"></TextBlock>
            </Grid>
        </Border>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vm:ActorEditorVM}">
        <StackPanel Orientation="Vertical">
            <TextBox Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource S_TextBox_Prop}" Tag="{DynamicResource String_Tag_Name}"></TextBox>
            <CheckBox x:Name="cb_HasDescriptionFemale" IsChecked="{Binding HasDescriptionFemale, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource S_CheckBox_Prop}" Tag="{DynamicResource String_Tag_HasDescriptionFemale}"></CheckBox>
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"></ColumnDefinition>
                    <ColumnDefinition x:Name="cd_DescriptionFemale" Width="0"></ColumnDefinition>
                </Grid.ColumnDefinitions>
                <GroupBox x:Name="gb_Description" Style="{StaticResource S_GroupBox_Prop}" Header="{DynamicResource String_Tag_Description}" HeaderTemplate="{StaticResource DT_GroupBox_HeaderTemplate_Prop_Rich}">
                    <controls:RichTextBoxWithSource VerticalScrollBarVisibility="Auto" MaxHeight="{StaticResource Double_RichTextBox_MaxHeight}" MinHeight="{StaticResource Double_Node_MinHeight}" x:Name="rtDescription" RtVersion="{Binding RtDescriptionVersion, UpdateSourceTrigger=PropertyChanged}" DataContext="{Binding}"></controls:RichTextBoxWithSource>
                </GroupBox>
                <GroupBox Grid.Column="1" Style="{StaticResource S_GroupBox_Prop}" Header="{DynamicResource String_Tag_DescriptionFemale}" HeaderTemplate="{StaticResource DT_GroupBox_HeaderTemplate_Prop_Rich}">
                    <controls:RichTextBoxWithSource VerticalScrollBarVisibility="Auto" MaxHeight="{StaticResource Double_RichTextBox_MaxHeight}" MinHeight="{StaticResource Double_Node_MinHeight}" x:Name="rtDescriptionFemale" RtVersion="{Binding RtDescriptionFemaleVersion, UpdateSourceTrigger=PropertyChanged}" DataContext="{Binding}"></controls:RichTextBoxWithSource>
                </GroupBox>
            </Grid>
        </StackPanel>
        <DataTemplate.Triggers>
            <Trigger SourceName="cb_HasDescriptionFemale" Property="IsChecked" Value="true">
                <Setter TargetName="gb_Description" Property="Header" Value="{DynamicResource String_Tag_DescriptionMale}"></Setter>
                <Setter TargetName="cd_DescriptionFemale" Property="Width" Value="*"></Setter>
            </Trigger>
        </DataTemplate.Triggers>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vm:ItemVM}">
        <Border x:Name="br_Main" Style="{StaticResource S_Border_Selector}"
                    bhvrs:DragDropBehavior.DragEnabled="true"
                    bhvrs:LoadUnloadExtBehavior.LoadedCommand="{Binding RegisterCommand, UpdateSourceTrigger=PropertyChanged}"
                    bhvrs:LoadUnloadExtBehavior.UnloadedCommand="{Binding UnregisterCommand, UpdateSourceTrigger=PropertyChanged}">
            <Border.InputBindings>
                <MouseBinding Gesture="LeftClick" Command="{Binding Path=DataContext.SelectCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=ItemsControl}}" CommandParameter="{Binding}"></MouseBinding>
            </Border.InputBindings>
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="auto"></ColumnDefinition>
                    <ColumnDefinition Width="*"></ColumnDefinition>
                    <ColumnDefinition Width="auto"></ColumnDefinition>
                </Grid.ColumnDefinitions>
                <TextBlock Text="{StaticResource String_Icon_Item}" Style="{StaticResource S_TextBlock_Selector_Icon}"></TextBlock>
                <TextBlock Grid.Column="1" Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource S_TextBlock_Selector_Name}"></TextBlock>
                <TextBlock Grid.Column="2" Style="{StaticResource S_TextBlock_Selector_Cut}"></TextBlock>
            </Grid>
        </Border>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vm:ItemEditorVM}">
        <StackPanel Orientation="Vertical">
            <TextBox Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource S_TextBox_Prop}" Tag="{DynamicResource String_Tag_Name}"></TextBox>
            <CheckBox x:Name="cb_HasDescriptionFemale" IsChecked="{Binding HasDescriptionFemale, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource S_CheckBox_Prop}" Tag="{DynamicResource String_Tag_HasDescriptionFemale}"></CheckBox>
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"></ColumnDefinition>
                    <ColumnDefinition x:Name="cd_DescriptionFemale" Width="0"></ColumnDefinition>
                </Grid.ColumnDefinitions>
                <GroupBox x:Name="gb_Description" Style="{StaticResource S_GroupBox_Prop}" Header="{DynamicResource String_Tag_Description}" HeaderTemplate="{StaticResource DT_GroupBox_HeaderTemplate_Prop_Rich}">
                    <controls:RichTextBoxWithSource VerticalScrollBarVisibility="Auto" MaxHeight="{StaticResource Double_RichTextBox_MaxHeight}" MinHeight="{StaticResource Double_Node_MinHeight}" x:Name="rtDescription" RtVersion="{Binding RtDescriptionVersion, UpdateSourceTrigger=PropertyChanged}" DataContext="{Binding}"></controls:RichTextBoxWithSource>
                </GroupBox>
                <GroupBox Grid.Column="1" Style="{StaticResource S_GroupBox_Prop}" Header="{DynamicResource String_Tag_DescriptionFemale}" HeaderTemplate="{StaticResource DT_GroupBox_HeaderTemplate_Prop_Rich}">
                    <controls:RichTextBoxWithSource VerticalScrollBarVisibility="Auto" MaxHeight="{StaticResource Double_RichTextBox_MaxHeight}" MinHeight="{StaticResource Double_Node_MinHeight}" x:Name="rtDescriptionFemale" RtVersion="{Binding RtDescriptionFemaleVersion, UpdateSourceTrigger=PropertyChanged}" DataContext="{Binding}"></controls:RichTextBoxWithSource>
                </GroupBox>
            </Grid>

            <CheckBox x:Name="cb_HasInternalDescription" IsChecked="{Binding HasInternalDescription, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource S_CheckBox_Prop}" Tag="{DynamicResource String_Tag_HasInternalDescription}"></CheckBox>
            <CheckBox x:Name="cb_HasInternalDescriptionFemale" IsChecked="{Binding HasInternalDescriptionFemale, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource S_CheckBox_Prop}" Tag="{DynamicResource String_Tag_HasInternalDescriptionFemale}"></CheckBox>
            <Grid x:Name="gr_InternalDescription">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"></ColumnDefinition>
                    <ColumnDefinition x:Name="cd_InternalDescriptionFemale" Width="0"></ColumnDefinition>
                </Grid.ColumnDefinitions>
                <GroupBox x:Name="gb_InternalDescription" Style="{StaticResource S_GroupBox_Prop}" Header="{DynamicResource String_Tag_InternalDescription}" HeaderTemplate="{StaticResource DT_GroupBox_HeaderTemplate_Prop_Rich}">
                    <controls:RichTextBoxWithSource VerticalScrollBarVisibility="Auto" MaxHeight="{StaticResource Double_RichTextBox_MaxHeight}" MinHeight="{StaticResource Double_Node_MinHeight}" x:Name="rtInternalDescription" RtVersion="{Binding RtInternalDescriptionVersion, UpdateSourceTrigger=PropertyChanged}" DataContext="{Binding}"></controls:RichTextBoxWithSource>
                </GroupBox>
                <GroupBox Grid.Column="1" Style="{StaticResource S_GroupBox_Prop}" Header="{DynamicResource String_Tag_InternalDescriptionFemale}" HeaderTemplate="{StaticResource DT_GroupBox_HeaderTemplate_Prop_Rich}">
                    <controls:RichTextBoxWithSource VerticalScrollBarVisibility="Auto" MaxHeight="{StaticResource Double_RichTextBox_MaxHeight}" MinHeight="{StaticResource Double_Node_MinHeight}" x:Name="rtInternalDescriptionFemale" RtVersion="{Binding RtInternalDescriptionFemaleVersion, UpdateSourceTrigger=PropertyChanged}" DataContext="{Binding}"></controls:RichTextBoxWithSource>
                </GroupBox>
            </Grid>
        </StackPanel>
        <DataTemplate.Triggers>
            <Trigger SourceName="cb_HasDescriptionFemale" Property="IsChecked" Value="true">
                <Setter TargetName="gb_Description" Property="Header" Value="{DynamicResource String_Tag_DescriptionMale}"></Setter>
                <Setter TargetName="cd_DescriptionFemale" Property="Width" Value="*"></Setter>
            </Trigger>
            <Trigger SourceName="cb_HasInternalDescription" Property="IsChecked" Value="false">
                <Setter TargetName="cb_HasInternalDescriptionFemale" Property="Visibility" Value="Collapsed"></Setter>
                <Setter TargetName="gr_InternalDescription" Property="Visibility" Value="Collapsed"></Setter>
            </Trigger>
            <Trigger SourceName="cb_HasInternalDescriptionFemale" Property="IsChecked" Value="true">
                <Setter TargetName="gb_InternalDescription" Property="Header" Value="{DynamicResource String_Tag_InternalDescriptionMale}"></Setter>
                <Setter TargetName="cd_InternalDescriptionFemale" Property="Width" Value="*"></Setter>
            </Trigger>
        </DataTemplate.Triggers>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vmg:QuestVM}">
        <Border x:Name="br_Main" Style="{StaticResource S_Border_Selector}"
                    bhvrs:DragDropBehavior.DragEnabled="true"
                    bhvrs:LoadUnloadExtBehavior.LoadedCommand="{Binding RegisterCommand, UpdateSourceTrigger=PropertyChanged}"
                    bhvrs:LoadUnloadExtBehavior.UnloadedCommand="{Binding UnregisterCommand, UpdateSourceTrigger=PropertyChanged}">
            <Border.InputBindings>
                <MouseBinding Gesture="LeftClick" Command="{Binding Path=DataContext.SelectCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=ItemsControl}}" CommandParameter="{Binding}"></MouseBinding>
                <MouseBinding Gesture="RightClick" Command="{Binding InfoCommand}" CommandParameter="{Binding}"></MouseBinding>
            </Border.InputBindings>
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="auto"></ColumnDefinition>
                    <ColumnDefinition Width="*"></ColumnDefinition>
                    <ColumnDefinition Width="auto"></ColumnDefinition>
                </Grid.ColumnDefinitions>
                <TextBlock Text="{StaticResource String_Icon_Quest}" Style="{StaticResource S_TextBlock_Selector_Icon}"></TextBlock>
                <TextBlock Grid.Column="1" Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource S_TextBlock_Selector_Name}"></TextBlock>
                <TextBlock Grid.Column="2" Style="{StaticResource S_TextBlock_Selector_Cut}"></TextBlock>
            </Grid>
        </Border>
    </DataTemplate>

    <ControlTemplate TargetType="ContentControl" x:Key="CT_ContentControl_NodePosition">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition MinWidth="{StaticResource Double_TextBox_Graph_MinWidth}" Width="*"></ColumnDefinition>
                <ColumnDefinition MinWidth="{StaticResource Double_TextBox_Graph_MinWidth}" Width="*"></ColumnDefinition>
            </Grid.ColumnDefinitions>
            <TextBox Grid.Column="0" x:Name="tb_SelectionNodePositionX" Style="{StaticResource S_TextBox_Graph}" Text="{Binding SelectionNode.PositionX, UpdateSourceTrigger=PropertyChanged, StringFormat=N0}" ></TextBox>
            <TextBox Grid.Column="1" x:Name="tb_SelectionNodePositionY" Style="{StaticResource S_TextBox_Graph}" Text="{Binding SelectionNode.PositionY, UpdateSourceTrigger=PropertyChanged, StringFormat=N0}" ></TextBox>
        </Grid>
        <ControlTemplate.Triggers>
            <DataTrigger Binding="{Binding SelectionNode, UpdateSourceTrigger=PropertyChanged}" Value="{x:Null}">
                <Setter TargetName="tb_SelectionNodePositionX" Property="Visibility" Value="Collapsed"></Setter>
                <Setter TargetName="tb_SelectionNodePositionY" Property="Visibility" Value="Collapsed"></Setter>
            </DataTrigger>
        </ControlTemplate.Triggers>
    </ControlTemplate>
    
    <DataTemplate DataType="{x:Type vmg:QuestEditorVM}">
        <TabControl Padding="0" Margin="0">
            <TabItem Header="{DynamicResource String_Tag_Graph_Tab_View}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="7*"></ColumnDefinition>
                        <ColumnDefinition Width="auto"></ColumnDefinition>
                        <ColumnDefinition Width="3*"></ColumnDefinition>
                    </Grid.ColumnDefinitions>

                    <ItemsControl Style="{StaticResource S_ItemsControl_Graph}"
                                  bhvrs:RenderSizeBehavior.IsEnabled="true"
                                  bhvrs:RenderSizeBehavior.ActualWidth="{Binding Path=(vm:ActiveContext.ViewWidth), UpdateSourceTrigger=PropertyChanged, Mode=OneWayToSource}"
                                  bhvrs:RenderSizeBehavior.ActualHeight="{Binding Path=(vm:ActiveContext.ViewHeight), UpdateSourceTrigger=PropertyChanged, Mode=OneWayToSource}"
                                  bhvrs:RenderSizeBehavior.SizeChangedFlag="{Binding SizeChangedFlag, UpdateSourceTrigger=PropertyChanged, Mode=OneWayToSource}">
                    </ItemsControl>

                    <Grid HorizontalAlignment="Left" VerticalAlignment="Top">
                        <Grid.RowDefinitions>
                            <RowDefinition></RowDefinition>
                            <RowDefinition></RowDefinition>
                        </Grid.RowDefinitions>

                        <StackPanel Orientation="Horizontal">
                            <Button x:Name="btn_selectable_Step" Style="{StaticResource S_Button_Square_24x}" Content="{StaticResource String_Icon_Node_Step}" Command="{Binding SelectNodeTypeCommand}" CommandParameter="{x:Type mn:Node_StepM}" ToolTip="{DynamicResource String_Tag_Node_Step_Type}"></Button>
                            <Button x:Name="btn_selectable_Alternative" Style="{StaticResource S_Button_Square_24x}" Content="{StaticResource String_Icon_Node_Alternative}" Command="{Binding SelectNodeTypeCommand}" CommandParameter="{x:Type mn:Node_AlternativeM}" ToolTip="{DynamicResource String_Tag_Node_Alternative_Type}"></Button>
                            <Rectangle Style="{StaticResource S_Rectangle_GraphMenu}"></Rectangle>
                            <Button Style="{StaticResource S_Button_Square_24x}" Content="{StaticResource String_Icon_Bwd}" Command="{Binding PrevRootNodeCommand}" ToolTip="{DynamicResource String_GraphMenu_PrevRootNode_Tooltip}"></Button>
                            <Button Style="{StaticResource S_Button_Square_24x}" Content="{StaticResource String_Icon_Fwd}" Command="{Binding NextRootNodeCommand}" ToolTip="{DynamicResource String_GraphMenu_NextRootNode_Tooltip}"></Button>
                            <Rectangle Style="{StaticResource S_Rectangle_GraphMenu}"></Rectangle>
                            <Button Style="{StaticResource S_Button_Square_24x}" Content="{StaticResource String_Icon_Graph_Origin}" Command="{Binding GoToOriginCommand}" ToolTip="{DynamicResource String_GraphMenu_GoToOrigin_Tooltip}"></Button>
                            <Button Style="{StaticResource S_Button_Square_24x}" Content="{StaticResource String_Icon_Graph_Reset}" Command="{Binding ResetScaleCommand}" ToolTip="{DynamicResource String_GraphMenu_ResetScale_Tooltip}"></Button>
                        </StackPanel>

                        <TextBlock Grid.Row="1" Style="{StaticResource S_TextBlock_Graph_Bold}" Margin="{StaticResource Thickness_Margin_2x}">
                            <Run x:Name="r_SelectedNodeType"></Run>
                            <Run Text="{Binding Scale, UpdateSourceTrigger=PropertyChanged, StringFormat=N2}"></Run>
                            <Run Text="("></Run>
                            <Run Text="{Binding OffsetX, UpdateSourceTrigger=PropertyChanged, StringFormat=N0}"></Run>
                            <Run Text=","></Run>
                            <Run Text="{Binding OffsetY, UpdateSourceTrigger=PropertyChanged, StringFormat=N0}"></Run>
                            <Run Text=")"></Run>
                        </TextBlock>
                    </Grid>

                    <ContentControl Content="{Binding}" HorizontalAlignment="Right" VerticalAlignment="Top" Template="{StaticResource CT_ContentControl_NodePosition}"></ContentControl>

                    <GridSplitter Grid.Column="1"></GridSplitter>

                    <ContentControl Grid.Column="2" Content="{Binding SelectionEditor, UpdateSourceTrigger=PropertyChanged}"></ContentControl>
                </Grid>
            </TabItem>
            <TabItem Header="{DynamicResource String_Tag_Graph_Tab_Props}">
                <StackPanel Orientation="Vertical">
                    <TextBox Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource S_TextBox_Prop}" Tag="{DynamicResource String_Tag_Name}"></TextBox>
                    <TextBox Text="{Binding Description, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource S_TextBox_Prop_Multiline}" Tag="{DynamicResource String_Tag_Description}"></TextBox>
                </StackPanel>
            </TabItem>
        </TabControl>
        <DataTemplate.Triggers>
            <DataTrigger Binding="{Binding SelectedNodeType, UpdateSourceTrigger=PropertyChanged}" Value="{x:Type mn:Node_StepM}">
                <Setter TargetName="btn_selectable_Step" Property="Style" Value="{StaticResource S_Button_24x_Selected}"></Setter>
                <Setter TargetName="r_SelectedNodeType" Property="Text" Value="{DynamicResource String_Tag_Node_Step_Type}"></Setter>
            </DataTrigger>
            <DataTrigger Binding="{Binding SelectedNodeType, UpdateSourceTrigger=PropertyChanged}" Value="{x:Type mn:Node_AlternativeM}">
                <Setter TargetName="btn_selectable_Alternative" Property="Style" Value="{StaticResource S_Button_24x_Selected}"></Setter>
                <Setter TargetName="r_SelectedNodeType" Property="Text" Value="{DynamicResource String_Tag_Node_Alternative_Type}"></Setter>
            </DataTrigger>
        </DataTemplate.Triggers>
    </DataTemplate>

    <DataTemplate x:Key="Node_Journal_StepVM_ItemTemplate">
        <Grid>
            <Border Style="{StaticResource S_Border_Node}"
                    bhvrs:DragDropBehavior.DragEnabled="true"
                    bhvrs:LoadUnloadExtBehavior.LoadedCommand="{Binding RegisterCommand, UpdateSourceTrigger=PropertyChanged}"
                    bhvrs:LoadUnloadExtBehavior.UnloadedCommand="{Binding UnregisterCommand, UpdateSourceTrigger=PropertyChanged}">
                <ContentControl Content="{Binding}"></ContentControl>
            </Border>

            <Button Style="{StaticResource S_Button_Node_Gender}"></Button>

            <StackPanel Style="{StaticResource S_StackPanel_Node_TopRightPanel}">
                <Button Style="{StaticResource S_Button_Remove}"></Button>
            </StackPanel>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="Node_Journal_AlternativeVM_ItemTemplate">
        <Grid>
            <Border Style="{StaticResource S_Border_Node}"
                    bhvrs:LoadUnloadExtBehavior.LoadedCommand="{Binding RegisterCommand, UpdateSourceTrigger=PropertyChanged}"
                    bhvrs:LoadUnloadExtBehavior.UnloadedCommand="{Binding UnregisterCommand, UpdateSourceTrigger=PropertyChanged}">
                <ContentControl Content="{Binding}"></ContentControl>
            </Border>

            <Button Style="{StaticResource S_Button_Node_Gender}"></Button>

            <StackPanel Style="{StaticResource S_StackPanel_Node_TopRightPanel}">
                <Button Style="{StaticResource S_Button_Remove}"></Button>
            </StackPanel>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="Node_ReplicaVM_ItemTemplate">
        <Grid>
            <Border Style="{StaticResource S_Border_Node}"
                    bhvrs:LoadUnloadExtBehavior.LoadedCommand="{Binding RegisterCommand, UpdateSourceTrigger=PropertyChanged}"
                    bhvrs:LoadUnloadExtBehavior.UnloadedCommand="{Binding UnregisterCommand, UpdateSourceTrigger=PropertyChanged}">
                <ContentControl Content="{Binding}"></ContentControl>
            </Border>

            <Button Style="{StaticResource S_Button_Node_Gender}"></Button>

            <StackPanel Style="{StaticResource S_StackPanel_Node_TopRightPanel}">
                <ContentControl ContentTemplate="{StaticResource DT_HasPredicates}" Content="{Binding}"></ContentControl>
                <ContentControl ContentTemplate="{StaticResource DT_HasGameEvents}" Content="{Binding}"></ContentControl>
                <ContentControl ContentTemplate="{StaticResource DT_HasBehaviors}" Content="{Binding}"></ContentControl>
                <Button Style="{StaticResource S_Button_Remove}"></Button>
            </StackPanel>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="Node_DialogVM_ItemTemplate">
        <Grid>
            <Border Style="{StaticResource S_Border_Node}"
                    bhvrs:LoadUnloadExtBehavior.LoadedCommand="{Binding RegisterCommand, UpdateSourceTrigger=PropertyChanged}"
                    bhvrs:LoadUnloadExtBehavior.UnloadedCommand="{Binding UnregisterCommand, UpdateSourceTrigger=PropertyChanged}">
                <ContentControl Content="{Binding}"></ContentControl>
            </Border>

            <Button Style="{StaticResource S_Button_Node_Gender}"></Button>

            <StackPanel Style="{StaticResource S_StackPanel_Node_TopRightPanel}">
                <ContentControl ContentTemplate="{StaticResource DT_HasPredicates}" Content="{Binding}"></ContentControl>
                <ContentControl ContentTemplate="{StaticResource DT_HasGameEvents}" Content="{Binding}"></ContentControl>
                <ContentControl ContentTemplate="{StaticResource DT_HasBehaviors}" Content="{Binding}"></ContentControl>
                <Button Style="{StaticResource S_Button_Remove}"></Button>
            </StackPanel>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="Node_RandomVM_ItemTemplate">
        <Grid>
            <Border Style="{StaticResource S_Border_Node}"
                    bhvrs:LoadUnloadExtBehavior.LoadedCommand="{Binding RegisterCommand, UpdateSourceTrigger=PropertyChanged}"
                    bhvrs:LoadUnloadExtBehavior.UnloadedCommand="{Binding UnregisterCommand, UpdateSourceTrigger=PropertyChanged}">
                <ContentControl Content="{Binding}"></ContentControl>
            </Border>

            <Button Style="{StaticResource S_Button_Node_Gender}"></Button>

            <StackPanel Style="{StaticResource S_StackPanel_Node_TopRightPanel}">
                <ContentControl ContentTemplate="{StaticResource DT_HasPredicates}" Content="{Binding}"></ContentControl>
                <ContentControl ContentTemplate="{StaticResource DT_HasGameEvents}" Content="{Binding}"></ContentControl>
                <Button Style="{StaticResource S_Button_Remove}"></Button>
            </StackPanel>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="Node_TransitVM_ItemTemplate">
        <Grid>
            <Border Style="{StaticResource S_Border_Node}"
                    bhvrs:LoadUnloadExtBehavior.LoadedCommand="{Binding RegisterCommand, UpdateSourceTrigger=PropertyChanged}"
                    bhvrs:LoadUnloadExtBehavior.UnloadedCommand="{Binding UnregisterCommand, UpdateSourceTrigger=PropertyChanged}">
                <ContentControl Content="{Binding}"></ContentControl>
            </Border>

            <Button Style="{StaticResource S_Button_Node_Gender}"></Button>

            <StackPanel Style="{StaticResource S_StackPanel_Node_TopRightPanel}">
                <ContentControl ContentTemplate="{StaticResource DT_HasPredicates}" Content="{Binding}"></ContentControl>
                <ContentControl ContentTemplate="{StaticResource DT_HasGameEvents}" Content="{Binding}"></ContentControl>
                <Button Style="{StaticResource S_Button_Remove}"></Button>
            </StackPanel>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="Node_GateVM_ItemTemplate">
        <Grid>
            <Border Style="{StaticResource S_Border_Node}"
                    bhvrs:LoadUnloadExtBehavior.LoadedCommand="{Binding RegisterCommand, UpdateSourceTrigger=PropertyChanged}"
                    bhvrs:LoadUnloadExtBehavior.UnloadedCommand="{Binding UnregisterCommand, UpdateSourceTrigger=PropertyChanged}">
                <ContentControl Content="{Binding}"></ContentControl>
            </Border>

            <Button Style="{StaticResource S_Button_Node_Gender}"></Button>

            <StackPanel Style="{StaticResource S_StackPanel_Node_TopRightPanel}">
                <ContentControl ContentTemplate="{StaticResource DT_HasPredicates}" Content="{Binding}"></ContentControl>
                <ContentControl ContentTemplate="{StaticResource DT_HasGameEvents}" Content="{Binding}"></ContentControl>
                <Button Style="{StaticResource S_Button_Remove}"></Button>
            </StackPanel>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="Node_ExitVM_ItemTemplate">
        <Grid>
            <Border Style="{StaticResource S_Border_Node}"
                    bhvrs:LoadUnloadExtBehavior.LoadedCommand="{Binding RegisterCommand, UpdateSourceTrigger=PropertyChanged}"
                    bhvrs:LoadUnloadExtBehavior.UnloadedCommand="{Binding UnregisterCommand, UpdateSourceTrigger=PropertyChanged}">
                <ContentControl Content="{Binding}"></ContentControl>
            </Border>

            <StackPanel Style="{StaticResource S_StackPanel_Node_TopRightPanel}">
                <Button Style="{StaticResource S_Button_Remove}"></Button>
            </StackPanel>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="Node_DelayVM_ItemTemplate">
        <Grid>
            <Border Style="{StaticResource S_Border_Node}"
                    bhvrs:LoadUnloadExtBehavior.LoadedCommand="{Binding RegisterCommand, UpdateSourceTrigger=PropertyChanged}"
                    bhvrs:LoadUnloadExtBehavior.UnloadedCommand="{Binding UnregisterCommand, UpdateSourceTrigger=PropertyChanged}">
                <ContentControl Content="{Binding}"></ContentControl>
            </Border>

            <StackPanel Style="{StaticResource S_StackPanel_Node_TopRightPanel}">
                <Button Style="{StaticResource S_Button_Remove}"></Button>
            </StackPanel>
        </Grid>
    </DataTemplate>
    
    <DataTemplate DataType="{x:Type vmn:Node_Journal_StepVM}">
        <Grid IsHitTestVisible="False">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="auto"></ColumnDefinition>
                <ColumnDefinition Width="*"></ColumnDefinition>
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="auto"></RowDefinition>
                <RowDefinition></RowDefinition>
                <RowDefinition></RowDefinition>
                <RowDefinition></RowDefinition>
            </Grid.RowDefinitions>

            <TextBlock Text="{StaticResource String_Icon_Node_Step}" Style="{StaticResource S_TextBlock_Node_Icon}"></TextBlock>

            <TextBlock VerticalAlignment="Center" TextAlignment="Center" Grid.Column="1" Grid.Row="0" Style="{StaticResource S_TextBlock_Node_Header}" Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}"></TextBlock>

            <controls:TextBlockWithSource Grid.ColumnSpan="2" Grid.Row="1" x:Name="rtDescription" RtVersion="{Binding RtDescriptionVersion, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource S_TextBlock_Node_Description}" DataContext="{Binding}"></controls:TextBlockWithSource>
            
            <Separator Grid.ColumnSpan="2" Grid.Row="2"></Separator>

            <TextBlock Grid.ColumnSpan="2" Grid.Row="3" Style="{StaticResource S_TextBlock_Node_Result}" Text="{Binding Result, UpdateSourceTrigger=PropertyChanged}"></TextBlock>
        </Grid>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vmn:Node_Journal_StepEditorVM}">
        <TabControl>
            <TabItem Header="{DynamicResource String_Tag_Node_Tab_Props}">
                <Grid VerticalAlignment="Top">
                    <Grid.RowDefinitions>
                        <RowDefinition></RowDefinition>
                        <RowDefinition></RowDefinition>
                        <RowDefinition></RowDefinition>
                        <RowDefinition></RowDefinition>
                    </Grid.RowDefinitions>
                    <TextBox IsReadOnly="True" Style="{StaticResource S_TextBox_Prop}" Text="{Binding Id, Mode=OneTime}" Tag="{DynamicResource String_Tag_Node_Id}"></TextBox>
                    <TextBox Grid.Row="1" Style="{StaticResource S_TextBox_Prop}" Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" Tag="{DynamicResource String_Tag_Node_Step_Name}"></TextBox>
                    <GroupBox Grid.Row="2" Style="{StaticResource S_GroupBox_Prop}" Header="{DynamicResource String_Tag_Node_Step_Description}" HeaderTemplate="{StaticResource DT_GroupBox_HeaderTemplate_Prop_Rich}">
                        <controls:RichTextBoxWithSource VerticalScrollBarVisibility="Auto" MaxHeight="{StaticResource Double_RichTextBox_MaxHeight}" MinHeight="{StaticResource Double_Node_MinHeight}" x:Name="rtDescription" RtVersion="{Binding RtDescriptionVersion, UpdateSourceTrigger=PropertyChanged}" DataContext="{Binding}"></controls:RichTextBoxWithSource>
                    </GroupBox>
                    <TextBox Grid.Row="3" Style="{StaticResource S_TextBox_Prop_Multiline}" Text="{Binding Result, UpdateSourceTrigger=PropertyChanged}" Tag="{DynamicResource String_Tag_Node_Step_Result}"></TextBox>
                </Grid>
            </TabItem>
        </TabControl>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vmn:Node_Journal_AlternativeVM}">
        <Grid IsHitTestVisible="False">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="auto"></ColumnDefinition>
                <ColumnDefinition Width="*"></ColumnDefinition>
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="auto"></RowDefinition>
                <RowDefinition></RowDefinition>
                <RowDefinition></RowDefinition>
                <RowDefinition></RowDefinition>
            </Grid.RowDefinitions>

            <TextBlock Text="{StaticResource String_Icon_Node_Alternative}" Style="{StaticResource S_TextBlock_Node_Icon}"></TextBlock>

            <TextBlock VerticalAlignment="Center" TextAlignment="Center" Grid.Column="1" Grid.Row="0" Style="{StaticResource S_TextBlock_Node_Header}" Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}"></TextBlock>

            <controls:TextBlockWithSource Grid.ColumnSpan="2" Grid.Row="1" x:Name="rtDescription" RtVersion="{Binding RtDescriptionVersion, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource S_TextBlock_Node_Description}" DataContext="{Binding}"></controls:TextBlockWithSource>

            <Separator Grid.ColumnSpan="2" Grid.Row="2"></Separator>

            <TextBlock Grid.ColumnSpan="2" Grid.Row="3" Style="{StaticResource S_TextBlock_Node_Result}" Text="{Binding Result, UpdateSourceTrigger=PropertyChanged}"></TextBlock>
        </Grid>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vmn:Node_Journal_AlternativeEditorVM}">
        <TabControl>
            <TabItem Header="{DynamicResource String_Tag_Node_Tab_Props}">
                <Grid VerticalAlignment="Top">
                    <Grid.RowDefinitions>
                        <RowDefinition></RowDefinition>
                        <RowDefinition></RowDefinition>
                        <RowDefinition></RowDefinition>
                        <RowDefinition></RowDefinition>
                    </Grid.RowDefinitions>
                    <TextBox IsReadOnly="True" Style="{StaticResource S_TextBox_Prop}" Text="{Binding Id, Mode=OneTime}" Tag="{DynamicResource String_Tag_Node_Id}"></TextBox>
                    <TextBox Grid.Row="1" Style="{StaticResource S_TextBox_Prop}" Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" Tag="{DynamicResource String_Tag_Node_Alternative_Name}"></TextBox>
                    <GroupBox Grid.Row="2" Style="{StaticResource S_GroupBox_Prop}" Header="{DynamicResource String_Tag_Node_Alternative_Description}" HeaderTemplate="{StaticResource DT_GroupBox_HeaderTemplate_Prop_Rich}">
                        <controls:RichTextBoxWithSource VerticalScrollBarVisibility="Auto" MaxHeight="{StaticResource Double_RichTextBox_MaxHeight}" MinHeight="{StaticResource Double_Node_MinHeight}" x:Name="rtDescription" RtVersion="{Binding RtDescriptionVersion, UpdateSourceTrigger=PropertyChanged}" DataContext="{Binding}"></controls:RichTextBoxWithSource>
                    </GroupBox>
                    <TextBox Grid.Row="3" Style="{StaticResource S_TextBox_Prop_Multiline}" Text="{Binding Result, UpdateSourceTrigger=PropertyChanged}" Tag="{DynamicResource String_Tag_Node_Alternative_Result}"></TextBox>
                </Grid>
            </TabItem>
        </TabControl>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vmn:Node_RandomVM}">
        <TextBlock VerticalAlignment="Center" HorizontalAlignment="Center" Text="{StaticResource String_Icon_Node_Random}" Style="{StaticResource S_TextBlock_Node_Icon_Large}"></TextBlock>
    </DataTemplate>

    <Style TargetType="TextBlock" x:Key="S_TextBlock_InteractiveTitle" BasedOn="{StaticResource S_TextBlock}">
        <Setter Property="FontWeight" Value="Bold"></Setter>
        <Setter Property="FontSize" Value="{StaticResource FontSize_Medium}"></Setter>
        <Setter Property="Margin" Value="{StaticResource Thickness_Margin_Underline_2x}"></Setter>
        <Setter Property="TextAlignment" Value="Center"></Setter>
    </Style>

    <Style TargetType="TextBlock" x:Key="S_TextBlock_Predicate_Title" BasedOn="{StaticResource S_TextBlock_InteractiveTitle}">
        <Style.Triggers>
            <Trigger Property="Tag" Value="{x:Type mp:P_CompositeM}">
                <Setter Property="Text" Value="{DynamicResource String_Tag_Predicate_P_CompositeM_Title}"></Setter>
            </Trigger>
            <Trigger Property="Tag" Value="{x:Type mp:P_Dialog_HasM}">
                <Setter Property="Text" Value="{DynamicResource String_Tag_Predicate_P_Dialog_HasM_Title}"></Setter>
            </Trigger>
            <Trigger Property="Tag" Value="{x:Type mp:P_Dialog_Node_Has_ActiveSession_CmpM}">
                <Setter Property="Text" Value="{DynamicResource String_Tag_Predicate_P_Dialog_Node_Has_ActiveSession_CmpM_Title}"></Setter>
            </Trigger>
            <Trigger Property="Tag" Value="{x:Type mp:P_Dialog_Node_Has_ActiveSessionM}">
                <Setter Property="Text" Value="{DynamicResource String_Tag_Predicate_P_Dialog_Node_Has_ActiveSessionM_Title}"></Setter>
            </Trigger>
            <Trigger Property="Tag" Value="{x:Type mp:P_Dialog_Node_Has_PrevSessions_CmpM}">
                <Setter Property="Text" Value="{DynamicResource String_Tag_Predicate_P_Dialog_Node_Has_PrevSessions_CmpM_Title}"></Setter>
            </Trigger>
            <Trigger Property="Tag" Value="{x:Type mp:P_Dialog_Node_Has_PrevSessionsM}">
                <Setter Property="Text" Value="{DynamicResource String_Tag_Predicate_P_Dialog_Node_Has_PrevSessionsM_Title}"></Setter>
            </Trigger>
            <Trigger Property="Tag" Value="{x:Type mp:P_Item_HasM}">
                <Setter Property="Text" Value="{DynamicResource String_Tag_Predicate_P_Item_HasM_Title}"></Setter>
            </Trigger>
            <Trigger Property="Tag" Value="{x:Type mp:P_Quest_AddedM}">
                <Setter Property="Text" Value="{DynamicResource String_Tag_Predicate_P_Quest_AddedM_Title}"></Setter>
            </Trigger>
            <Trigger Property="Tag" Value="{x:Type mp:P_Quest_FinishedM}">
                <Setter Property="Text" Value="{DynamicResource String_Tag_Predicate_P_Quest_FinishedM_Title}"></Setter>
            </Trigger>
            <Trigger Property="Tag" Value="{x:Type mp:P_Quest_Node_AddedM}">
                <Setter Property="Text" Value="{DynamicResource String_Tag_Predicate_P_Quest_Node_AddedM_Title}"></Setter>
            </Trigger>
            <Trigger Property="Tag" Value="{x:Type mp:P_Quest_Node_PassedM}">
                <Setter Property="Text" Value="{DynamicResource String_Tag_Predicate_P_Quest_Node_PassedM_Title}"></Setter>
            </Trigger>
            <Trigger Property="Tag" Value="{x:Type mp:P_Relation_HasM}">
                <Setter Property="Text" Value="{DynamicResource String_Tag_Predicate_P_Relation_HasM_Title}"></Setter>
            </Trigger>
        </Style.Triggers>
    </Style>

    <Style TargetType="TextBlock" x:Key="S_TextBlock_GameEvent_Title" BasedOn="{StaticResource S_TextBlock_InteractiveTitle}">
        <Style.Triggers>
            <Trigger Property="Tag" Value="{x:Type mge:GE_CustomM}">
                <Setter Property="Text" Value="{DynamicResource String_Tag_GameEvent_GE_CustomM_Title}"></Setter>
            </Trigger>
            <Trigger Property="Tag" Value="{x:Type mge:GE_Item_DropM}">
                <Setter Property="Text" Value="{DynamicResource String_Tag_GameEvent_GE_Item_DropM_Title}"></Setter>
            </Trigger>
            <Trigger Property="Tag" Value="{x:Type mge:GE_Item_PickUpM}">
                <Setter Property="Text" Value="{DynamicResource String_Tag_GameEvent_GE_Item_PickUpM_Title}"></Setter>
            </Trigger>
            <Trigger Property="Tag" Value="{x:Type mge:GE_Quest_AddM}">
                <Setter Property="Text" Value="{DynamicResource String_Tag_GameEvent_GE_Quest_AddM_Title}"></Setter>
            </Trigger>
            <Trigger Property="Tag" Value="{x:Type mge:GE_Quest_Node_AddM}">
                <Setter Property="Text" Value="{DynamicResource String_Tag_GameEvent_GE_Quest_Node_AddM_Title}"></Setter>
            </Trigger>
            <Trigger Property="Tag" Value="{x:Type mge:GE_Quest_Node_PassM}">
                <Setter Property="Text" Value="{DynamicResource String_Tag_GameEvent_GE_Quest_Node_PassM_Title}"></Setter>
            </Trigger>
            <Trigger Property="Tag" Value="{x:Type mge:GE_Relation_ChangeM}">
                <Setter Property="Text" Value="{DynamicResource String_Tag_GameEvent_GE_Relation_ChangeM_Title}"></Setter>
            </Trigger>
        </Style.Triggers>
    </Style>

    <Style TargetType="TextBlock" x:Key="S_TextBlock_Behavior_Title" BasedOn="{StaticResource S_TextBlock_InteractiveTitle}">
        <Style.Triggers>
            <Trigger Property="Tag" Value="{x:Type mb:B_OptionalM}">
                <Setter Property="Text" Value="{DynamicResource String_Tag_Behavior_B_OptionalM_Title}"></Setter>
            </Trigger>
        </Style.Triggers>
    </Style>

    <DataTemplate x:Key="DT_ContentControl_Predicates">
        <ScrollViewer>
            <ItemsControl ItemsSource="{Binding Predicates}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border BorderBrush="{StaticResource ComboBox.Static.Border}" BorderThickness="{StaticResource Thickness_Margin_1x}"
                                CornerRadius="{StaticResource CornerRadius_Common}">
                            <Border.Margin>
                                <Thickness Left="{StaticResource Double_Margin_2x}" Right="{StaticResource Double_Margin_2x}"
                                           Top="{StaticResource Double_Margin_2x}" Bottom="{StaticResource Double_Size_8x}"></Thickness>
                            </Border.Margin>
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="auto"></RowDefinition>
                                    <RowDefinition Height="auto"></RowDefinition>
                                    <RowDefinition Height="*"></RowDefinition>
                                </Grid.RowDefinitions>
                                <TextBlock HorizontalAlignment="Center" Tag="{Binding PredicateType}" Style="{StaticResource S_TextBlock_Predicate_Title}"></TextBlock>
                                <CheckBox Grid.Row="1" IsChecked="{Binding IsInversed, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource S_CheckBox_Prop}" Tag="{DynamicResource String_Tag_Predicate_IsInversed}"></CheckBox>
                                <ContentControl Grid.Row="2" Content="{Binding}"></ContentControl>
                                <Button Grid.RowSpan="3" Style="{StaticResource S_Button_Remove}" VerticalAlignment="Top" HorizontalAlignment="Right"></Button>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>
    </DataTemplate>

    <DataTemplate x:Key="DT_ContentControl_GameEvents">
        <ScrollViewer>
            <ItemsControl ItemsSource="{Binding GameEvents}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border BorderBrush="{StaticResource ComboBox.Static.Border}" BorderThickness="{StaticResource Thickness_Margin_1x}"
                                CornerRadius="{StaticResource CornerRadius_Common}">
                            <Border.Margin>
                                <Thickness Left="{StaticResource Double_Margin_2x}" Right="{StaticResource Double_Margin_2x}"
                                           Top="{StaticResource Double_Margin_2x}" Bottom="{StaticResource Double_Size_8x}"></Thickness>
                            </Border.Margin>
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="auto"></RowDefinition>
                                    <RowDefinition Height="auto"></RowDefinition>
                                    <RowDefinition Height="*"></RowDefinition>
                                </Grid.RowDefinitions>
                                <TextBlock HorizontalAlignment="Center" Tag="{Binding GameEventType}" Style="{StaticResource S_TextBlock_GameEvent_Title}"></TextBlock>
                                <CheckBox Grid.Row="1" IsChecked="{Binding IsExecutedOnLeave, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource S_CheckBox_Prop}" Tag="{DynamicResource String_Tag_GameEvent_IsExecutedOnLeave}"></CheckBox>
                                <ContentControl Grid.Row="2" Content="{Binding}"></ContentControl>
                                <Button Grid.RowSpan="3" Style="{StaticResource S_Button_Remove}" VerticalAlignment="Top" HorizontalAlignment="Right"></Button>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>
    </DataTemplate>

    <DataTemplate x:Key="DT_ContentControl_Behaviors">
        <ScrollViewer>
            <ItemsControl ItemsSource="{Binding Behaviors}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border BorderBrush="{StaticResource ComboBox.Static.Border}" BorderThickness="{StaticResource Thickness_Margin_1x}"
                                CornerRadius="{StaticResource CornerRadius_Common}">
                            <Border.Margin>
                                <Thickness Left="{StaticResource Double_Margin_2x}" Right="{StaticResource Double_Margin_2x}"
                                           Top="{StaticResource Double_Margin_2x}" Bottom="{StaticResource Double_Size_8x}"></Thickness>
                            </Border.Margin>
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="auto"></RowDefinition>
                                    <RowDefinition Height="auto"></RowDefinition>
                                    <RowDefinition Height="*"></RowDefinition>
                                </Grid.RowDefinitions>
                                <TextBlock HorizontalAlignment="Center" Tag="{Binding BehaviorType}" Style="{StaticResource S_TextBlock_Behavior_Title}"></TextBlock>
                                <ContentControl Grid.Row="2" Content="{Binding}"></ContentControl>
                                <Button Grid.RowSpan="3" Style="{StaticResource S_Button_Remove}" VerticalAlignment="Top" HorizontalAlignment="Right"></Button>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>
    </DataTemplate>
    
    <DataTemplate x:Key="DT_ComboBoxItem_Predicate">
        <TextBlock x:Name="tb_Main"></TextBlock>
        <DataTemplate.Triggers>
            <DataTrigger Binding="{Binding}" Value="{x:Type mp:P_CompositeM}">
                <Setter TargetName="tb_Main" Property="Text" Value="{DynamicResource String_Tag_Predicate_P_CompositeM_DisplayName}"></Setter>
            </DataTrigger>
            <DataTrigger Binding="{Binding}" Value="{x:Type mp:P_Dialog_HasM}">
                <Setter TargetName="tb_Main" Property="Text" Value="{DynamicResource String_Tag_Predicate_P_Dialog_HasM_DisplayName}"></Setter>
            </DataTrigger>
            <DataTrigger Binding="{Binding}" Value="{x:Type mp:P_Dialog_Node_Has_ActiveSession_CmpM}">
                <Setter TargetName="tb_Main" Property="Text" Value="{DynamicResource String_Tag_Predicate_P_Dialog_Node_Has_ActiveSession_CmpM_DisplayName}"></Setter>
            </DataTrigger>
            <DataTrigger Binding="{Binding}" Value="{x:Type mp:P_Dialog_Node_Has_ActiveSessionM}">
                <Setter TargetName="tb_Main" Property="Text" Value="{DynamicResource String_Tag_Predicate_P_Dialog_Node_Has_ActiveSessionM_DisplayName}"></Setter>
            </DataTrigger>
            <DataTrigger Binding="{Binding}" Value="{x:Type mp:P_Dialog_Node_Has_PrevSessions_CmpM}">
                <Setter TargetName="tb_Main" Property="Text" Value="{DynamicResource String_Tag_Predicate_P_Dialog_Node_Has_PrevSessions_CmpM_DisplayName}"></Setter>
            </DataTrigger>
            <DataTrigger Binding="{Binding}" Value="{x:Type mp:P_Dialog_Node_Has_PrevSessionsM}">
                <Setter TargetName="tb_Main" Property="Text" Value="{DynamicResource String_Tag_Predicate_P_Dialog_Node_Has_PrevSessionsM_DisplayName}"></Setter>
            </DataTrigger>
            <DataTrigger Binding="{Binding}" Value="{x:Type mp:P_Item_HasM}">
                <Setter TargetName="tb_Main" Property="Text" Value="{DynamicResource String_Tag_Predicate_P_Item_HasM_DisplayName}"></Setter>
            </DataTrigger>
            <DataTrigger Binding="{Binding}" Value="{x:Type mp:P_Quest_AddedM}">
                <Setter TargetName="tb_Main" Property="Text" Value="{DynamicResource String_Tag_Predicate_P_Quest_AddedM_DisplayName}"></Setter>
            </DataTrigger>
            <DataTrigger Binding="{Binding}" Value="{x:Type mp:P_Quest_FinishedM}">
                <Setter TargetName="tb_Main" Property="Text" Value="{DynamicResource String_Tag_Predicate_P_Quest_FinishedM_DisplayName}"></Setter>
            </DataTrigger>
            <DataTrigger Binding="{Binding}" Value="{x:Type mp:P_Quest_Node_AddedM}">
                <Setter TargetName="tb_Main" Property="Text" Value="{DynamicResource String_Tag_Predicate_P_Quest_Node_AddedM_DisplayName}"></Setter>
            </DataTrigger>
            <DataTrigger Binding="{Binding}" Value="{x:Type mp:P_Quest_Node_PassedM}">
                <Setter TargetName="tb_Main" Property="Text" Value="{DynamicResource String_Tag_Predicate_P_Quest_Node_PassedM_DisplayName}"></Setter>
            </DataTrigger>
            <DataTrigger Binding="{Binding}" Value="{x:Type mp:P_Relation_HasM}">
                <Setter TargetName="tb_Main" Property="Text" Value="{DynamicResource String_Tag_Predicate_P_Relation_HasM_DisplayName}"></Setter>
            </DataTrigger>
        </DataTemplate.Triggers>
    </DataTemplate>
    
    <DataTemplate x:Key="DT_ContentControl_PredicatesHeader">
        <controls:ComboBoxExt SelectedValue="{Binding SelectedPredicateType, UpdateSourceTrigger=PropertyChanged}"
                              Style="{StaticResource S_ComboBoxExt_Prop_Popup}" ItemTemplate="{StaticResource DT_ComboBoxItem_Predicate}">
            <controls:ComboBoxExt.Tag>
                <StackPanel Orientation="Horizontal">
                    <ContentControl ContentTemplate="{StaticResource DT_HasPredicates_Mini}"></ContentControl>
                    <TextBlock Padding="{StaticResource Thickness_Padding_LeftRight}" VerticalAlignment="Center" Text="{DynamicResource String_Tag_Node_Tab_Predicates}"></TextBlock>
                </StackPanel>
            </controls:ComboBoxExt.Tag>
            <sys:Type>mp:P_CompositeM</sys:Type>
            <sys:Type>mp:P_Dialog_HasM</sys:Type>
            <sys:Type>mp:P_Dialog_Node_Has_ActiveSession_CmpM</sys:Type>
            <sys:Type>mp:P_Dialog_Node_Has_ActiveSessionM</sys:Type>
            <sys:Type>mp:P_Dialog_Node_Has_PrevSessions_CmpM</sys:Type>
            <sys:Type>mp:P_Dialog_Node_Has_PrevSessionsM</sys:Type>
            <sys:Type>mp:P_Item_HasM</sys:Type>
            <sys:Type>mp:P_Quest_AddedM</sys:Type>
            <sys:Type>mp:P_Quest_FinishedM</sys:Type>
            <sys:Type>mp:P_Quest_Node_AddedM</sys:Type>
            <sys:Type>mp:P_Quest_Node_PassedM</sys:Type>
            <sys:Type>mp:P_Relation_HasM</sys:Type>
        </controls:ComboBoxExt>
    </DataTemplate>

    <DataTemplate x:Key="DT_ComboBoxItem_GameEvent">
        <TextBlock x:Name="tb_Main"></TextBlock>
        <DataTemplate.Triggers>
            <DataTrigger Binding="{Binding}" Value="{x:Type mge:GE_CustomM}">
                <Setter TargetName="tb_Main" Property="Text" Value="{DynamicResource String_Tag_GameEvent_GE_CustomM_DisplayName}"></Setter>
            </DataTrigger>
            <DataTrigger Binding="{Binding}" Value="{x:Type mge:GE_Item_DropM}">
                <Setter TargetName="tb_Main" Property="Text" Value="{DynamicResource String_Tag_GameEvent_GE_Item_DropM_DisplayName}"></Setter>
            </DataTrigger>
            <DataTrigger Binding="{Binding}" Value="{x:Type mge:GE_Item_PickUpM}">
                <Setter TargetName="tb_Main" Property="Text" Value="{DynamicResource String_Tag_GameEvent_GE_Item_PickUpM_DisplayName}"></Setter>
            </DataTrigger>
            <DataTrigger Binding="{Binding}" Value="{x:Type mge:GE_Quest_AddM}">
                <Setter TargetName="tb_Main" Property="Text" Value="{DynamicResource String_Tag_GameEvent_GE_Quest_AddM_DisplayName}"></Setter>
            </DataTrigger>
            <DataTrigger Binding="{Binding}" Value="{x:Type mge:GE_Quest_Node_AddM}">
                <Setter TargetName="tb_Main" Property="Text" Value="{DynamicResource String_Tag_GameEvent_GE_Quest_Node_AddM_DisplayName}"></Setter>
            </DataTrigger>
            <DataTrigger Binding="{Binding}" Value="{x:Type mge:GE_Quest_Node_PassM}">
                <Setter TargetName="tb_Main" Property="Text" Value="{DynamicResource String_Tag_GameEvent_GE_Quest_Node_PassM_DisplayName}"></Setter>
            </DataTrigger>
            <DataTrigger Binding="{Binding}" Value="{x:Type mge:GE_Relation_ChangeM}">
                <Setter TargetName="tb_Main" Property="Text" Value="{DynamicResource String_Tag_GameEvent_GE_Relation_ChangeM_DisplayName}"></Setter>
            </DataTrigger>
        </DataTemplate.Triggers>
    </DataTemplate>
    
    <DataTemplate x:Key="DT_ContentControl_GameEventsHeader">
        <controls:ComboBoxExt SelectedValue="{Binding SelectedGameEventType, UpdateSourceTrigger=PropertyChanged}"
                              Style="{StaticResource S_ComboBoxExt_Prop_Popup}" ItemTemplate="{StaticResource DT_ComboBoxItem_GameEvent}">
            <controls:ComboBoxExt.Tag>
                <StackPanel Orientation="Horizontal">
                    <ContentControl ContentTemplate="{StaticResource DT_HasGameEvents_Mini}"></ContentControl>
                    <TextBlock Padding="{StaticResource Thickness_Padding_LeftRight}" VerticalAlignment="Center" Text="{DynamicResource String_Tag_Node_Tab_GameEvents}"></TextBlock>
                </StackPanel>
            </controls:ComboBoxExt.Tag>
            <sys:Type>mge:GE_CustomM</sys:Type>
            <sys:Type>mge:GE_Item_DropM</sys:Type>
            <sys:Type>mge:GE_Item_PickUpM</sys:Type>
            <sys:Type>mge:GE_Quest_AddM</sys:Type>
            <sys:Type>mge:GE_Quest_Node_AddM</sys:Type>
            <sys:Type>mge:GE_Quest_Node_PassM</sys:Type>
            <sys:Type>mge:GE_Relation_ChangeM</sys:Type>
        </controls:ComboBoxExt>
    </DataTemplate>

    <DataTemplate x:Key="DT_ComboBoxItem_Behavior">
        <TextBlock x:Name="tb_Main"></TextBlock>
        <DataTemplate.Triggers>
            <DataTrigger Binding="{Binding}" Value="{x:Type mb:B_OptionalM}">
                <Setter TargetName="tb_Main" Property="Text" Value="{DynamicResource String_Tag_Behavior_B_OptionalM_DisplayName}"></Setter>
            </DataTrigger>
        </DataTemplate.Triggers>
    </DataTemplate>
    
    <DataTemplate x:Key="DT_ContentControl_BehaviorsHeader">
        <controls:ComboBoxExt SelectedValue="{Binding SelectedBehaviorType, UpdateSourceTrigger=PropertyChanged}"
                              Style="{StaticResource S_ComboBoxExt_Prop_Popup}" ItemTemplate="{StaticResource DT_ComboBoxItem_Behavior}">
            <controls:ComboBoxExt.Tag>
                <StackPanel Orientation="Horizontal">
                    <ContentControl ContentTemplate="{StaticResource DT_HasBehaviors_Mini}"></ContentControl>
                    <TextBlock Padding="{StaticResource Thickness_Padding_LeftRight}" VerticalAlignment="Center" Text="{DynamicResource String_Tag_Node_Tab_Behaviors}"></TextBlock>
                </StackPanel>
            </controls:ComboBoxExt.Tag>
            <sys:Type>mb:B_OptionalM</sys:Type>
        </controls:ComboBoxExt>
    </DataTemplate>
    
    <DataTemplate DataType="{x:Type vmn:Node_RandomEditorVM}">
        <TabControl>
            <TabItem Header="{DynamicResource String_Tag_Node_Tab_Props}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="auto"></RowDefinition>
                    </Grid.RowDefinitions>
                    <TextBox IsReadOnly="True" Style="{StaticResource S_TextBox_Prop}" Text="{Binding Id, Mode=OneTime}" Tag="{DynamicResource String_Tag_Node_Id}"></TextBox>
                </Grid>
            </TabItem>
            <TabItem ContentTemplate="{StaticResource DT_ContentControl_Predicates}" Content="{Binding}" HeaderTemplate="{StaticResource DT_ContentControl_PredicatesHeader}" Header="{Binding}"></TabItem>
            <TabItem ContentTemplate="{StaticResource DT_ContentControl_GameEvents}" Content="{Binding}" HeaderTemplate="{StaticResource DT_ContentControl_GameEventsHeader}" Header="{Binding}"></TabItem>
        </TabControl>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vmn:Node_TransitVM}">
        <TextBlock VerticalAlignment="Center" HorizontalAlignment="Center" Text="{StaticResource String_Icon_Node_Transit}" Style="{StaticResource S_TextBlock_Node_Icon_Large}"></TextBlock>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vmn:Node_TransitEditorVM}">
        <TabControl>
            <TabItem Header="{DynamicResource String_Tag_Node_Tab_Props}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="auto"></RowDefinition>
                    </Grid.RowDefinitions>
                    <TextBox IsReadOnly="True" Style="{StaticResource S_TextBox_Prop}" Text="{Binding Id, Mode=OneTime}" Tag="{DynamicResource String_Tag_Node_Id}"></TextBox>
                </Grid>
            </TabItem>
            <TabItem ContentTemplate="{StaticResource DT_ContentControl_Predicates}" Content="{Binding}" HeaderTemplate="{StaticResource DT_ContentControl_PredicatesHeader}" Header="{Binding}"></TabItem>
            <TabItem ContentTemplate="{StaticResource DT_ContentControl_GameEvents}" Content="{Binding}" HeaderTemplate="{StaticResource DT_ContentControl_GameEventsHeader}" Header="{Binding}"></TabItem>
        </TabControl>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vmn:Node_GateVM}">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition></RowDefinition>
                <RowDefinition></RowDefinition>
                <RowDefinition></RowDefinition>
            </Grid.RowDefinitions>

            <TextBlock Style="{StaticResource S_TextBlock_Node_Icon_Large}" VerticalAlignment="Center" HorizontalAlignment="Center" Text="{StaticResource String_Icon_Node_Gate}"></TextBlock>

            <TextBlock FontSize="{StaticResource FontSize_Medium}" Grid.Row="1" Grid.Column="0" VerticalAlignment="Center" HorizontalAlignment="Center" Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}"></TextBlock>

            <TextBlock FontSize="{StaticResource FontSize_Large}" Grid.Row="2" Grid.Column="0" VerticalAlignment="Center" HorizontalAlignment="Center" Text="{Binding Description, UpdateSourceTrigger=PropertyChanged, StringFormat=[{0}], TargetNullValue=???}"></TextBlock>
        </Grid>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vmn:Node_GateEditorVM}">
        <TabControl>
            <TabItem Header="{DynamicResource String_Tag_Node_Tab_Props}">
                <Grid VerticalAlignment="Top">
                    <Grid.RowDefinitions>
                        <RowDefinition></RowDefinition>
                        <RowDefinition></RowDefinition>
                        <RowDefinition></RowDefinition>
                    </Grid.RowDefinitions>
                    <TextBox IsReadOnly="True" Style="{StaticResource S_TextBox_Prop}" Text="{Binding Id, Mode=OneTime}" Tag="{DynamicResource String_Tag_Node_Id}"></TextBox>
                    <controls:ComboBoxExt x:Name="cmb_TargetDialog" Grid.Row="1" SelectedValue="{Binding TargetDialog, UpdateSourceTrigger=PropertyChanged}"
                                          Tag="{DynamicResource String_Tag_Node_Gate_TargetDialog}"
                                          ItemsSource="{Binding DialogsCVS.View}"
                                          Filter="{Binding TargetDialogFilter, UpdateSourceTrigger=PropertyChanged}"
                                          Style="{StaticResource S_ComboBoxExt_Prop_Filter}"></controls:ComboBoxExt>
                    <controls:ComboBoxExt x:Name="cmb_TargetExitNode" Grid.Row="2" SelectedValue="{Binding TargetExitNode, UpdateSourceTrigger=PropertyChanged}"
                                          Tag="{DynamicResource String_Tag_Node_Gate_TargetExitNode}"
                                          ItemsSource="{Binding NodesCVS.View}"
                                          Filter="{Binding NodesFilter, UpdateSourceTrigger=PropertyChanged}"
                                          Style="{StaticResource S_ComboBoxExt_Prop_Filter}"></controls:ComboBoxExt>
                </Grid>
            </TabItem>
            <TabItem ContentTemplate="{StaticResource DT_ContentControl_Predicates}" Content="{Binding}" HeaderTemplate="{StaticResource DT_ContentControl_PredicatesHeader}" Header="{Binding}"></TabItem>
            <TabItem ContentTemplate="{StaticResource DT_ContentControl_GameEvents}" Content="{Binding}" HeaderTemplate="{StaticResource DT_ContentControl_GameEventsHeader}" Header="{Binding}"></TabItem>
        </TabControl>
        <DataTemplate.Triggers>
            <Trigger SourceName="cmb_TargetDialog" Property="SelectedValue" Value="{x:Null}">
                <Setter TargetName="cmb_TargetExitNode" Property="Visibility" Value="Collapsed"></Setter>
            </Trigger>
        </DataTemplate.Triggers>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vmn:Node_DelayVM}">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition></RowDefinition>
                <RowDefinition></RowDefinition>
            </Grid.RowDefinitions>

            <TextBlock Style="{StaticResource S_TextBlock_Node_Icon_Large}" VerticalAlignment="Center" HorizontalAlignment="Center" Text="{StaticResource String_Icon_Node_Delay}"></TextBlock>

            <TextBlock FontSize="{StaticResource FontSize_Medium}" Grid.Row="1" Grid.Column="0" VerticalAlignment="Center" HorizontalAlignment="Center" Text="{Binding Delay, UpdateSourceTrigger=PropertyChanged, StringFormat=N2}"></TextBlock>
        </Grid>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vmn:Node_DelayEditorVM}">
        <TabControl>
            <TabItem Header="{DynamicResource String_Tag_Node_Tab_Props}">
                <GroupBox Header="{DynamicResource String_Tag_Node_Delay_Delay}" HeaderTemplate="{StaticResource DT_GroupBox_HeaderTemplate_Prop}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="auto"></RowDefinition>
                            <RowDefinition Height="auto"></RowDefinition>
                            <RowDefinition Height="auto"></RowDefinition>
                        </Grid.RowDefinitions>
                        <TextBox IsReadOnly="True" Style="{StaticResource S_TextBox_Prop}" Text="{Binding Id, Mode=OneTime}" Tag="{DynamicResource String_Tag_Node_Id}"></TextBox>
                        <TextBlock Grid.Row="1" HorizontalAlignment="Center" Text="{Binding Delay, UpdateSourceTrigger=PropertyChanged, StringFormat=N1}"></TextBlock>
                        <Slider x:Name="sl_Delay"
                        Grid.Row="2"
                        Value="{Binding Delay, UpdateSourceTrigger=PropertyChanged}"
                        Minimum="{StaticResource Double_Delay_Min}"
                        Maximum="{StaticResource Double_Delay_Max}"
                        TickFrequency="{StaticResource Double_Delay_Tick}"
                        ></Slider>
                    </Grid>
                </GroupBox>
            </TabItem>
        </TabControl>
    </DataTemplate>
    
    <DataTemplate DataType="{x:Type vmn:Node_ExitVM}">
        <TextBlock Style="{StaticResource S_TextBlock_Node_Icon_Large}" VerticalAlignment="Center" HorizontalAlignment="Center">
                    <Run Text="{StaticResource String_Icon_Node_Exit}"></Run>
                    <Run Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}"></Run>
        </TextBlock>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vmn:Node_ExitEditorVM}">
        <TabControl>
            <TabItem Header="{DynamicResource String_Tag_Node_Tab_Props}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="auto"></RowDefinition>
                    </Grid.RowDefinitions>
                    <TextBox IsReadOnly="True" Style="{StaticResource S_TextBox_Prop}" Text="{Binding Id, Mode=OneTime}" Tag="{DynamicResource String_Tag_Node_Id}"></TextBox>
                </Grid>
            </TabItem>
        </TabControl>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vmn:Node_ReplicaVM}">
        <Grid IsHitTestVisible="False">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="auto"></ColumnDefinition>
                <ColumnDefinition Width="*"></ColumnDefinition>
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="auto"></RowDefinition>
                <RowDefinition></RowDefinition>
                <RowDefinition></RowDefinition>
                <RowDefinition></RowDefinition>
            </Grid.RowDefinitions>

            <TextBlock Text="{StaticResource String_Icon_Node_Replica}" Style="{StaticResource S_TextBlock_Node_Icon}"></TextBlock>

            <TextBlock VerticalAlignment="Center" TextAlignment="Center" Grid.Column="1" Grid.Row="0" Style="{StaticResource S_TextBlock_Node_Header}">
                <Run Text="{Binding Character.name, UpdateSourceTrigger=PropertyChanged}"></Run>
                <Run Text="{Binding OverrideName, UpdateSourceTrigger=PropertyChanged, StringFormat=[{0}], TargetNullValue=''}"></Run>
            </TextBlock>

            <controls:TextBlockWithSource Grid.ColumnSpan="2" Grid.Row="1" x:Name="rtDescription" RtVersion="{Binding RtDescriptionVersion, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource S_TextBlock_Node_Description}" DataContext="{Binding}"></controls:TextBlockWithSource>

            <Separator Grid.ColumnSpan="2" Grid.Row="2"></Separator>

            <TextBlock Grid.ColumnSpan="2" Grid.Row="3" Style="{StaticResource S_TextBlock_Node_ShortDescription}" Text="{Binding ShortDescription, UpdateSourceTrigger=PropertyChanged}"></TextBlock>
        </Grid>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vmn:Node_ReplicaEditorVM}">
        <TabControl>
            <TabItem Header="{DynamicResource String_Tag_Node_Tab_Props}">
                <Grid VerticalAlignment="Top">
                    <Grid.RowDefinitions>
                        <RowDefinition></RowDefinition>
                        <RowDefinition></RowDefinition>
                        <RowDefinition></RowDefinition>
                        <RowDefinition></RowDefinition>
                        <RowDefinition></RowDefinition>
                        <RowDefinition></RowDefinition>
                        <RowDefinition></RowDefinition>
                    </Grid.RowDefinitions>
                    <TextBox IsReadOnly="True" Style="{StaticResource S_TextBox_Prop}" Text="{Binding Id, Mode=OneTime}" Tag="{DynamicResource String_Tag_Node_Id}"></TextBox>
                    <controls:ComboBoxExt Grid.Row="1" SelectedValue="{Binding Character, UpdateSourceTrigger=PropertyChanged}"
                                          Tag="{DynamicResource String_Tag_Node_Regular_Character}"
                                          ItemsSource="{Binding FilteredCharacterCVS.View}"
                                          Filter="{Binding CharacterFilter, UpdateSourceTrigger=PropertyChanged}"
                                          Style="{StaticResource S_ComboBoxExt_Prop_Filter}"></controls:ComboBoxExt>
                    <TextBox Grid.Row="2" Style="{StaticResource S_TextBox_Prop}" Text="{Binding OverrideName, UpdateSourceTrigger=PropertyChanged}" Tag="{DynamicResource String_Tag_Node_Regular_OverrideName}"></TextBox>
                    <ContentControl Grid.Row="3" Style="{StaticResource S_ContentControl_Prop_StorageType}" Content="{Binding}" Tag="{DynamicResource String_Tag_Node_Regular_FileStorageType}"></ContentControl>
                    <TextBox Grid.Row="4" Style="{StaticResource S_TextBox_Prop}" Text="{Binding FileHttpRef, UpdateSourceTrigger=PropertyChanged}" Tag="{DynamicResource String_Tag_Node_Regular_FileHttpRef}"></TextBox>
                    <GroupBox Grid.Row="5" Style="{StaticResource S_GroupBox_Prop}" Header="{DynamicResource String_Tag_Description}" HeaderTemplate="{StaticResource DT_GroupBox_HeaderTemplate_Prop_Rich}">
                        <controls:RichTextBoxWithSource VerticalScrollBarVisibility="Auto" MaxHeight="{StaticResource Double_RichTextBox_MaxHeight}" MinHeight="{StaticResource Double_Node_MinHeight}" x:Name="rtDescription" RtVersion="{Binding RtDescriptionVersion, UpdateSourceTrigger=PropertyChanged}" DataContext="{Binding}"></controls:RichTextBoxWithSource>
                    </GroupBox>
                    <TextBox Grid.Row="6" Style="{StaticResource S_TextBox_Prop_Multiline}" Text="{Binding ShortDescription, UpdateSourceTrigger=PropertyChanged}" Tag="{DynamicResource String_Tag_Node_Regular_ShortDescription}"></TextBox>
                </Grid>
            </TabItem>
            <TabItem ContentTemplate="{StaticResource DT_ContentControl_Predicates}" Content="{Binding}" HeaderTemplate="{StaticResource DT_ContentControl_PredicatesHeader}" Header="{Binding}"></TabItem>
            <TabItem ContentTemplate="{StaticResource DT_ContentControl_GameEvents}" Content="{Binding}" HeaderTemplate="{StaticResource DT_ContentControl_GameEventsHeader}" Header="{Binding}"></TabItem>
            <TabItem ContentTemplate="{StaticResource DT_ContentControl_Behaviors}" Content="{Binding}" HeaderTemplate="{StaticResource DT_ContentControl_BehaviorsHeader}" Header="{Binding}"></TabItem>
        </TabControl>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vmn:Node_DialogVM}">
        <Grid IsHitTestVisible="False">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="auto"></ColumnDefinition>
                <ColumnDefinition Width="*"></ColumnDefinition>
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="auto"></RowDefinition>
                <RowDefinition></RowDefinition>
                <RowDefinition></RowDefinition>
                <RowDefinition></RowDefinition>
            </Grid.RowDefinitions>

            <TextBlock Text="{StaticResource String_Icon_Node_Dialog}" Style="{StaticResource S_TextBlock_Node_Icon}"></TextBlock>

            <TextBlock VerticalAlignment="Center" TextAlignment="Center" Grid.Column="1" Grid.Row="0" Style="{StaticResource S_TextBlock_Node_Header}">
                <Run Text="{Binding Character.name, UpdateSourceTrigger=PropertyChanged}"></Run>
                <Run Text="{Binding OverrideName, UpdateSourceTrigger=PropertyChanged, StringFormat=[{0}], TargetNullValue=''}"></Run>
            </TextBlock>

            <controls:TextBlockWithSource Grid.ColumnSpan="2" Grid.Row="1" x:Name="rtDescription" RtVersion="{Binding RtDescriptionVersion, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource S_TextBlock_Node_Description}" DataContext="{Binding}"></controls:TextBlockWithSource>

            <Separator Grid.ColumnSpan="2" Grid.Row="2"></Separator>

            <TextBlock Grid.ColumnSpan="2" Grid.Row="3" Style="{StaticResource S_TextBlock_Node_ShortDescription}" Text="{Binding ShortDescription, UpdateSourceTrigger=PropertyChanged}"></TextBlock>
        </Grid>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vmn:Node_DialogEditorVM}">
        <TabControl>
            <TabItem Header="{DynamicResource String_Tag_Node_Tab_Props}">
                <Grid VerticalAlignment="Top">
                    <Grid.RowDefinitions>
                        <RowDefinition></RowDefinition>
                        <RowDefinition></RowDefinition>
                        <RowDefinition></RowDefinition>
                        <RowDefinition></RowDefinition>
                        <RowDefinition></RowDefinition>
                        <RowDefinition></RowDefinition>
                        <RowDefinition></RowDefinition>
                    </Grid.RowDefinitions>
                    <TextBox IsReadOnly="True" Style="{StaticResource S_TextBox_Prop}" Text="{Binding Id, Mode=OneTime}" Tag="{DynamicResource String_Tag_Node_Id}"></TextBox>
                    <controls:ComboBoxExt Grid.Row="1" SelectedValue="{Binding Character, UpdateSourceTrigger=PropertyChanged}"
                                          Tag="{DynamicResource String_Tag_Node_Regular_Character}"
                                          ItemsSource="{Binding FilteredCharacterCVS.View}"
                                          Filter="{Binding CharacterFilter, UpdateSourceTrigger=PropertyChanged}"
                                          Style="{StaticResource S_ComboBoxExt_Prop_Filter}"></controls:ComboBoxExt>
                    <TextBox Grid.Row="2" Style="{StaticResource S_TextBox_Prop}" Text="{Binding OverrideName, UpdateSourceTrigger=PropertyChanged}" Tag="{DynamicResource String_Tag_Node_Regular_OverrideName}"></TextBox>
                    <ContentControl Grid.Row="3" Style="{StaticResource S_ContentControl_Prop_StorageType}" Content="{Binding}" Tag="{DynamicResource String_Tag_Node_Regular_FileStorageType}"></ContentControl>
                    <TextBox Grid.Row="4" Style="{StaticResource S_TextBox_Prop}" Text="{Binding FileHttpRef, UpdateSourceTrigger=PropertyChanged}" Tag="{DynamicResource String_Tag_Node_Regular_FileHttpRef}"></TextBox>
                    <GroupBox Grid.Row="5" Style="{StaticResource S_GroupBox_Prop}" Header="{DynamicResource String_Tag_Description}" HeaderTemplate="{StaticResource DT_GroupBox_HeaderTemplate_Prop_Rich}">
                        <controls:RichTextBoxWithSource VerticalScrollBarVisibility="Auto" MaxHeight="{StaticResource Double_RichTextBox_MaxHeight}" MinHeight="{StaticResource Double_Node_MinHeight}" x:Name="rtDescription" RtVersion="{Binding RtDescriptionVersion, UpdateSourceTrigger=PropertyChanged}" DataContext="{Binding}"></controls:RichTextBoxWithSource>
                    </GroupBox>
                    <TextBox Grid.Row="6" Style="{StaticResource S_TextBox_Prop_Multiline}" Text="{Binding ShortDescription, UpdateSourceTrigger=PropertyChanged}" Tag="{DynamicResource String_Tag_Node_Regular_ShortDescription}"></TextBox>
                </Grid>
            </TabItem>
            <TabItem ContentTemplate="{StaticResource DT_ContentControl_Predicates}" Content="{Binding}" HeaderTemplate="{StaticResource DT_ContentControl_PredicatesHeader}" Header="{Binding}"></TabItem>
            <TabItem ContentTemplate="{StaticResource DT_ContentControl_GameEvents}" Content="{Binding}" HeaderTemplate="{StaticResource DT_ContentControl_GameEventsHeader}" Header="{Binding}"></TabItem>
            <TabItem ContentTemplate="{StaticResource DT_ContentControl_Behaviors}" Content="{Binding}" HeaderTemplate="{StaticResource DT_ContentControl_BehaviorsHeader}" Header="{Binding}"></TabItem>
        </TabControl>
    </DataTemplate>
    
    <DataTemplate DataType="{x:Type vmg:DialogVM}">
        <Border x:Name="br_Main" Style="{StaticResource S_Border_Selector}"
                    bhvrs:DragDropBehavior.DragEnabled="true"
                    bhvrs:LoadUnloadExtBehavior.LoadedCommand="{Binding RegisterCommand, UpdateSourceTrigger=PropertyChanged}"
                    bhvrs:LoadUnloadExtBehavior.UnloadedCommand="{Binding UnregisterCommand, UpdateSourceTrigger=PropertyChanged}">
            <Border.InputBindings>
                <MouseBinding Gesture="LeftClick" Command="{Binding Path=DataContext.SelectCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=ItemsControl}}" CommandParameter="{Binding}"></MouseBinding>
                <MouseBinding Gesture="RightClick" Command="{Binding InfoCommand}" CommandParameter="{Binding}"></MouseBinding>
            </Border.InputBindings>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition></RowDefinition>
                    <RowDefinition></RowDefinition>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="auto"></ColumnDefinition>
                    <ColumnDefinition Width="*"></ColumnDefinition>
                    <ColumnDefinition Width="auto"></ColumnDefinition>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.RowSpan="2" Text="{StaticResource String_Icon_Dialog}" Style="{StaticResource S_TextBlock_Selector_Icon}"></TextBlock>
                <TextBlock Grid.Column="1" Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource S_TextBlock_Selector_Name}"></TextBlock>
                <TextBlock Grid.Column="1" Grid.Row="1" FontStyle="Italic" FontSize="{StaticResource FontSize_Small}">
                    <Run Text="{Binding DialogCharacter.name, UpdateSourceTrigger=PropertyChanged}"></Run>
                    <Run FontWeight="Bold" Text="{Binding DialogLocation.name, UpdateSourceTrigger=PropertyChanged, StringFormat=[{0}]}"></Run>
                </TextBlock>
                <TextBlock Grid.Column="2" Grid.RowSpan="2" Style="{StaticResource S_TextBlock_Selector_Cut}"></TextBlock>
            </Grid>
        </Border>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vmg:DialogEditorVM}">
        <TabControl Padding="0" Margin="0">
            <TabItem Header="{DynamicResource String_Tag_Graph_Tab_View}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="7*"></ColumnDefinition>
                        <ColumnDefinition Width="auto"></ColumnDefinition>
                        <ColumnDefinition Width="3*"></ColumnDefinition>
                    </Grid.ColumnDefinitions>

                    <ItemsControl Style="{StaticResource S_ItemsControl_Graph}"
                                  bhvrs:RenderSizeBehavior.IsEnabled="true"
                                  bhvrs:RenderSizeBehavior.ActualWidth="{Binding Path=(vm:ActiveContext.ViewWidth), UpdateSourceTrigger=PropertyChanged, Mode=OneWayToSource}"
                                  bhvrs:RenderSizeBehavior.ActualHeight="{Binding Path=(vm:ActiveContext.ViewHeight), UpdateSourceTrigger=PropertyChanged, Mode=OneWayToSource}"
                                  bhvrs:RenderSizeBehavior.SizeChangedFlag="{Binding SizeChangedFlag, UpdateSourceTrigger=PropertyChanged, Mode=OneWayToSource}">
                    </ItemsControl>

                    <Grid HorizontalAlignment="Left" VerticalAlignment="Top">
                        <Grid.RowDefinitions>
                            <RowDefinition></RowDefinition>
                            <RowDefinition></RowDefinition>
                        </Grid.RowDefinitions>

                        <StackPanel Orientation="Horizontal">
                            <Button x:Name="btn_selectable_Dialog" Style="{StaticResource S_Button_Square_24x}" Content="{StaticResource String_Icon_Node_Dialog}" Command="{Binding SelectNodeTypeCommand}" CommandParameter="{x:Type mn:Node_DialogM}" ToolTip="{DynamicResource String_Tag_Node_Dialog_Type}"></Button>
                            <Button x:Name="btn_selectable_Replica" Style="{StaticResource S_Button_Square_24x}" Content="{StaticResource String_Icon_Node_Replica}" Command="{Binding SelectNodeTypeCommand}" CommandParameter="{x:Type mn:Node_ReplicaM}" ToolTip="{DynamicResource String_Tag_Node_Replica_Type}"></Button>
                            <Button x:Name="btn_selectable_Random" Style="{StaticResource S_Button_Square_24x}" Content="{StaticResource String_Icon_Node_Random}" Command="{Binding SelectNodeTypeCommand}" CommandParameter="{x:Type mn:Node_RandomM}" ToolTip="{DynamicResource String_Tag_Node_Random_Type}"></Button>
                            <Button x:Name="btn_selectable_Transit" Style="{StaticResource S_Button_Square_24x}" Content="{StaticResource String_Icon_Node_Transit}" Command="{Binding SelectNodeTypeCommand}" CommandParameter="{x:Type mn:Node_TransitM}" ToolTip="{DynamicResource String_Tag_Node_Transit_Type}"></Button>
                            <Button x:Name="btn_selectable_Gate" Style="{StaticResource S_Button_Square_24x}" Content="{StaticResource String_Icon_Node_Gate}" Command="{Binding SelectNodeTypeCommand}" CommandParameter="{x:Type mn:Node_GateM}" ToolTip="{DynamicResource String_Tag_Node_Gate_Type}"></Button>
                            <Button x:Name="btn_selectable_Exit" Style="{StaticResource S_Button_Square_24x}" Content="{StaticResource String_Icon_Node_Exit}" Command="{Binding SelectNodeTypeCommand}" CommandParameter="{x:Type mn:Node_ExitM}" ToolTip="{DynamicResource String_Tag_Node_Exit_Type}"></Button>
                            <Button x:Name="btn_selectable_Delay" Style="{StaticResource S_Button_Square_24x}" Content="{StaticResource String_Icon_Node_Delay}" Command="{Binding SelectNodeTypeCommand}" CommandParameter="{x:Type mn:Node_DelayM}" ToolTip="{DynamicResource String_Tag_Node_Delay_Type}"></Button>
                            <Rectangle Style="{StaticResource S_Rectangle_GraphMenu}"></Rectangle>
                            <Button Style="{StaticResource S_Button_Square_24x}" Content="{StaticResource String_Icon_Bwd}" Command="{Binding PrevRootNodeCommand}" ToolTip="{DynamicResource String_GraphMenu_PrevRootNode_Tooltip}"></Button>
                            <Button Style="{StaticResource S_Button_Square_24x}" Content="{StaticResource String_Icon_Fwd}" Command="{Binding NextRootNodeCommand}" ToolTip="{DynamicResource String_GraphMenu_NextRootNode_Tooltip}"></Button>
                            <Rectangle Style="{StaticResource S_Rectangle_GraphMenu}"></Rectangle>
                            <Button Style="{StaticResource S_Button_Square_24x}" Content="{StaticResource String_Icon_Graph_Origin}" Command="{Binding GoToOriginCommand}" ToolTip="{DynamicResource String_GraphMenu_GoToOrigin_Tooltip}"></Button>
                            <Button Style="{StaticResource S_Button_Square_24x}" Content="{StaticResource String_Icon_Graph_Reset}" Command="{Binding ResetScaleCommand}" ToolTip="{DynamicResource String_GraphMenu_ResetScale_Tooltip}"></Button>
                            <Rectangle Style="{StaticResource S_Rectangle_GraphMenu}"></Rectangle>
                            <Button Style="{StaticResource S_Button_Square_24x}" Content="{StaticResource String_Icon_Play}" Command="{Binding PlayCommand}" ToolTip="{DynamicResource String_GraphMenu_Play_Tooltip}"></Button>
                        </StackPanel>

                        <TextBlock Grid.Row="1" Style="{StaticResource S_TextBlock_Graph_Bold}" Margin="{StaticResource Thickness_Margin_2x}">
                            <Run x:Name="r_SelectedNodeType"></Run>
                            <Run Text="{Binding Scale, UpdateSourceTrigger=PropertyChanged, StringFormat=N2}"></Run>
                            <Run Text="("></Run>
                            <Run Text="{Binding OffsetX, UpdateSourceTrigger=PropertyChanged, StringFormat=N0}"></Run>
                            <Run Text=","></Run>
                            <Run Text="{Binding OffsetY, UpdateSourceTrigger=PropertyChanged, StringFormat=N0}"></Run>
                            <Run Text=")"></Run>
                        </TextBlock>
                    </Grid>

                    <ContentControl Content="{Binding}" HorizontalAlignment="Right" VerticalAlignment="Top" Template="{StaticResource CT_ContentControl_NodePosition}"></ContentControl>

                    <GridSplitter Grid.Column="1"></GridSplitter>

                    <ContentControl Grid.Column="2" Content="{Binding SelectionEditor, UpdateSourceTrigger=PropertyChanged}"></ContentControl>
                </Grid>
            </TabItem>
            <TabItem Header="{DynamicResource String_Tag_Graph_Tab_Props}">
                <StackPanel Orientation="Vertical">
                    <TextBox Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource S_TextBox_Prop}" Tag="{DynamicResource String_Tag_Name}"></TextBox>
                    <TextBox Text="{Binding Description, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource S_TextBox_Prop_Multiline}" Tag="{DynamicResource String_Tag_Description}"></TextBox>
                    <controls:ComboBoxExt SelectedValue="{Binding DialogCharacter, UpdateSourceTrigger=PropertyChanged}"
                                          Tag="{DynamicResource String_Tag_Dialog_DialogCharacter}"
                                          ItemsSource="{Binding FilteredDialogCharacterCVS.View}"
                                          Filter="{Binding DialogCharacterFilter, UpdateSourceTrigger=PropertyChanged}"
                                          Style="{StaticResource S_ComboBoxExt_Prop_Filter}"></controls:ComboBoxExt>
                    <controls:ComboBoxExt SelectedValue="{Binding DialogLocation, UpdateSourceTrigger=PropertyChanged}"
                                          Tag="{DynamicResource String_Tag_Dialog_DialogLocation}"
                                          ItemsSource="{Binding FilteredDialogLocationCVS.View}"
                                          Filter="{Binding DialogLocationFilter, UpdateSourceTrigger=PropertyChanged}"
                                          Style="{StaticResource S_ComboBoxExt_Prop_Filter}"></controls:ComboBoxExt>
                </StackPanel>
            </TabItem>
        </TabControl>
        <DataTemplate.Triggers>
            <DataTrigger Binding="{Binding SelectedNodeType, UpdateSourceTrigger=PropertyChanged}" Value="{x:Type mn:Node_DialogM}">
                <Setter TargetName="btn_selectable_Dialog" Property="Style" Value="{StaticResource S_Button_24x_Selected}"></Setter>
                <Setter TargetName="r_SelectedNodeType" Property="Text" Value="{DynamicResource String_Tag_Node_Dialog_Type}"></Setter>
            </DataTrigger>
            <DataTrigger Binding="{Binding SelectedNodeType, UpdateSourceTrigger=PropertyChanged}" Value="{x:Type mn:Node_ReplicaM}">
                <Setter TargetName="btn_selectable_Replica" Property="Style" Value="{StaticResource S_Button_24x_Selected}"></Setter>
                <Setter TargetName="r_SelectedNodeType" Property="Text" Value="{DynamicResource String_Tag_Node_Replica_Type}"></Setter>
            </DataTrigger>
            <DataTrigger Binding="{Binding SelectedNodeType, UpdateSourceTrigger=PropertyChanged}" Value="{x:Type mn:Node_RandomM}">
                <Setter TargetName="btn_selectable_Random" Property="Style" Value="{StaticResource S_Button_24x_Selected}"></Setter>
                <Setter TargetName="r_SelectedNodeType" Property="Text" Value="{DynamicResource String_Tag_Node_Random_Type}"></Setter>
            </DataTrigger>
            <DataTrigger Binding="{Binding SelectedNodeType, UpdateSourceTrigger=PropertyChanged}" Value="{x:Type mn:Node_TransitM}">
                <Setter TargetName="btn_selectable_Transit" Property="Style" Value="{StaticResource S_Button_24x_Selected}"></Setter>
                <Setter TargetName="r_SelectedNodeType" Property="Text" Value="{DynamicResource String_Tag_Node_Transit_Type}"></Setter>
            </DataTrigger>
            <DataTrigger Binding="{Binding SelectedNodeType, UpdateSourceTrigger=PropertyChanged}" Value="{x:Type mn:Node_GateM}">
                <Setter TargetName="btn_selectable_Gate" Property="Style" Value="{StaticResource S_Button_24x_Selected}"></Setter>
                <Setter TargetName="r_SelectedNodeType" Property="Text" Value="{DynamicResource String_Tag_Node_Gate_Type}"></Setter>
            </DataTrigger>
            <DataTrigger Binding="{Binding SelectedNodeType, UpdateSourceTrigger=PropertyChanged}" Value="{x:Type mn:Node_ExitM}">
                <Setter TargetName="btn_selectable_Exit" Property="Style" Value="{StaticResource S_Button_24x_Selected}"></Setter>
                <Setter TargetName="r_SelectedNodeType" Property="Text" Value="{DynamicResource String_Tag_Node_Exit_Type}"></Setter>
            </DataTrigger>
            <DataTrigger Binding="{Binding SelectedNodeType, UpdateSourceTrigger=PropertyChanged}" Value="{x:Type mn:Node_DelayM}">
                <Setter TargetName="btn_selectable_Delay" Property="Style" Value="{StaticResource S_Button_24x_Selected}"></Setter>
                <Setter TargetName="r_SelectedNodeType" Property="Text" Value="{DynamicResource String_Tag_Node_Delay_Type}"></Setter>
            </DataTrigger>
        </DataTemplate.Triggers>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vmg:ReplicaVM}">
        <Border x:Name="br_Main" Style="{StaticResource S_Border_Selector}"
                    bhvrs:DragDropBehavior.DragEnabled="true"
                    bhvrs:LoadUnloadExtBehavior.LoadedCommand="{Binding RegisterCommand, UpdateSourceTrigger=PropertyChanged}"
                    bhvrs:LoadUnloadExtBehavior.UnloadedCommand="{Binding UnregisterCommand, UpdateSourceTrigger=PropertyChanged}">
            <Border.InputBindings>
                <MouseBinding Gesture="LeftClick" Command="{Binding Path=DataContext.SelectCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=ItemsControl}}" CommandParameter="{Binding}"></MouseBinding>
                <MouseBinding Gesture="RightClick" Command="{Binding InfoCommand}" CommandParameter="{Binding}"></MouseBinding>
            </Border.InputBindings>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition></RowDefinition>
                    <RowDefinition></RowDefinition>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="auto"></ColumnDefinition>
                    <ColumnDefinition Width="*"></ColumnDefinition>
                    <ColumnDefinition Width="auto"></ColumnDefinition>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.RowSpan="2" Text="{StaticResource String_Icon_Replica}" Style="{StaticResource S_TextBlock_Selector_Icon}"></TextBlock>
                <TextBlock Grid.Column="1" Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource S_TextBlock_Selector_Name}"></TextBlock>
                <TextBlock Grid.Column="1" Grid.Row="1" FontStyle="Italic" FontSize="{StaticResource FontSize_Small}" FontWeight="Bold"
                           Text="{Binding ReplicaLocation.name, UpdateSourceTrigger=PropertyChanged, StringFormat=[{0}]}">
                </TextBlock>
                <TextBlock Grid.Column="2" Grid.RowSpan="2" Style="{StaticResource S_TextBlock_Selector_Cut}"></TextBlock>
            </Grid>
        </Border>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vmg:ReplicaEditorVM}">
        <TabControl Padding="0" Margin="0">
            <TabItem Header="{DynamicResource String_Tag_Graph_Tab_View}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="7*"></ColumnDefinition>
                        <ColumnDefinition Width="auto"></ColumnDefinition>
                        <ColumnDefinition Width="3*"></ColumnDefinition>
                    </Grid.ColumnDefinitions>

                    <ItemsControl Style="{StaticResource S_ItemsControl_Graph}"
                                  bhvrs:RenderSizeBehavior.IsEnabled="true"
                                  bhvrs:RenderSizeBehavior.ActualWidth="{Binding Path=(vm:ActiveContext.ViewWidth), UpdateSourceTrigger=PropertyChanged, Mode=OneWayToSource}"
                                  bhvrs:RenderSizeBehavior.ActualHeight="{Binding Path=(vm:ActiveContext.ViewHeight), UpdateSourceTrigger=PropertyChanged, Mode=OneWayToSource}"
                                  bhvrs:RenderSizeBehavior.SizeChangedFlag="{Binding SizeChangedFlag, UpdateSourceTrigger=PropertyChanged, Mode=OneWayToSource}">
                    </ItemsControl>

                    <Grid HorizontalAlignment="Left" VerticalAlignment="Top">
                        <Grid.RowDefinitions>
                            <RowDefinition></RowDefinition>
                            <RowDefinition></RowDefinition>
                        </Grid.RowDefinitions>

                        <StackPanel Orientation="Horizontal">
                            <Button x:Name="btn_selectable_Replica" Style="{StaticResource S_Button_Square_24x}" Content="{StaticResource String_Icon_Node_Replica}" Command="{Binding SelectNodeTypeCommand}" CommandParameter="{x:Type mn:Node_ReplicaM}" ToolTip="{DynamicResource String_Tag_Node_Replica_Type}"></Button>
                            <Button x:Name="btn_selectable_Random" Style="{StaticResource S_Button_Square_24x}" Content="{StaticResource String_Icon_Node_Random}" Command="{Binding SelectNodeTypeCommand}" CommandParameter="{x:Type mn:Node_RandomM}" ToolTip="{DynamicResource String_Tag_Node_Random_Type}"></Button>
                            <Button x:Name="btn_selectable_Transit" Style="{StaticResource S_Button_Square_24x}" Content="{StaticResource String_Icon_Node_Transit}" Command="{Binding SelectNodeTypeCommand}" CommandParameter="{x:Type mn:Node_TransitM}" ToolTip="{DynamicResource String_Tag_Node_Transit_Type}"></Button>
                            <Rectangle Style="{StaticResource S_Rectangle_GraphMenu}"></Rectangle>
                            <Button Style="{StaticResource S_Button_Square_24x}" Content="{StaticResource String_Icon_Bwd}" Command="{Binding PrevRootNodeCommand}" ToolTip="{DynamicResource String_GraphMenu_PrevRootNode_Tooltip}"></Button>
                            <Button Style="{StaticResource S_Button_Square_24x}" Content="{StaticResource String_Icon_Fwd}" Command="{Binding NextRootNodeCommand}" ToolTip="{DynamicResource String_GraphMenu_NextRootNode_Tooltip}"></Button>
                            <Rectangle Style="{StaticResource S_Rectangle_GraphMenu}"></Rectangle>
                            <Button Style="{StaticResource S_Button_Square_24x}" Content="{StaticResource String_Icon_Graph_Origin}" Command="{Binding GoToOriginCommand}" ToolTip="{DynamicResource String_GraphMenu_GoToOrigin_Tooltip}"></Button>
                            <Button Style="{StaticResource S_Button_Square_24x}" Content="{StaticResource String_Icon_Graph_Reset}" Command="{Binding ResetScaleCommand}" ToolTip="{DynamicResource String_GraphMenu_ResetScale_Tooltip}"></Button>
                            <Rectangle Style="{StaticResource S_Rectangle_GraphMenu}"></Rectangle>
                            <Button Style="{StaticResource S_Button_Square_24x}" Content="{StaticResource String_Icon_Play}" Command="{Binding PlayCommand}" ToolTip="{DynamicResource String_GraphMenu_Play_Tooltip}"></Button>
                        </StackPanel>

                        <TextBlock Grid.Row="1" Style="{StaticResource S_TextBlock_Graph_Bold}" Margin="{StaticResource Thickness_Margin_2x}">
                            <Run x:Name="r_SelectedNodeType"></Run>
                            <Run Text="{Binding Scale, UpdateSourceTrigger=PropertyChanged, StringFormat=N2}"></Run>
                            <Run Text="("></Run>
                            <Run Text="{Binding OffsetX, UpdateSourceTrigger=PropertyChanged, StringFormat=N0}"></Run>
                            <Run Text=","></Run>
                            <Run Text="{Binding OffsetY, UpdateSourceTrigger=PropertyChanged, StringFormat=N0}"></Run>
                            <Run Text=")"></Run>
                        </TextBlock>
                    </Grid>

                    <ContentControl Content="{Binding}" HorizontalAlignment="Right" VerticalAlignment="Top" Template="{StaticResource CT_ContentControl_NodePosition}"></ContentControl>

                    <GridSplitter Grid.Column="1"></GridSplitter>

                    <ContentControl Grid.Column="2" Content="{Binding SelectionEditor, UpdateSourceTrigger=PropertyChanged}"></ContentControl>
                </Grid>
            </TabItem>
            <TabItem Header="{DynamicResource String_Tag_Graph_Tab_Props}">
                <StackPanel Orientation="Vertical">
                    <TextBox Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource S_TextBox_Prop}" Tag="{DynamicResource String_Tag_Name}"></TextBox>
                    <TextBox Text="{Binding Description, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource S_TextBox_Prop_Multiline}" Tag="{DynamicResource String_Tag_Description}"></TextBox>
                    <controls:ComboBoxExt SelectedValue="{Binding ReplicaLocation, UpdateSourceTrigger=PropertyChanged}"
                                          Tag="{DynamicResource String_Tag_Dialog_ReplicaLocation}"
                                          ItemsSource="{Binding FilteredReplicaLocationCVS.View}"
                                          Filter="{Binding ReplicaLocationFilter, UpdateSourceTrigger=PropertyChanged}"
                                          Style="{StaticResource S_ComboBoxExt_Prop_Filter}"></controls:ComboBoxExt>
                </StackPanel>
            </TabItem>
        </TabControl>
        <DataTemplate.Triggers>
            <DataTrigger Binding="{Binding SelectedNodeType, UpdateSourceTrigger=PropertyChanged}" Value="{x:Type mn:Node_ReplicaM}">
                <Setter TargetName="btn_selectable_Replica" Property="Style" Value="{StaticResource S_Button_24x_Selected}"></Setter>
                <Setter TargetName="r_SelectedNodeType" Property="Text" Value="{DynamicResource String_Tag_Node_Replica_Type}"></Setter>
            </DataTrigger>
            <DataTrigger Binding="{Binding SelectedNodeType, UpdateSourceTrigger=PropertyChanged}" Value="{x:Type mn:Node_RandomM}">
                <Setter TargetName="btn_selectable_Random" Property="Style" Value="{StaticResource S_Button_24x_Selected}"></Setter>
                <Setter TargetName="r_SelectedNodeType" Property="Text" Value="{DynamicResource String_Tag_Node_Random_Type}"></Setter>
            </DataTrigger>
            <DataTrigger Binding="{Binding SelectedNodeType, UpdateSourceTrigger=PropertyChanged}" Value="{x:Type mn:Node_TransitM}">
                <Setter TargetName="btn_selectable_Transit" Property="Style" Value="{StaticResource S_Button_24x_Selected}"></Setter>
                <Setter TargetName="r_SelectedNodeType" Property="Text" Value="{DynamicResource String_Tag_Node_Transit_Type}"></Setter>
            </DataTrigger>
        </DataTemplate.Triggers>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vmn:PreviewLinkVM}">
        <Grid IsHitTestVisible="False"
              bhvrs:LoadUnloadExtBehavior.LoadedCommand="{Binding RegisterCommand, UpdateSourceTrigger=PropertyChanged}"
              bhvrs:LoadUnloadExtBehavior.UnloadedCommand="{Binding UnregisterCommand, UpdateSourceTrigger=PropertyChanged}">
            <Polygon x:Name="pg_Main" Points="{Binding StepPoints}" Stroke="{StaticResource Color_PreviewLink_Disallow}" StrokeThickness="{Binding StrokeThickness, UpdateSourceTrigger=PropertyChanged}" Fill="{StaticResource Color_PreviewLink_Disallow}"></Polygon>
            <Polygon x:Name="pg_Indicator" Points="{Binding RemovePoints}" Stroke="{StaticResource Color_Link_Foreground}" StrokeThickness="{Binding StrokeThickness, UpdateSourceTrigger=PropertyChanged}" Fill="{StaticResource Color_PreviewLink_Disallow}"></Polygon>
            <!--Here two Polyline are used just for one Cross because of WPF render bug check -->
            <Line x:Name="ln_1" X1="{Binding Cross1_X1, UpdateSourceTrigger=PropertyChanged}" Y1="{Binding Cross1_Y1, UpdateSourceTrigger=PropertyChanged}"
                      X2="{Binding Cross1_X2, UpdateSourceTrigger=PropertyChanged}" Y2="{Binding Cross1_Y2, UpdateSourceTrigger=PropertyChanged}"
                      Stroke="{StaticResource Color_Link_Foreground}" StrokeThickness="{Binding CrossStrokeThickness, UpdateSourceTrigger=PropertyChanged}"></Line>
            <Line x:Name="ln_2" X1="{Binding Cross2_X1, UpdateSourceTrigger=PropertyChanged}" Y1="{Binding Cross2_Y1, UpdateSourceTrigger=PropertyChanged}"
                      X2="{Binding Cross2_X2, UpdateSourceTrigger=PropertyChanged}" Y2="{Binding Cross2_Y2, UpdateSourceTrigger=PropertyChanged}"
                      Stroke="{StaticResource Color_Link_Foreground}" StrokeThickness="{Binding CrossStrokeThickness, UpdateSourceTrigger=PropertyChanged}"></Line>
        </Grid>
        <DataTemplate.Triggers>
            <DataTrigger Binding="{Binding Description, UpdateSourceTrigger=PropertyChanged}" Value="{x:Null}">
                <Setter TargetName="pg_Main" Property="Stroke" Value="{StaticResource Color_PreviewLink}"></Setter>
                <Setter TargetName="pg_Main" Property="Fill" Value="{StaticResource Color_PreviewLink}"></Setter>
                <Setter TargetName="pg_Indicator" Property="Visibility" Value="Collapsed"></Setter>
                <Setter TargetName="ln_1" Property="Visibility" Value="Collapsed"></Setter>
                <Setter TargetName="ln_2" Property="Visibility" Value="Collapsed"></Setter>
            </DataTrigger>
            <DataTrigger Binding="{Binding Description, UpdateSourceTrigger=PropertyChanged}" Value="">
                <Setter TargetName="pg_Main" Property="Stroke" Value="{StaticResource Color_PreviewLink_Allow}"></Setter>
                <Setter TargetName="pg_Main" Property="Fill" Value="{StaticResource Color_PreviewLink_Allow}"></Setter>
                <Setter TargetName="pg_Indicator" Property="Visibility" Value="Visible"></Setter>
                <Setter TargetName="pg_Indicator" Property="Fill" Value="{StaticResource Color_PreviewLink_Allow}"></Setter>
                <Setter TargetName="ln_1" Property="Visibility" Value="Visible"></Setter>
                <Setter TargetName="ln_2" Property="Visibility" Value="Visible"></Setter>
            </DataTrigger>
        </DataTemplate.Triggers>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vmn:LinkVM}">
        <Grid 
                  bhvrs:LoadUnloadExtBehavior.LoadedCommand="{Binding RegisterCommand, UpdateSourceTrigger=PropertyChanged}"
                  bhvrs:LoadUnloadExtBehavior.UnloadedCommand="{Binding UnregisterCommand, UpdateSourceTrigger=PropertyChanged}">
            <Polygon IsHitTestVisible="False" Points="{Binding StepPoints}" Stroke="{StaticResource Color_Link}" StrokeThickness="{Binding StrokeThickness, UpdateSourceTrigger=PropertyChanged}" Fill="{StaticResource Color_Link}"></Polygon>
            <Polygon Points="{Binding RemovePoints}" Stroke="{StaticResource Color_Link_Foreground}" StrokeThickness="{Binding StrokeThickness, UpdateSourceTrigger=PropertyChanged}" 
                         Fill="{StaticResource Color_Remove}">
                <Polygon.InputBindings>
                    <MouseBinding Gesture="LeftClick" Command="{Binding Path=DataContext.RemoveElementCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=ItemsControl}}" CommandParameter="{Binding}"></MouseBinding>
                </Polygon.InputBindings>
            </Polygon>
            <!--Here two Polyline are used just for one Cross because of WPF render bug check -->
            <Line IsHitTestVisible="False" X1="{Binding Cross1_X1, UpdateSourceTrigger=PropertyChanged}" Y1="{Binding Cross1_Y1, UpdateSourceTrigger=PropertyChanged}"
                      X2="{Binding Cross1_X2, UpdateSourceTrigger=PropertyChanged}" Y2="{Binding Cross1_Y2, UpdateSourceTrigger=PropertyChanged}"
                      Stroke="{StaticResource Color_Link_Foreground}" StrokeThickness="{Binding StrokeThickness, UpdateSourceTrigger=PropertyChanged}"></Line>
            <Line IsHitTestVisible="False" X1="{Binding Cross2_X1, UpdateSourceTrigger=PropertyChanged}" Y1="{Binding Cross2_Y1, UpdateSourceTrigger=PropertyChanged}"
                      X2="{Binding Cross2_X2, UpdateSourceTrigger=PropertyChanged}" Y2="{Binding Cross2_Y2, UpdateSourceTrigger=PropertyChanged}"
                      Stroke="{StaticResource Color_Link_Foreground}" StrokeThickness="{Binding StrokeThickness, UpdateSourceTrigger=PropertyChanged}"></Line>
        </Grid>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vmn:SelectionBoxVM}">
        <Grid IsHitTestVisible="False">
            <Line X1="0" Y1="0"
                      X2="0" Y2="{Binding HandleY, UpdateSourceTrigger=PropertyChanged}"
                      Stroke="{StaticResource Color_Link}" StrokeThickness="{Binding StrokeThickness, UpdateSourceTrigger=PropertyChanged}" StrokeDashArray="4, 8"></Line>
            <Line X1="0" Y1="{Binding HandleY, UpdateSourceTrigger=PropertyChanged}"
                      X2="{Binding HandleX, UpdateSourceTrigger=PropertyChanged}" Y2="{Binding HandleY, UpdateSourceTrigger=PropertyChanged}"
                      Stroke="{StaticResource Color_Link}" StrokeThickness="{Binding StrokeThickness, UpdateSourceTrigger=PropertyChanged}" StrokeDashArray="4, 8"></Line>
            <Line X1="{Binding HandleX, UpdateSourceTrigger=PropertyChanged}" Y1="{Binding HandleY, UpdateSourceTrigger=PropertyChanged}"
                      X2="{Binding HandleX, UpdateSourceTrigger=PropertyChanged}" Y2="0"
                      Stroke="{StaticResource Color_Link}" StrokeThickness="{Binding StrokeThickness, UpdateSourceTrigger=PropertyChanged}" StrokeDashArray="4, 8"></Line>
            <Line X1="{Binding HandleX, UpdateSourceTrigger=PropertyChanged}" Y1="0"
                      X2="0" Y2="0"
                      Stroke="{StaticResource Color_Link}" StrokeThickness="{Binding StrokeThickness, UpdateSourceTrigger=PropertyChanged}" StrokeDashArray="4, 8"></Line>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="DT_ComboBoxItem_DialogOrReplica">
        <TextBlock>
            <Run x:Name="r_Icon"></Run>
            <Run Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}"></Run>
        </TextBlock>
        <DataTemplate.Triggers>
            
        </DataTemplate.Triggers>
    </DataTemplate>
    
    <DataTemplate DataType="{x:Type vmp:P_Dialog_HasVM}">
        <controls:ComboBoxExt SelectedValue="{Binding DialogOrReplica, UpdateSourceTrigger=PropertyChanged}"
                                          Tag="{DynamicResource String_Tag_Predicate_DialogOrReplica}"
                                          ItemsSource="{Binding DialogsAndReplicasCVS.View}"
                                          Filter="{Binding DialogsAndReplicasFilter, UpdateSourceTrigger=PropertyChanged}"
                                          Style="{StaticResource S_ComboBoxExt_Prop_Filter}"></controls:ComboBoxExt>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vmp:P_Dialog_Node_Has_PrevSessionsVM}">
        <StackPanel Orientation="Vertical">
            <controls:ComboBoxExt x:Name="cmb_DialogOrReplica" SelectedValue="{Binding DialogOrReplica, UpdateSourceTrigger=PropertyChanged}"
                                          Tag="{DynamicResource String_Tag_Predicate_DialogOrReplica}"
                                          ItemsSource="{Binding DialogsAndReplicasCVS.View}"
                                          Filter="{Binding DialogsAndReplicasFilter, UpdateSourceTrigger=PropertyChanged}"
                                          Style="{StaticResource S_ComboBoxExt_Prop_Filter}"></controls:ComboBoxExt>
            <controls:ComboBoxExt x:Name="cmb_Node" SelectedValue="{Binding Node, UpdateSourceTrigger=PropertyChanged}"
                                          Tag="{DynamicResource String_Tag_Predicate_Node}"
                                          ItemsSource="{Binding NodesCVS.View}"
                                          Filter="{Binding NodesFilter, UpdateSourceTrigger=PropertyChanged}"
                                          Style="{StaticResource S_ComboBoxExt_Prop_Filter}"></controls:ComboBoxExt>
        </StackPanel>
        <DataTemplate.Triggers>
            <Trigger SourceName="cmb_DialogOrReplica" Property="SelectedValue" Value="{x:Null}">
                <Setter TargetName="cmb_Node" Property="Visibility" Value="Collapsed"></Setter>
            </Trigger>
        </DataTemplate.Triggers>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vmp:P_Dialog_Node_Has_ActiveSessionVM}">
        <controls:ComboBoxExt SelectedValue="{Binding Node, UpdateSourceTrigger=PropertyChanged}"
                                          Tag="{DynamicResource String_Tag_Predicate_Node}"
                                          ItemsSource="{Binding NodesCVS.View}"
                                          Filter="{Binding NodesFilter, UpdateSourceTrigger=PropertyChanged}"
                                          Style="{StaticResource S_ComboBoxExt_Prop_Filter}"></controls:ComboBoxExt>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vmp:P_Dialog_Node_Has_PrevSessions_CmpVM}">
        <StackPanel Orientation="Vertical">
            <controls:ComboBoxExt x:Name="cmb_DialogOrReplica" SelectedValue="{Binding DialogOrReplica, UpdateSourceTrigger=PropertyChanged}"
                                          Tag="{DynamicResource String_Tag_Predicate_DialogOrReplica}"
                                          ItemsSource="{Binding DialogsAndReplicasCVS.View}"
                                          Filter="{Binding DialogsAndReplicasFilter, UpdateSourceTrigger=PropertyChanged}"
                                          Style="{StaticResource S_ComboBoxExt_Prop_Filter}"></controls:ComboBoxExt>
            <controls:ComboBoxExt x:Name="cmb_Node" SelectedValue="{Binding Node, UpdateSourceTrigger=PropertyChanged}"
                                          Tag="{DynamicResource String_Tag_Predicate_Node}"
                                          ItemsSource="{Binding NodesCVS.View}"
                                          Filter="{Binding NodesFilter, UpdateSourceTrigger=PropertyChanged}"
                                          Style="{StaticResource S_ComboBoxExt_Prop_Filter}"></controls:ComboBoxExt>
            <GroupBox x:Name="gb_Compare" Header="{DynamicResource String_Tag_Predicate_Compare}" HeaderTemplate="{StaticResource DT_GroupBox_HeaderTemplate_Prop}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition></RowDefinition>
                        <RowDefinition></RowDefinition>
                        <RowDefinition></RowDefinition>
                    </Grid.RowDefinitions>
                    <ContentControl Margin="{StaticResource Thickness_Margin_1x}" Content="{Binding}" Template="{StaticResource CT_ContentControl_CompareType}"></ContentControl>
                    <TextBlock Grid.Row="1" HorizontalAlignment="Center" Text="{Binding Value, UpdateSourceTrigger=PropertyChanged}"></TextBlock>
                    <Slider
                        Grid.Row="2"
                        Value="{Binding Value, UpdateSourceTrigger=PropertyChanged}"
                        Minimum="{StaticResource Double_Dialog_Node_Min}"
                        Maximum="{StaticResource Double_Dialog_Node_Max}"
                        TickFrequency="{StaticResource Double_Dialog_Node_Tick}"
                        ></Slider>
                </Grid>
            </GroupBox>
        </StackPanel>
        <DataTemplate.Triggers>
            <Trigger SourceName="cmb_DialogOrReplica" Property="SelectedValue" Value="{x:Null}">
                <Setter TargetName="cmb_Node" Property="Visibility" Value="Collapsed"></Setter>
                <Setter TargetName="gb_Compare" Property="Visibility" Value="Collapsed"></Setter>
            </Trigger>
            <Trigger SourceName="cmb_Node" Property="SelectedValue" Value="{x:Null}">
                <Setter TargetName="gb_Compare" Property="Visibility" Value="Collapsed"></Setter>
            </Trigger>
        </DataTemplate.Triggers>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vmp:P_Dialog_Node_Has_ActiveSession_CmpVM}">
        <StackPanel Orientation="Vertical">
            <controls:ComboBoxExt x:Name="cmb_Node" SelectedValue="{Binding Node, UpdateSourceTrigger=PropertyChanged}"
                                          Tag="{DynamicResource String_Tag_Predicate_Node}"
                                          ItemsSource="{Binding NodesCVS.View}"
                                          Filter="{Binding NodesFilter, UpdateSourceTrigger=PropertyChanged}"
                                          Style="{StaticResource S_ComboBoxExt_Prop_Filter}"></controls:ComboBoxExt>
            <GroupBox x:Name="gb_Compare" Header="{DynamicResource String_Tag_Predicate_Compare}" HeaderTemplate="{StaticResource DT_GroupBox_HeaderTemplate_Prop}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition></RowDefinition>
                        <RowDefinition></RowDefinition>
                        <RowDefinition></RowDefinition>
                    </Grid.RowDefinitions>
                    <ContentControl Margin="{StaticResource Thickness_Margin_1x}" Content="{Binding}" Template="{StaticResource CT_ContentControl_CompareType}"></ContentControl>
                    <TextBlock Grid.Row="1" HorizontalAlignment="Center" Text="{Binding Value, UpdateSourceTrigger=PropertyChanged}"></TextBlock>
                    <Slider
                        Grid.Row="2"
                        Value="{Binding Value, UpdateSourceTrigger=PropertyChanged}"
                        Minimum="{StaticResource Double_Dialog_Node_Min}"
                        Maximum="{StaticResource Double_Dialog_Node_Max}"
                        TickFrequency="{StaticResource Double_Dialog_Node_Tick}"
                        ></Slider>
                </Grid>
            </GroupBox>
        </StackPanel>
        <DataTemplate.Triggers>
            <Trigger SourceName="cmb_Node" Property="SelectedValue" Value="{x:Null}">
                <Setter TargetName="gb_Compare" Property="Visibility" Value="Collapsed"></Setter>
            </Trigger>
        </DataTemplate.Triggers>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vmp:P_Item_HasVM}">
        <controls:ComboBoxExt SelectedValue="{Binding Item, UpdateSourceTrigger=PropertyChanged}"
                                          Tag="{DynamicResource String_Tag_Predicate_Item}"
                                          ItemsSource="{Binding ItemsCVS.View}"
                                          Filter="{Binding ItemsFilter, UpdateSourceTrigger=PropertyChanged}"
                                          Style="{StaticResource S_ComboBoxExt_Prop_Filter}"></controls:ComboBoxExt>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vmp:P_Quest_AddedVM}">
        <controls:ComboBoxExt SelectedValue="{Binding Quest, UpdateSourceTrigger=PropertyChanged}"
                                          Tag="{DynamicResource String_Tag_Predicate_Quest}"
                                          ItemsSource="{Binding QuestsCVS.View}"
                                          Filter="{Binding QuestsFilter, UpdateSourceTrigger=PropertyChanged}"
                                          Style="{StaticResource S_ComboBoxExt_Prop_Filter}"></controls:ComboBoxExt>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vmp:P_Quest_FinishedVM}">
        <controls:ComboBoxExt SelectedValue="{Binding Quest, UpdateSourceTrigger=PropertyChanged}"
                                          Tag="{DynamicResource String_Tag_Predicate_Quest}"
                                          ItemsSource="{Binding QuestsCVS.View}"
                                          Filter="{Binding QuestsFilter, UpdateSourceTrigger=PropertyChanged}"
                                          Style="{StaticResource S_ComboBoxExt_Prop_Filter}"></controls:ComboBoxExt>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vmp:P_Relation_HasVM}">
        <StackPanel Orientation="Vertical">
            <controls:ComboBoxExt x:Name="cmb_Characters" SelectedValue="{Binding Character, UpdateSourceTrigger=PropertyChanged}"
                                          Tag="{DynamicResource String_Tag_Predicate_Character}"
                                          ItemsSource="{Binding CharactersCVS.View}"
                                          Filter="{Binding CharactersFilter, UpdateSourceTrigger=PropertyChanged}"
                                          Style="{StaticResource S_ComboBoxExt_Prop_Filter}"></controls:ComboBoxExt>
            <GroupBox x:Name="gb_Compare" Header="{DynamicResource String_Tag_Predicate_Compare}" HeaderTemplate="{StaticResource DT_GroupBox_HeaderTemplate_Prop}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition></RowDefinition>
                        <RowDefinition></RowDefinition>
                        <RowDefinition></RowDefinition>
                    </Grid.RowDefinitions>
                    <ContentControl Margin="{StaticResource Thickness_Margin_1x}" Content="{Binding}" Template="{StaticResource CT_ContentControl_CompareType}"></ContentControl>
                    <TextBlock Grid.Row="1" HorizontalAlignment="Center" Text="{Binding Value, UpdateSourceTrigger=PropertyChanged, StringFormat=N2}"></TextBlock>
                    <Slider
                        Grid.Row="2"
                        Value="{Binding Value, UpdateSourceTrigger=PropertyChanged}"
                        Minimum="{StaticResource Double_Relation_Min}"
                        Maximum="{StaticResource Double_Relation_Max}"
                        TickFrequency="{StaticResource Double_Relation_Tick}"
                        ></Slider>
                </Grid>
            </GroupBox>
        </StackPanel>
        <DataTemplate.Triggers>
            <Trigger SourceName="cmb_Characters" Property="SelectedValue" Value="{x:Null}">
                <Setter TargetName="gb_Compare" Property="Visibility" Value="Collapsed"></Setter>
            </Trigger>
        </DataTemplate.Triggers>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vmp:P_Quest_Node_AddedVM}">
        <StackPanel Orientation="Vertical">
            <controls:ComboBoxExt x:Name="cmb_Quest" SelectedValue="{Binding Quest, UpdateSourceTrigger=PropertyChanged}"
                                          Tag="{DynamicResource String_Tag_Predicate_Quest}"
                                          ItemsSource="{Binding QuestsCVS.View}"
                                          Filter="{Binding QuestsFilter, UpdateSourceTrigger=PropertyChanged}"
                                          Style="{StaticResource S_ComboBoxExt_Prop_Filter}"></controls:ComboBoxExt>
            <controls:ComboBoxExt x:Name="cmb_Node" SelectedValue="{Binding Node, UpdateSourceTrigger=PropertyChanged}"
                                          Tag="{DynamicResource String_Tag_Predicate_Node}"
                                          ItemsSource="{Binding NodesCVS.View}"
                                          Filter="{Binding NodesFilter, UpdateSourceTrigger=PropertyChanged}"
                                          Style="{StaticResource S_ComboBoxExt_Prop_Filter}"></controls:ComboBoxExt>
        </StackPanel>
        <DataTemplate.Triggers>
            <Trigger SourceName="cmb_Quest" Property="SelectedValue" Value="{x:Null}">
                <Setter TargetName="cmb_Node" Property="Visibility" Value="Collapsed"></Setter>
            </Trigger>
        </DataTemplate.Triggers>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vmp:P_Quest_Node_PassedVM}">
        <StackPanel Orientation="Vertical">
            <controls:ComboBoxExt x:Name="cmb_Quest" SelectedValue="{Binding Quest, UpdateSourceTrigger=PropertyChanged}"
                                          Tag="{DynamicResource String_Tag_Predicate_Quest}"
                                          ItemsSource="{Binding QuestsCVS.View}"
                                          Filter="{Binding QuestsFilter, UpdateSourceTrigger=PropertyChanged}"
                                          Style="{StaticResource S_ComboBoxExt_Prop_Filter}"></controls:ComboBoxExt>
            <controls:ComboBoxExt x:Name="cmb_Node" SelectedValue="{Binding Node, UpdateSourceTrigger=PropertyChanged}"
                                          Tag="{DynamicResource String_Tag_Predicate_Node}"
                                          ItemsSource="{Binding NodesCVS.View}"
                                          Filter="{Binding NodesFilter, UpdateSourceTrigger=PropertyChanged}"
                                          Style="{StaticResource S_ComboBoxExt_Prop_Filter}"></controls:ComboBoxExt>
        </StackPanel>
        <DataTemplate.Triggers>
            <Trigger SourceName="cmb_Quest" Property="SelectedValue" Value="{x:Null}">
                <Setter TargetName="cmb_Node" Property="Visibility" Value="Collapsed"></Setter>
            </Trigger>
        </DataTemplate.Triggers>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vmp:P_CompositeVM}">
        <Grid Margin="{StaticResource Thickness_Left_16x}">
            <Grid.RowDefinitions>
                <RowDefinition></RowDefinition>
                <RowDefinition></RowDefinition>
                <RowDefinition></RowDefinition>
            </Grid.RowDefinitions>

            <GroupBox Margin="{StaticResource Thickness_Margin_2x}" Header="{StaticResource String_Icon_Composite_A}" HeaderTemplate="{StaticResource DT_GroupBox_HeaderTemplate_Prop}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition></RowDefinition>
                        <RowDefinition></RowDefinition>
                    </Grid.RowDefinitions>
                    <ComboBox x:Name="cmb_PredicateA" SelectedValue="{Binding SubTypeA, UpdateSourceTrigger=PropertyChanged}" FontSize="{StaticResource FontSize_Small}"
                      ItemTemplate="{StaticResource DT_ComboBoxItem_Predicate}">
                        <sys:Type>mp:P_CompositeM</sys:Type>
                        <sys:Type>mp:P_Dialog_HasM</sys:Type>
                        <sys:Type>mp:P_Dialog_Node_Has_ActiveSession_CmpM</sys:Type>
                        <sys:Type>mp:P_Dialog_Node_Has_ActiveSessionM</sys:Type>
                        <sys:Type>mp:P_Dialog_Node_Has_PrevSessions_CmpM</sys:Type>
                        <sys:Type>mp:P_Dialog_Node_Has_PrevSessionsM</sys:Type>
                        <sys:Type>mp:P_Item_HasM</sys:Type>
                        <sys:Type>mp:P_Quest_AddedM</sys:Type>
                        <sys:Type>mp:P_Quest_FinishedM</sys:Type>
                        <sys:Type>mp:P_Quest_Node_AddedM</sys:Type>
                        <sys:Type>mp:P_Quest_Node_PassedM</sys:Type>
                        <sys:Type>mp:P_Relation_HasM</sys:Type>
                    </ComboBox>
                    <ContentControl Grid.Row="1" Content="{Binding PredicateA, UpdateSourceTrigger=PropertyChanged}"></ContentControl>
                </Grid>
            </GroupBox>

            <ComboBox Margin="{StaticResource Thickness_Margin_8x}" Grid.Row="1" SelectedValue="{Binding CompositionType}" ItemTemplate="{StaticResource DT_ListBoxItem_CompositionType}" FontSize="{StaticResource FontSize_Small}">
                <x:Static Member="m:COMPOSITION_TYPE.AND"></x:Static>
                <x:Static Member="m:COMPOSITION_TYPE.OR"></x:Static>
                <x:Static Member="m:COMPOSITION_TYPE.XOR"></x:Static>
            </ComboBox>

            <GroupBox Margin="{StaticResource Thickness_Margin_2x}" Grid.Row="2" Header="{StaticResource String_Icon_Composite_B}" HeaderTemplate="{StaticResource DT_GroupBox_HeaderTemplate_Prop}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition></RowDefinition>
                        <RowDefinition></RowDefinition>
                    </Grid.RowDefinitions>
                    <ComboBox x:Name="cmb_PredicateB" SelectedValue="{Binding SubTypeB, UpdateSourceTrigger=PropertyChanged}" FontSize="{StaticResource FontSize_Small}"
                      ItemTemplate="{StaticResource DT_ComboBoxItem_Predicate}">
                        <sys:Type>mp:P_CompositeM</sys:Type>
                        <sys:Type>mp:P_Dialog_HasM</sys:Type>
                        <sys:Type>mp:P_Dialog_Node_Has_ActiveSession_CmpM</sys:Type>
                        <sys:Type>mp:P_Dialog_Node_Has_ActiveSessionM</sys:Type>
                        <sys:Type>mp:P_Dialog_Node_Has_PrevSessions_CmpM</sys:Type>
                        <sys:Type>mp:P_Dialog_Node_Has_PrevSessionsM</sys:Type>
                        <sys:Type>mp:P_Item_HasM</sys:Type>
                        <sys:Type>mp:P_Quest_AddedM</sys:Type>
                        <sys:Type>mp:P_Quest_FinishedM</sys:Type>
                        <sys:Type>mp:P_Quest_Node_AddedM</sys:Type>
                        <sys:Type>mp:P_Quest_Node_PassedM</sys:Type>
                        <sys:Type>mp:P_Relation_HasM</sys:Type>
                    </ComboBox>
                    <ContentControl Grid.Row="1" Content="{Binding PredicateB, UpdateSourceTrigger=PropertyChanged}"></ContentControl>
                </Grid>
            </GroupBox>
        </Grid>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vmb:B_OptionalVM}">
        <GroupBox Header="{DynamicResource String_Tag_Behavior_B_OptionalM_SkipChance}" HeaderTemplate="{StaticResource DT_GroupBox_HeaderTemplate_Prop}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition></RowDefinition>
                    <RowDefinition></RowDefinition>
                </Grid.RowDefinitions>
                <TextBlock HorizontalAlignment="Center" Text="{Binding SkipChance, UpdateSourceTrigger=PropertyChanged, StringFormat={}{0}%}"></TextBlock>
                <Slider x:Name="sl_"
                        Grid.Row="1"
                        Value="{Binding SkipChance, UpdateSourceTrigger=PropertyChanged}"
                        Minimum="{StaticResource Double_Behavior_OptionalM_SkipChance_Min}"
                        Maximum="{StaticResource Double_Behavior_OptionalM_SkipChance_Max}"
                        TickFrequency="{StaticResource Double_Behavior_OptionalM_SkipChance_Tick}"
                        ></Slider>
            </Grid>
        </GroupBox>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vmge:GE_CustomVM}">
        <TextBox Text="{Binding CustomStringParam, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource S_TextBox_Prop}" Tag="{DynamicResource String_Tag_CustomStringParam}"></TextBox>
    </DataTemplate>
    
    <DataTemplate DataType="{x:Type vmge:GE_Item_DropVM}">
        <controls:ComboBoxExt SelectedValue="{Binding Item, UpdateSourceTrigger=PropertyChanged}"
                                          Tag="{DynamicResource String_Tag_Predicate_Item}"
                                          ItemsSource="{Binding ItemsCVS.View}"
                                          Filter="{Binding ItemsFilter, UpdateSourceTrigger=PropertyChanged}"
                                          Style="{StaticResource S_ComboBoxExt_Prop_Filter}"></controls:ComboBoxExt>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vmge:GE_Item_PickUpVM}">
        <controls:ComboBoxExt SelectedValue="{Binding Item, UpdateSourceTrigger=PropertyChanged}"
                                          Tag="{DynamicResource String_Tag_Predicate_Item}"
                                          ItemsSource="{Binding ItemsCVS.View}"
                                          Filter="{Binding ItemsFilter, UpdateSourceTrigger=PropertyChanged}"
                                          Style="{StaticResource S_ComboBoxExt_Prop_Filter}"></controls:ComboBoxExt>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vmge:GE_Quest_AddVM}">
        <controls:ComboBoxExt SelectedValue="{Binding Quest, UpdateSourceTrigger=PropertyChanged}"
                                          Tag="{DynamicResource String_Tag_Predicate_Quest}"
                                          ItemsSource="{Binding QuestsCVS.View}"
                                          Filter="{Binding QuestsFilter, UpdateSourceTrigger=PropertyChanged}"
                                          Style="{StaticResource S_ComboBoxExt_Prop_Filter}"></controls:ComboBoxExt>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vmge:GE_Quest_Node_AddVM}">
        <StackPanel Orientation="Vertical">
            <controls:ComboBoxExt x:Name="cmb_Quest" SelectedValue="{Binding Quest, UpdateSourceTrigger=PropertyChanged}"
                                          Tag="{DynamicResource String_Tag_Predicate_Quest}"
                                          ItemsSource="{Binding QuestsCVS.View}"
                                          Filter="{Binding QuestsFilter, UpdateSourceTrigger=PropertyChanged}"
                                          Style="{StaticResource S_ComboBoxExt_Prop_Filter}"></controls:ComboBoxExt>
            <controls:ComboBoxExt x:Name="cmb_Node" SelectedValue="{Binding Node, UpdateSourceTrigger=PropertyChanged}"
                                          Tag="{DynamicResource String_Tag_Predicate_Node}"
                                          ItemsSource="{Binding NodesCVS.View}"
                                          Filter="{Binding NodesFilter, UpdateSourceTrigger=PropertyChanged}"
                                          Style="{StaticResource S_ComboBoxExt_Prop_Filter}"></controls:ComboBoxExt>
        </StackPanel>
        <DataTemplate.Triggers>
            <Trigger SourceName="cmb_Quest" Property="SelectedValue" Value="{x:Null}">
                <Setter TargetName="cmb_Node" Property="Visibility" Value="Collapsed"></Setter>
            </Trigger>
        </DataTemplate.Triggers>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vmge:GE_Quest_Node_PassVM}">
        <StackPanel Orientation="Vertical">
            <controls:ComboBoxExt x:Name="cmb_Quest" SelectedValue="{Binding Quest, UpdateSourceTrigger=PropertyChanged}"
                                          Tag="{DynamicResource String_Tag_Predicate_Quest}"
                                          ItemsSource="{Binding QuestsCVS.View}"
                                          Filter="{Binding QuestsFilter, UpdateSourceTrigger=PropertyChanged}"
                                          Style="{StaticResource S_ComboBoxExt_Prop_Filter}"></controls:ComboBoxExt>
            <controls:ComboBoxExt x:Name="cmb_Node" SelectedValue="{Binding Node, UpdateSourceTrigger=PropertyChanged}"
                                          Tag="{DynamicResource String_Tag_Predicate_Node}"
                                          ItemsSource="{Binding NodesCVS.View}"
                                          Filter="{Binding NodesFilter, UpdateSourceTrigger=PropertyChanged}"
                                          Style="{StaticResource S_ComboBoxExt_Prop_Filter}"></controls:ComboBoxExt>
        </StackPanel>
        <DataTemplate.Triggers>
            <Trigger SourceName="cmb_Quest" Property="SelectedValue" Value="{x:Null}">
                <Setter TargetName="cmb_Node" Property="Visibility" Value="Collapsed"></Setter>
            </Trigger>
        </DataTemplate.Triggers>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vmge:GE_Relation_ChangeVM}">
        <StackPanel Orientation="Vertical">
            <controls:ComboBoxExt x:Name="cmb_Characters" SelectedValue="{Binding Character, UpdateSourceTrigger=PropertyChanged}"
                                          Tag="{DynamicResource String_Tag_Predicate_Character}"
                                          ItemsSource="{Binding CharactersCVS.View}"
                                          Filter="{Binding CharactersFilter, UpdateSourceTrigger=PropertyChanged}"
                                          Style="{StaticResource S_ComboBoxExt_Prop_Filter}"></controls:ComboBoxExt>
            <GroupBox x:Name="gb_Compare" Header="{DynamicResource String_Tag_GameEvent_GE_Relation_ChangeM}" HeaderTemplate="{StaticResource DT_GroupBox_HeaderTemplate_Prop}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition></RowDefinition>
                        <RowDefinition></RowDefinition>
                    </Grid.RowDefinitions>
                    <TextBlock HorizontalAlignment="Center" Text="{Binding Value, UpdateSourceTrigger=PropertyChanged, StringFormat=N2}"></TextBlock>
                    <Slider
                        Grid.Row="1"
                        Value="{Binding Value, UpdateSourceTrigger=PropertyChanged}"
                        Minimum="{StaticResource Double_RelationDelta_Min}"
                        Maximum="{StaticResource Double_RelationDelta_Max}"
                        TickFrequency="{StaticResource Double_Relation_Tick}"
                        ></Slider>
                </Grid>
            </GroupBox>
        </StackPanel>
        <DataTemplate.Triggers>
            <Trigger SourceName="cmb_Characters" Property="SelectedValue" Value="{x:Null}">
                <Setter TargetName="gb_Compare" Property="Visibility" Value="Collapsed"></Setter>
            </Trigger>
        </DataTemplate.Triggers>
    </DataTemplate>

    <x:Array x:Key="ARRAY_Languages" Type="{x:Type sys:Byte}">
        <x:Static Member="vmconfig:LANGUAGE.ENG"></x:Static>
        <x:Static Member="vmconfig:LANGUAGE.RUS"></x:Static>
        <x:Static Member="vmconfig:LANGUAGE.UKR"></x:Static>
    </x:Array>

    <DataTemplate x:Key="DT_ListBoxItem_Language">
        <TextBlock x:Name="tb_Main"></TextBlock>
        <DataTemplate.Triggers>
            <Trigger SourceName="tb_Main" Property="DataContext" Value="{x:Static vmconfig:LANGUAGE.ENG}">
                <Setter TargetName="tb_Main" Property="Text" Value="{StaticResource String_Tag_ENG}"></Setter>
            </Trigger>
            <Trigger SourceName="tb_Main" Property="DataContext" Value="{x:Static vmconfig:LANGUAGE.RUS}">
                <Setter TargetName="tb_Main" Property="Text" Value="{StaticResource String_Tag_RUS}"></Setter>
            </Trigger>
            <Trigger SourceName="tb_Main" Property="DataContext" Value="{x:Static vmconfig:LANGUAGE.UKR}">
                <Setter TargetName="tb_Main" Property="Text" Value="{StaticResource String_Tag_UKR}"></Setter>
            </Trigger>
        </DataTemplate.Triggers>
    </DataTemplate>
    
    <DataTemplate DataType="{x:Type config:ConfigVM}">
        <StackPanel Orientation="Vertical">
            <GroupBox Header="{DynamicResource String_Tag_Config_Language}" HeaderTemplate="{StaticResource DT_GroupBox_HeaderTemplate_Prop}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"></ColumnDefinition>
                        <ColumnDefinition Width="*"></ColumnDefinition>
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="{DynamicResource String_Tag_Config_Language}"></TextBlock>
                    <ComboBox Grid.Column="1" ItemsSource="{StaticResource ARRAY_Languages}" SelectedValue="{Binding Language, UpdateSourceTrigger=PropertyChanged}"
                              ItemTemplate="{StaticResource DT_ListBoxItem_Language}"></ComboBox>
                </Grid>
            </GroupBox>
            <GroupBox Header="{DynamicResource String_Tag_Config_UserActions}" HeaderTemplate="{StaticResource DT_GroupBox_HeaderTemplate_Prop}">
                <ItemsControl ItemsSource="{Binding UserActions}"></ItemsControl>
            </GroupBox>
        </StackPanel>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vmn:PlayerIndicatorVM}">
        <Ellipse Width="{Binding Width, UpdateSourceTrigger=PropertyChanged}"
                 Height="{Binding Height, UpdateSourceTrigger=PropertyChanged}"
                 Fill="{StaticResource Color_PlayerIndicator}">
        </Ellipse>
    </DataTemplate>
    
    <DataTemplate DataType="{x:Type config:UserActionVM}">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"></ColumnDefinition>
                <ColumnDefinition Width="auto" MinWidth="64"></ColumnDefinition>
                <ColumnDefinition Width="auto"></ColumnDefinition>
            </Grid.ColumnDefinitions>

            <TextBlock FontSize="{StaticResource FontSize_Small}" x:Name="tb_UserActionName" VerticalAlignment="Center"></TextBlock>

            <ComboBox x:Name="Cmb_MouseButton" FontSize="{StaticResource FontSize_VerySmall}" Grid.Column="1" SelectedValue="{Binding MouseButton, UpdateSourceTrigger=PropertyChanged}" VerticalAlignment="Center" Margin="{StaticResource Thickness_Padding_LeftRight}">
                <x:Static Member="MouseButton.Left"></x:Static>
                <x:Static Member="MouseButton.Right"></x:Static>
            </ComboBox>

            <StackPanel x:Name="Sp_Modifiers"  Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                <CheckBox VerticalContentAlignment="Center" FontSize="{StaticResource FontSize_VerySmall}" IsChecked="{Binding IsAlt, UpdateSourceTrigger=PropertyChanged}">ALT</CheckBox>
                <CheckBox VerticalContentAlignment="Center" FontSize="{StaticResource FontSize_VerySmall}" IsChecked="{Binding IsControl, UpdateSourceTrigger=PropertyChanged}">CONTROL</CheckBox>
                <CheckBox VerticalContentAlignment="Center" FontSize="{StaticResource FontSize_VerySmall}" IsChecked="{Binding IsShift, UpdateSourceTrigger=PropertyChanged}">SHIFT</CheckBox>
            </StackPanel>

            <ComboBox x:Name="Cmb_KeyboardButton" IsEnabled="false" FontSize="{StaticResource FontSize_VerySmall}" Grid.Column="1" SelectedValue="{Binding KeyboardButton, UpdateSourceTrigger=PropertyChanged}" VerticalAlignment="Center" Margin="{StaticResource Thickness_Padding_LeftRight}" Visibility="Collapsed">
                <x:Static Member="Key.H"></x:Static>
                <x:Static Member="Key.V"></x:Static>
                <x:Static Member="Key.C"></x:Static>
                <x:Static Member="Key.X"></x:Static>
                <x:Static Member="Key.Delete"></x:Static>
            </ComboBox>
        </Grid>
        <DataTemplate.Triggers>
            <DataTrigger Binding="{Binding Model.UserActionType, Mode=OneTime}" Value="{x:Static vmconfig:USER_ACTION_TYPE.CREATE_NODE}">
                <Setter TargetName="tb_UserActionName" Property="Text" Value="{DynamicResource String_Tag_Config_UserActions_CreateNode}"></Setter>
            </DataTrigger>
            <DataTrigger Binding="{Binding Model.UserActionType, Mode=OneTime}" Value="{x:Static vmconfig:USER_ACTION_TYPE.DUPLICATE_NODE}">
                <Setter TargetName="tb_UserActionName" Property="Text" Value="{DynamicResource String_Tag_Config_UserActions_DuplicateNode}"></Setter>
            </DataTrigger>
            <DataTrigger Binding="{Binding Model.UserActionType, Mode=OneTime}" Value="{x:Static vmconfig:USER_ACTION_TYPE.LINK}">
                <Setter TargetName="tb_UserActionName" Property="Text" Value="{DynamicResource String_Tag_Config_UserActions_Link}"></Setter>
            </DataTrigger>
            <DataTrigger Binding="{Binding Model.UserActionType, Mode=OneTime}" Value="{x:Static vmconfig:USER_ACTION_TYPE.DRAG_AND_SCROLL}">
                <Setter TargetName="tb_UserActionName" Property="Text" Value="{DynamicResource String_Tag_Config_UserActions_DragAndScroll}"></Setter>
            </DataTrigger>
            <DataTrigger Binding="{Binding Model.UserActionType, Mode=OneTime}" Value="{x:Static vmconfig:USER_ACTION_TYPE.SELECTION_SIMPLE}">
                <Setter TargetName="tb_UserActionName" Property="Text" Value="{DynamicResource String_Tag_Config_UserActions_SelectionSimple}"></Setter>
            </DataTrigger>
            <DataTrigger Binding="{Binding Model.UserActionType, Mode=OneTime}" Value="{x:Static vmconfig:USER_ACTION_TYPE.SELECTION_ADDITIVE}">
                <Setter TargetName="tb_UserActionName" Property="Text" Value="{DynamicResource String_Tag_Config_UserActions_SelectionAdditive}"></Setter>
            </DataTrigger>
            <DataTrigger Binding="{Binding Model.UserActionType, Mode=OneTime}" Value="{x:Static vmconfig:USER_ACTION_TYPE.SELECTION_BOX}">
                <Setter TargetName="tb_UserActionName" Property="Text" Value="{DynamicResource String_Tag_Config_UserActions_SelectionBox}"></Setter>
            </DataTrigger>
            <DataTrigger Binding="{Binding Model.UserActionType, Mode=OneTime}" Value="{x:Static vmconfig:USER_ACTION_TYPE.ALIGN_HOR}">
                <Setter TargetName="tb_UserActionName" Property="Text" Value="{DynamicResource String_Tag_Config_UserActions_AlignHor}"></Setter>
                <Setter TargetName="Cmb_MouseButton" Property="Visibility" Value="Collapsed"></Setter>
                <Setter TargetName="Sp_Modifiers" Property="IsEnabled" Value="false"></Setter>
                <Setter TargetName="Cmb_KeyboardButton" Property="Visibility" Value="Visible"></Setter>
            </DataTrigger>
            <DataTrigger Binding="{Binding Model.UserActionType, Mode=OneTime}" Value="{x:Static vmconfig:USER_ACTION_TYPE.ALIGN_VER}">
                <Setter TargetName="tb_UserActionName" Property="Text" Value="{DynamicResource String_Tag_Config_UserActions_AlignVer}"></Setter>
                <Setter TargetName="Cmb_MouseButton" Property="Visibility" Value="Collapsed"></Setter>
                <Setter TargetName="Sp_Modifiers" Property="IsEnabled" Value="false"></Setter>
                <Setter TargetName="Cmb_KeyboardButton" Property="Visibility" Value="Visible"></Setter>
            </DataTrigger>
            <DataTrigger Binding="{Binding Model.UserActionType, Mode=OneTime}" Value="{x:Static vmconfig:USER_ACTION_TYPE.COPY}">
                <Setter TargetName="tb_UserActionName" Property="Text" Value="{DynamicResource String_Tag_Config_UserActions_Copy}"></Setter>
                <Setter TargetName="Cmb_MouseButton" Property="Visibility" Value="Collapsed"></Setter>
                <Setter TargetName="Sp_Modifiers" Property="IsEnabled" Value="false"></Setter>
                <Setter TargetName="Cmb_KeyboardButton" Property="Visibility" Value="Visible"></Setter>
            </DataTrigger>
            <DataTrigger Binding="{Binding Model.UserActionType, Mode=OneTime}" Value="{x:Static vmconfig:USER_ACTION_TYPE.PASTE}">
                <Setter TargetName="tb_UserActionName" Property="Text" Value="{DynamicResource String_Tag_Config_UserActions_Paste}"></Setter>
                <Setter TargetName="Cmb_MouseButton" Property="Visibility" Value="Collapsed"></Setter>
                <Setter TargetName="Sp_Modifiers" Property="IsEnabled" Value="false"></Setter>
                <Setter TargetName="Cmb_KeyboardButton" Property="Visibility" Value="Visible"></Setter>
            </DataTrigger>
            <DataTrigger Binding="{Binding Model.UserActionType, Mode=OneTime}" Value="{x:Static vmconfig:USER_ACTION_TYPE.CUT}">
                <Setter TargetName="tb_UserActionName" Property="Text" Value="{DynamicResource String_Tag_Config_UserActions_Cut}"></Setter>
                <Setter TargetName="Cmb_MouseButton" Property="Visibility" Value="Collapsed"></Setter>
                <Setter TargetName="Sp_Modifiers" Property="IsEnabled" Value="false"></Setter>
                <Setter TargetName="Cmb_KeyboardButton" Property="Visibility" Value="Visible"></Setter>
            </DataTrigger>
            <DataTrigger Binding="{Binding Model.UserActionType, Mode=OneTime}" Value="{x:Static vmconfig:USER_ACTION_TYPE.DELETE}">
                <Setter TargetName="tb_UserActionName" Property="Text" Value="{DynamicResource String_Tag_Config_UserActions_Delete}"></Setter>
                <Setter TargetName="Cmb_MouseButton" Property="Visibility" Value="Collapsed"></Setter>
                <Setter TargetName="Sp_Modifiers" Property="Visibility" Value="Hidden"></Setter>
                <Setter TargetName="Cmb_KeyboardButton" Property="Visibility" Value="Visible"></Setter>
            </DataTrigger>
        </DataTemplate.Triggers>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vm:PlayerContext_ErrorVM}">
        <StackPanel Orientation="Vertical">
            <TextBlock VerticalAlignment="Center" Text="{DynamicResource String_Tag_Player_Error}" Style="{StaticResource S_TextBlock_Graph_Bold}" Foreground="{StaticResource Color_Player_Error}"></TextBlock>
            <TextBlock Style="{StaticResource S_TextBlock_Graph}" Foreground="{StaticResource Color_Player_Error}">
                <Run Text="{DynamicResource String_Error_Line1}"></Run>
                <LineBreak></LineBreak><LineBreak></LineBreak>
                <Run Text="{DynamicResource String_Error_Line2}"></Run>
                <LineBreak></LineBreak><LineBreak></LineBreak>
                <Run Text="{DynamicResource String_Error_Line3}"></Run>
                <LineBreak></LineBreak><LineBreak></LineBreak>
                <Run Text="{DynamicResource String_Error_Line4}"></Run>
            </TextBlock>
        </StackPanel>
    </DataTemplate>
    
    <DataTemplate DataType="{x:Type vm:PlayerContext_ChoiceVM}">
        <ScrollViewer x:Name="sv_Main">
            <ItemsControl ItemsSource="{Binding Choices}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Button Margin="{StaticResource Thickness_Margin_1x}" FontSize="{StaticResource FontSize_Medium}"
                                Command="{Binding ElementName=sv_Main, Path=DataContext.SelectNodeCommand}" CommandParameter="{Binding Key}"
                                HorizontalContentAlignment="Stretch" Content="{Binding Key}">
                        </Button>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vm:PlayerContext_TransitionVM}">
        <TextBlock Style="{StaticResource S_TextBlock_Node_Icon_Large}" Text="{StaticResource String_Icon_Player_Transition}"></TextBlock>
    </DataTemplate>

    <DataTemplate DataType="{x:Type vm:HistoryVM}">
        <TabControl
            x:Name="tc_Main"
            MaxWidth="{StaticResource Double_Player_MaxWidth}"
            MaxHeight="{StaticResource Double_Player_MaxHeight}"
            >

            <TabItem Header="{DynamicResource String_Tag_Player_Tab_Props}">
                <DockPanel>
                    <Grid DockPanel.Dock="Top" Grid.Row="2" Margin="{StaticResource Thickness_Margin_Underline_2x}">
                        <Grid.RowDefinitions>
                            <RowDefinition></RowDefinition>
                            <RowDefinition></RowDefinition>
                            <RowDefinition></RowDefinition>
                            <RowDefinition></RowDefinition>
                        </Grid.RowDefinitions>
                        
                        <CheckBox IsChecked="{Binding FullMode}" Content="{DynamicResource String_Tag_Player_FullMode}"></CheckBox>
                        
                        <StackPanel Grid.Row="1" Orientation="Horizontal">
                            <Button VerticalAlignment="Center" Style="{StaticResource S_Button_Square_24x}" Content="{StaticResource String_Icon_Stop}" ToolTip="{DynamicResource String_Player_Stop_Tooltip}" Command="{Binding StopCommand}"></Button>
                            <Grid VerticalAlignment="Center">
                                <Button Style="{StaticResource S_Button_Square_24x}" Content="{StaticResource String_Icon_Pause}" ToolTip="{DynamicResource String_Player_Pause_Tooltip}" Command="{Binding PauseCommand}"></Button>
                                <Button Style="{StaticResource S_Button_Square_24x}" Content="{StaticResource String_Icon_Play}" ToolTip="{DynamicResource String_Player_Play_Tooltip}" Command="{Binding PlayCommand}"></Button>
                            </Grid>
                            <Button VerticalAlignment="Center" Style="{StaticResource S_Button_Gender}"></Button>
                            <Grid>
                                <TextBlock x:Name="tb_TimeLeft" VerticalAlignment="Center" HorizontalAlignment="Center" Padding="{StaticResource Thickness_Padding_LeftRight}" Style="{StaticResource S_TextBlock_Graph_Bold}" Text="{Binding TimeLeft, StringFormat=N2, UpdateSourceTrigger=PropertyChanged}"></TextBlock>
                                <ContentControl x:Name="cc_IsDownloading" VerticalAlignment="Center" HorizontalAlignment="Center" Style="{StaticResource S_ContentControl_Indicator_IsDownloading}" Visibility="Hidden"></ContentControl>
                            </Grid>
                        </StackPanel>
                        
                        <GroupBox Grid.Row="2" Margin="{StaticResource Thickness_Margin_Underline_6x}" Header="{DynamicResource String_Tag_Player_PlayRate}" HeaderTemplate="{StaticResource DT_GroupBox_HeaderTemplate_Player}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition></RowDefinition>
                                    <RowDefinition></RowDefinition>
                                </Grid.RowDefinitions>
                                <TextBlock HorizontalAlignment="Center" Text="{Binding PlayRate, UpdateSourceTrigger=PropertyChanged}" FontSize="{StaticResource FontSize_VerySmall}"></TextBlock>
                                <Slider
                                        Grid.Row="1"
                                        Value="{Binding PlayRate, UpdateSourceTrigger=PropertyChanged}"
                                        Minimum="{StaticResource Double_PlayRate_Min}"
                                        Maximum="{StaticResource Double_PlayRate_Max}"
                                        TickFrequency="{StaticResource Double_PlayRate_Tick}"
                                        ></Slider>
                            </Grid>
                        </GroupBox>

                        <GroupBox Grid.Row="3" Margin="{StaticResource Thickness_Margin_Underline_6x}" Header="{DynamicResource String_Tag_Player_Duration}" HeaderTemplate="{StaticResource DT_GroupBox_HeaderTemplate_Player}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition></RowDefinition>
                                    <RowDefinition></RowDefinition>
                                </Grid.RowDefinitions>
                                <TextBlock HorizontalAlignment="Center" Text="{Binding Duration, UpdateSourceTrigger=PropertyChanged}" FontSize="{StaticResource FontSize_VerySmall}"></TextBlock>
                                <Slider
                                        Grid.Row="1"
                                        Value="{Binding Duration, UpdateSourceTrigger=PropertyChanged}"
                                        Minimum="{StaticResource Double_Duration_Min}"
                                        Maximum="{StaticResource Double_Duration_Max}"
                                        TickFrequency="{StaticResource Double_Duration_Tick}"
                                        ></Slider>
                            </Grid>
                        </GroupBox>
                    </Grid>

                    <ContentControl Grid.Row="4"
                                    Margin="{StaticResource Thickness_Margin_2x}"
                                    Content="{Binding PlayerContext, UpdateSourceTrigger=PropertyChanged}">
                    </ContentControl>
                </DockPanel>
            </TabItem>

            <TabItem
                x:Name="ti_Relation"
                Visibility="Collapsed">
                <TabItem.Header>
                    <controls:ComboBoxExt
                        IsEnabled="{Binding ElementName=ti_Relation, Path=IsSelected, UpdateSourceTrigger=PropertyChanged}"
                        SelectedValue="{Binding Character, UpdateSourceTrigger=PropertyChanged}"
                        ItemsSource="{Binding CharactersCVS.View}"
                        Filter="{Binding CharactersFilter, UpdateSourceTrigger=PropertyChanged}"
                        Style="{StaticResource S_ComboBoxExt_Prop_Popup}"
                        FontSize="{StaticResource FontSize_Small}">
                        <controls:ComboBoxExt.Tag>
                            <TextBlock
                                Padding="{StaticResource Thickness_Padding_LeftRight}"
                                VerticalAlignment="Center"
                                Text="{DynamicResource String_Tag_MainMenu_Characters}"
                                FontSize="{StaticResource FontSize_Small}"
                                ></TextBlock>
                        </controls:ComboBoxExt.Tag>
                    </controls:ComboBoxExt>
                </TabItem.Header>
                <ScrollViewer>
                    <ItemsControl
                        ItemsSource="{Binding CharacterEntries}"
                        >
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Grid
                                    Margin="{StaticResource Thickness_Margin_Underline_4x}"
                                    >
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="auto"></ColumnDefinition>
                                        <ColumnDefinition Width="*"></ColumnDefinition>
                                        <ColumnDefinition Width="auto"></ColumnDefinition>
                                    </Grid.ColumnDefinitions>
                                    <ContentControl
                                        VerticalAlignment="Center"
                                        Content="{Binding Model}"
                                        ></ContentControl>
                                    
                                    <Grid
                                        Grid.Column="1"
                                        VerticalAlignment="Center">
                                        <Grid.RowDefinitions>
                                            <RowDefinition></RowDefinition>
                                            <RowDefinition></RowDefinition>
                                        </Grid.RowDefinitions>
                                        <TextBlock HorizontalAlignment="Center" Text="{Binding DeltaRelation, UpdateSourceTrigger=PropertyChanged, StringFormat=N2}" FontSize="{StaticResource FontSize_VerySmall}"></TextBlock>
                                        <Slider
                                        Grid.Row="1"
                                        Value="{Binding DeltaRelation, UpdateSourceTrigger=PropertyChanged}"
                                        Minimum="{StaticResource Double_RelationDelta_Min}"
                                        Maximum="{StaticResource Double_RelationDelta_Max}"
                                        TickFrequency="{StaticResource Double_Relation_Tick}"
                                        ></Slider>
                                    </Grid>
                                    
                                    <Button
                                        VerticalAlignment="Center"
                                        Grid.Column="2"
                                        Style="{StaticResource S_Button_Remove}"
                                        Margin="{StaticResource Thickness_Margin_1x}"
                                        Command="{Binding ElementName=ti_Relation, Path=DataContext.RemoveCharacterCommand}"
                                        CommandParameter="{Binding Model}"
                                        ></Button>
                                </Grid>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </TabItem>
            
            <TabItem
                x:Name="ti_Inventory"
                Visibility="Collapsed">
                <TabItem.Header>
                    <controls:ComboBoxExt
                        IsEnabled="{Binding ElementName=ti_Inventory, Path=IsSelected, UpdateSourceTrigger=PropertyChanged}"
                        SelectedValue="{Binding Item, UpdateSourceTrigger=PropertyChanged}"
                        ItemsSource="{Binding ItemsCVS.View}"
                        Filter="{Binding ItemsFilter, UpdateSourceTrigger=PropertyChanged}"
                        Style="{StaticResource S_ComboBoxExt_Prop_Popup}"
                        FontSize="{StaticResource FontSize_Small}">
                        <controls:ComboBoxExt.Tag>
                            <TextBlock
                                Padding="{StaticResource Thickness_Padding_LeftRight}"
                                VerticalAlignment="Center"
                                Text="{DynamicResource String_Tag_MainMenu_Items}"
                                FontSize="{StaticResource FontSize_Small}"
                                ></TextBlock>
                        </controls:ComboBoxExt.Tag>
                    </controls:ComboBoxExt>
                </TabItem.Header>
                <ScrollViewer>
                    <ItemsControl
                        ItemsSource="{Binding Inventory}"
                        >
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Grid
                                    Margin="{StaticResource Thickness_Margin_Underline_4x}"
                                    >
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"></ColumnDefinition>
                                        <ColumnDefinition Width="auto"></ColumnDefinition>
                                    </Grid.ColumnDefinitions>
                                    <ContentControl
                                        Content="{Binding}"
                                        ></ContentControl>
                                    <Button
                                        Grid.Column="1"
                                        Style="{StaticResource S_Button_Remove}"
                                        Margin="{StaticResource Thickness_Margin_1x}"
                                        Command="{Binding ElementName=ti_Inventory, Path=DataContext.RemoveItemCommand}"
                                        ></Button>
                                </Grid>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </TabItem>

            <TabItem
                x:Name="ti_Journal"
                Visibility="Collapsed">
                <TabItem.Header>
                    <controls:ComboBoxExt
                        IsEnabled="{Binding ElementName=ti_Journal, Path=IsSelected, UpdateSourceTrigger=PropertyChanged}"
                        SelectedValue="{Binding Quest, UpdateSourceTrigger=PropertyChanged}"
                        ItemsSource="{Binding QuestsCVS.View}"
                        Filter="{Binding QuestsFilter, UpdateSourceTrigger=PropertyChanged}"
                        Style="{StaticResource S_ComboBoxExt_Prop_Popup}"
                        FontSize="{StaticResource FontSize_Small}">
                        <controls:ComboBoxExt.Tag>
                            <TextBlock
                                Padding="{StaticResource Thickness_Padding_LeftRight}"
                                VerticalAlignment="Center"
                                Text="{DynamicResource String_Tag_MainMenu_Journal}"
                                FontSize="{StaticResource FontSize_Small}"
                                ></TextBlock>
                        </controls:ComboBoxExt.Tag>
                    </controls:ComboBoxExt>
                </TabItem.Header>
                <ScrollViewer>
                    <ItemsControl
                        ItemsSource="{Binding QuestEntries}"
                        >
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Expander>
                                    <Expander.Header>
                                        <Grid
                                            Margin="{StaticResource Thickness_Margin_Underline_4x}"
                                            >
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"></ColumnDefinition>
                                                <ColumnDefinition Width="auto"></ColumnDefinition>
                                                <ColumnDefinition Width="auto"></ColumnDefinition>
                                            </Grid.ColumnDefinitions>
                                            <ContentControl
                                                Content="{Binding Model}"
                                                ></ContentControl>

                                            <controls:ComboBoxExt
                                                Grid.Column="1"
                                                SelectedValue="{Binding KnownNode, UpdateSourceTrigger=PropertyChanged}"
                                                ItemsSource="{Binding KnownNodesCVS.View}"
                                                Filter="{Binding KnownNodesFilter, UpdateSourceTrigger=PropertyChanged}"
                                                Style="{StaticResource S_ComboBoxExt_Prop_Popup}">
                                            </controls:ComboBoxExt>

                                            <Button
                                                Grid.Column="2"
                                                Style="{StaticResource S_Button_Remove}"
                                                Margin="{StaticResource Thickness_Margin_1x}"
                                                Command="{Binding ElementName=ti_Journal, Path=DataContext.RemoveQuestCommand}"
                                                CommandParameter="{Binding Model}"
                                                ></Button>
                                        </Grid>
                                    </Expander.Header>

                                    <ItemsControl x:Name="ic_Nodes"
                                        ItemsSource="{Binding KnownNodes}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Grid
                                                    Margin="{StaticResource Thickness_Margin_Underline_4x}"
                                                    >
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"></ColumnDefinition>
                                                        <ColumnDefinition Width="auto"></ColumnDefinition>
                                                        <ColumnDefinition Width="auto"></ColumnDefinition>
                                                    </Grid.ColumnDefinitions>

                                                    <ContentControl
                                                        Content="{Binding Node}"
                                                        ></ContentControl>

                                                    <CheckBox
                                                        Margin="{StaticResource Thickness_Padding_LeftRight}"
                                                        VerticalContentAlignment="Center"
                                                        Grid.Column="1"
                                                        IsChecked="{Binding IsPassed, UpdateSourceTrigger=PropertyChanged}"
                                                        Content="{DynamicResource String_Tag_Player_QuestNodeIsPassed}"
                                                        FontSize="{StaticResource FontSize_VerySmall}"
                                                        ></CheckBox>

                                                    <Button
                                                        Grid.Column="2"
                                                        Style="{StaticResource S_Button_Remove}"
                                                        Margin="{StaticResource Thickness_Margin_1x}"
                                                        Command="{Binding ElementName=ic_Nodes, Path=DataContext.RemoveKnownNodeCommand}"
                                                        CommandParameter="{Binding Node}"
                                                        ></Button>
                                                </Grid>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </Expander>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </TabItem>

            <TabItem
                x:Name="ti_Dialogs"
                Visibility="Collapsed">
                <TabItem.Header>
                    <controls:ComboBoxExt
                        IsEnabled="{Binding ElementName=ti_Dialogs, Path=IsSelected, UpdateSourceTrigger=PropertyChanged}"
                        SelectedValue="{Binding Dialog, UpdateSourceTrigger=PropertyChanged}"
                        ItemsSource="{Binding DialogsCVS.View}"
                        Filter="{Binding DialogsFilter, UpdateSourceTrigger=PropertyChanged}"
                        Style="{StaticResource S_ComboBoxExt_Prop_Popup}"
                        FontSize="{StaticResource FontSize_Small}">
                        <controls:ComboBoxExt.Tag>
                            <TextBlock
                                Padding="{StaticResource Thickness_Padding_LeftRight}"
                                VerticalAlignment="Center"
                                Text="{DynamicResource String_Tag_MainMenu_DialogsAndReplicas}"
                                FontSize="{StaticResource FontSize_Small}"
                                ></TextBlock>
                        </controls:ComboBoxExt.Tag>
                    </controls:ComboBoxExt>
                </TabItem.Header>
                <ScrollViewer>
                    <ItemsControl
                        ItemsSource="{Binding DialogEntries}"
                        >
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Expander>
                                    <Expander.Header>
                                        <Grid
                                            Margin="{StaticResource Thickness_Margin_Underline_4x}"
                                            >
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"></ColumnDefinition>
                                                <ColumnDefinition Width="auto"></ColumnDefinition>
                                                <ColumnDefinition Width="auto"></ColumnDefinition>
                                            </Grid.ColumnDefinitions>
                                            <ContentControl
                                                Content="{Binding Model}"
                                                ></ContentControl>

                                            <controls:ComboBoxExt
                                                Grid.Column="1"
                                                SelectedValue="{Binding Node, UpdateSourceTrigger=PropertyChanged}"
                                                ItemsSource="{Binding NodesCVS.View}"
                                                Filter="{Binding NodesFilter, UpdateSourceTrigger=PropertyChanged}"
                                                Style="{StaticResource S_ComboBoxExt_Prop_Popup}">
                                            </controls:ComboBoxExt>

                                            <Button
                                                Grid.Column="2"
                                                Style="{StaticResource S_Button_Remove}"
                                                Margin="{StaticResource Thickness_Margin_1x}"
                                                Command="{Binding ElementName=ti_Dialogs, Path=DataContext.RemoveDialogCommand}"
                                                ></Button>
                                        </Grid>
                                    </Expander.Header>

                                    <ItemsControl x:Name="ic_Nodes"
                                        ItemsSource="{Binding Nodes}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Grid
                                                    Margin="{StaticResource Thickness_Margin_Underline_4x}"
                                                    >
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"></ColumnDefinition>
                                                        <ColumnDefinition Width="auto"></ColumnDefinition>
                                                        <ColumnDefinition Width="auto"></ColumnDefinition>
                                                    </Grid.ColumnDefinitions>
                                                    <ContentControl
                                                        Content="{Binding}"
                                                        ></ContentControl>
                                                    <Button
                                                        Grid.Column="2"
                                                        Style="{StaticResource S_Button_Remove}"
                                                        Margin="{StaticResource Thickness_Margin_1x}"
                                                        Command="{Binding ElementName=ic_Nodes, Path=DataContext.RemoveNodeCommand}"
                                                        CommandParameter="{Binding}"
                                                        ></Button>
                                                </Grid>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </Expander>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </TabItem>
        </TabControl>
        <DataTemplate.Triggers>
            <DataTrigger Binding="{Binding FullMode, UpdateSourceTrigger=PropertyChanged}" Value="true">
                <Setter TargetName="tc_Main" Property="MaxWidth" Value="{StaticResource Double_Player_MaxWidth}"></Setter>
                <Setter TargetName="tc_Main" Property="MaxHeight" Value="{StaticResource Double_Player_MaxHeight}"></Setter>
                <Setter TargetName="tc_Main" Property="MaxWidth" Value="{StaticResource Double_Player_FullMode_MaxWidth}"></Setter>
                <Setter TargetName="tc_Main" Property="MaxHeight" Value="{StaticResource Double_Player_FullMode_MaxHeight}"></Setter>
                <Setter TargetName="ti_Relation" Property="Visibility" Value="Visible"></Setter>
                <Setter TargetName="ti_Inventory" Property="Visibility" Value="Visible"></Setter>
                <Setter TargetName="ti_Journal" Property="Visibility" Value="Visible"></Setter>
                <Setter TargetName="ti_Dialogs" Property="Visibility" Value="Visible"></Setter>
            </DataTrigger>
            <DataTrigger Binding="{Binding IsDownloading, UpdateSourceTrigger=PropertyChanged}" Value="true">
                <Setter TargetName="tb_TimeLeft" Property="Visibility" Value="Hidden"></Setter>
                <Setter TargetName="cc_IsDownloading" Property="Visibility" Value="Visible"></Setter>
            </DataTrigger>
        </DataTemplate.Triggers>
    </DataTemplate>
    
</ResourceDictionary>